<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-v16.0.0 docs-doc-page docs-doc-id-guides/testing-relay-components" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Testing Relay Components | Relay</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://relay.dev/img/relay.png /><meta data-rh=true name=twitter:image content=https://relay.dev/img/relay.png /><meta data-rh=true property=og:url content=https://relay.dev/docs/v16.0.0/guides/testing-relay-components/ /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=v16.0.0 /><meta data-rh=true name=docusaurus_tag content=docs-default-v16.0.0 /><meta data-rh=true name=docsearch:version content=v16.0.0 /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-v16.0.0 /><meta data-rh=true property=og:title content="Testing Relay Components | Relay"/><meta data-rh=true name=description content="Relay guide to testing Relay components"/><meta data-rh=true property=og:description content="Relay guide to testing Relay components"/><meta data-rh=true name=keywords content=testing,createMockEnvironment,RelayMockEnvironment,MockPayloadGenerator,relay_test_operation,queuePendingOperation,resolver /><link data-rh=true rel=icon href=/img/favicon.png /><link data-rh=true rel=canonical href=https://relay.dev/docs/v16.0.0/guides/testing-relay-components/ /><link data-rh=true rel=alternate href=https://relay.dev/docs/v16.0.0/guides/testing-relay-components/ hreflang=en /><link data-rh=true rel=alternate href=https://relay.dev/docs/v16.0.0/guides/testing-relay-components/ hreflang=x-default /><link data-rh=true rel=preconnect href=https://UBPJPW35NS-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://relay.dev/docs/v16.0.0/guides/testing-relay-components/","name":"Testing Relay Components","position":1}]}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Relay RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Relay Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-DCSC7FDGL5","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-DCSC7FDGL5"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DCSC7FDGL5",{})</script><link rel=search type=application/opensearchdescription+xml title=Relay href=/opensearch.xml><link rel=stylesheet href=/assets/css/styles.deec89cd.css /><script src=/assets/js/runtime~main.a8bcdfc7.js defer></script><script src=/assets/js/main.a2788f68.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id=internaldocs-banner></div><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top navbar--primary"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">Relay</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/>Docs</a><a class="navbar__item navbar__link" href=/blog/>Blog</a><a class="navbar__item navbar__link" href=/help/>Help</a><a href=https://github.com/facebook/relay target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/docs/v16.0.0/guides/testing-relay-components/>v16.0.0</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs/next/guides/testing-relay-components/>Next ðŸš§</a><li><a class=dropdown__link href=/docs/guides/testing-relay-components/>v20.1.0</a><li><a class=dropdown__link href=/docs/v20.0.0/guides/testing-relay-components/>v20.0.0</a><li><a class=dropdown__link href=/docs/v19.0.0/guides/testing-relay-components/>v19.0.0</a><li><a class=dropdown__link href=/docs/v18.0.0/guides/testing-relay-components/>v18.0.0</a><li><a class=dropdown__link href=/docs/v17.0.0/guides/testing-relay-components/>v17.0.0</a><li><a aria-current=page class="dropdown__link dropdown__link--active" href=/docs/v16.0.0/guides/testing-relay-components/>v16.0.0</a><li><a class=dropdown__link href=/docs/v15.0.0/guides/testing-relay-components/>v15.0.0</a><li><a class=dropdown__link href=/docs/v14.0.0/guides/testing-relay-components/>v14.0.0</a><li><a class=dropdown__link href=/docs/v13.0.0/guides/testing-relay-components/>v13.0.0</a><li><a class=dropdown__link href=/versions/>All versions</a></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/v16.0.0/><span title=Home class=linkLabel_WmDU>Home</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/v16.0.0/tutorial/intro/><span title=Tutorial class=categoryLinkLabel_W154>Tutorial</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/v16.0.0/getting-started/prerequisites/><span title=Installation class=categoryLinkLabel_W154>Installation</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role=button aria-expanded=true href=/docs/v16.0.0/guides/graphql-server-specification/><span title=Guides class=categoryLinkLabel_W154>Guides</span></a></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/graphql-server-specification/><span title="GraphQL Server Specification" class=linkLabel_WmDU>GraphQL Server Specification</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/compiler/><span title="Relay Compiler" class=linkLabel_WmDU>Relay Compiler</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/type-emission/><span title="Type Emission" class=linkLabel_WmDU>Type Emission</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/persisted-queries/><span title="Persisted Queries" class=linkLabel_WmDU>Persisted Queries</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/network-layer/><span title="Network Layer" class=linkLabel_WmDU>Network Layer</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/client-schema-extensions/><span title="Client Schema Extensions" class=linkLabel_WmDU>Client Schema Extensions</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/v16.0.0/guides/testing-relay-components/><span title="Testing Relay Components" class=linkLabel_WmDU>Testing Relay Components</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/testing-relay-with-preloaded-queries/><span title="Testing Relay with Preloaded Queries" class=linkLabel_WmDU>Testing Relay with Preloaded Queries</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/required-directive/><span title="@required Directive" class=linkLabel_WmDU>@required Directive</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guides/relay-resolvers/><span title="Relay Resolvers" class=linkLabel_WmDU>Relay Resolvers</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guided-tour/rendering/error-states/><span title="Error States with ErrorBoundaries" class=linkLabel_WmDU>Error States with ErrorBoundaries</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/v16.0.0/guided-tour/reusing-cached-data/><span title="Reusing Cached Data for Rendering" class=categoryLinkLabel_W154>Reusing Cached Data for Rendering</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guided-tour/list-data/advanced-pagination/><span title="Advanced Pagination" class=linkLabel_WmDU>Advanced Pagination</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/v16.0.0/guided-tour/accessing-data-without-react/retaining-queries/><span title="Managing Data Outside React" class=categoryLinkLabel_W154>Managing Data Outside React</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/v16.0.0/guided-tour/updating-data/graphql-subscriptions/><span title="GraphQL subscriptions" class=linkLabel_WmDU>GraphQL subscriptions</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href=/docs/v16.0.0/guided-tour/updating-data/imperatively-modifying-store-data/><span title="Updating Data" class=categoryLinkLabel_W154>Updating Data</span></a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/v16.0.0/api-reference/relay-environment-provider/><span title="API Reference" class=categoryLinkLabel_W154>API Reference</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/v16.0.0/migration-and-compatibility/><span title="Migration and Compatibility" class=categoryLinkLabel_W154>Migration and Compatibility</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/v16.0.0/debugging/relay-devtools/><span title=Debugging class=categoryLinkLabel_W154>Debugging</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/v16.0.0/principles-and-architecture/thinking-in-graphql/><span title="Principles and Architecture" class=categoryLinkLabel_W154>Principles and Architecture</span></a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs/v16.0.0/error-reference/unknown-field/><span title="Error reference" class=categoryLinkLabel_W154>Error reference</span></a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/v16.0.0/community-learning-resources/><span title="Community Learning Resources" class=linkLabel_WmDU>Community Learning Resources</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/v16.0.0/glossary/><span title=Glossary class=linkLabel_WmDU>Glossary</span></a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role=alert><div>This is documentation for <!-- -->Relay<!-- --> <b>v16.0.0</b>, which is no longer actively maintained.</div><div class=margin-top--md>For up-to-date documentation, see the <b><a href=/docs/guides/testing-relay-components/>latest version</a></b> (<!-- -->v20.1.0<!-- -->).</div></div><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><span class=breadcrumbs__link>Guides</span><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Testing Relay Components</span></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v16.0.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Testing Relay Components</h1></header><h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=abstract>Abstract<a href=#abstract class=hash-link aria-label="Direct link to Abstract" title="Direct link to Abstract" translate=no>â€‹</a></h2>
<p>The purpose of this document is to cover the Relay APIs for testing Relay components.</p>
<p>The content is focused mostly on jest unit-tests (testing individual components) and integration tests (testing a combination of components).  But these testing tools may be applied in different cases: screenshot-tests, production smoke-tests, "Redbox" tests, fuzz-tests, e2e test, etc.</p>
<p>What are the benefits of writing jest tests:</p>
<ul>
<li class="">In general, it improves the stability of the system. Flow helps with catching a various set of Javascript errors, but it is still possible to introduce regressions to the components. Unit-tests help find, reproduce, and fix regressions, and prevent them in the future.</li>
<li class="">It simplifies the refactoring process: when properly written (testing public interface, not implementation) - tests help with changing the internal implementation of the components.</li>
<li class="">It may speed up and improve the development workflow. Some people may call it Test Driven Development (TM). But essentially it's just writing tests for public interfaces of your components, and then writing the components that implement those interfaces. Jest â€”watch mode really shines in this case.</li>
<li class="">It will simplify the on-boarding process for new developers. Having tests helps new developers ramp up on the new code base, allowing them to fix bugs and deliver features.</li>
</ul>
<p>One thing to notice: while jest unit- and integration tests will help improve the stability of the system, they should be considered one part of a bigger stability infrastructure with multiple layers of automated testing: flow, e2e, screenshot, "Redbox", performance tests.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=testing-with-relay>Testing with Relay<a href=#testing-with-relay class=hash-link aria-label="Direct link to Testing with Relay" title="Direct link to Testing with Relay" translate=no>â€‹</a></h2>
<p>Testing applications that use Relay may be challenging, because of the additional data fetching layer that wraps the actual product code.</p>
<p>And it's not always easy to understand the mechanics of all processes that are happening behind Relay, and how to properly handle interactions with the framework.</p>
<p>Fortunately, there are tools that aim to simplify the process of writing tests for Relay components, by providing imperative APIs for controlling the request/response flow and additional API for mock data generation.</p>
<p>There are two main modules that you may use in your tests:</p>
<ul>
<li class=""><code>createMockEnvironment(options): RelayMockEnvironment</code></li>
<li class=""><code>MockPayloadGenerator</code> and the <code>@relay_test_operation</code> directive</li>
</ul>
<p>With <code>createMockEnvironment,</code> you will be able to create an instance of <code>RelayMockEnvironment</code>, a Relay environment specifically for your tests. The instance created by <code>createMockEnvironment</code> implements the Relay Environment Interface and it also has an additional Mock layer, with methods that allow you to resolve/reject and control the flow of operations (queries/mutations/subscriptions).</p>
<p>The main purpose of <code>MockPayloadGenerator</code> is to improve the process of creating and maintaining the mock data for tested components.</p>
<p>One of the patterns you may see in the tests for Relay components: 95% of the test code is the test preparationâ€”the gigantic mock object with dummy data, manually created, or just a copy of a sample server response that needs to be passed as the network response. And the remaining 5% is actual test code. As a result, people don't test much. It's hard to create and manage all these dummy payloads for different cases. Hence, writing tests is time-consuming and tests are sometimes painful to maintain.</p>
<p>With the <code>MockPayloadGenerator</code> and <code>@relay_test_operation</code>, we want to get rid of this pattern and switch the developer's focus from the preparation of the test to the actual testing.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=relaymockenvironment-api-overview>RelayMockEnvironment API Overview<a href=#relaymockenvironment-api-overview class=hash-link aria-label="Direct link to RelayMockEnvironment API Overview" title="Direct link to RelayMockEnvironment API Overview" translate=no>â€‹</a></h2>
<p>RelayMockEnvironment is a special version of Relay Environment with additional API methods for controlling the operation flow: resolving and rejection operations, providing incremental payloads for subscriptions, working with the cache.</p>
<ul>
<li class="">Methods for finding operations executed on the environment<!-- -->
<ul>
<li class=""><code>getAllOperations()</code> - get all operation executed during the test by the current time</li>
<li class=""><code>findOperation(findFn => boolean) </code>- find particular operation in the list of all executed operations, this method will throw, if operation is not available. Maybe useful to find a particular operation when multiple operations executed at the same time</li>
<li class=""><code>getMostRecentOperation() -</code> return the most recent operation, this method will throw if no operations were executed prior this call.</li>
</ul>
</li>
<li class="">Methods for resolving or rejecting operations<!-- -->
<ul>
<li class=""><code>nextValue(request | operation, data)</code> - provide payload for operation(request), but not complete request. Practically useful when testing incremental updates and subscriptions</li>
<li class=""><code>complete(request | operation)</code>  - complete the operation, no more payloads are expected for this operation, when it's completed.</li>
<li class=""><code>resolve(request | operation, data)</code> - resolve the request with provided GraphQL response. Essentially, it's nextValue(...) and complete(...)</li>
<li class=""><code>reject(request | operation, error)</code> - reject the request with particular error</li>
<li class=""><code>resolveMostRecentOperation(operation => data)</code> - resolve and getMostRecentOperation work together</li>
<li class=""><code>rejectMostRecentOperation(operation => error)</code>  - reject and getMostRecentOperation work together</li>
<li class=""><code>queueOperationResolver(operation => data | error)</code> - adds an OperationResolver function to the queue. The passed resolver will be used to resolve/reject operations as they appear</li>
<li class=""><code>queuePendingOperation(query, variables)</code> - in order for the <code>usePreloadedQuery</code> hook to not suspend, one must call these functions:<!-- -->
<ul>
<li class=""><code>queueOperationResolver(resolver)</code></li>
<li class=""><code>queuePendingOperation(query, variables)</code></li>
<li class=""><code>preloadQuery(mockEnvironment, query, variables)</code> with the same <code>query</code> and <code>variables</code> that were passed to <code>queuePendingOperation</code>. <code>preloadQuery</code> must be called after <code>queuePendingOperation</code>.</li>
</ul>
</li>
</ul>
</li>
<li class="">Additional utility methods<!-- -->
<ul>
<li class=""><code>isLoading(request | operation)</code> - will return <code>true</code> if operations has not been completed, yet.</li>
<li class=""><code>cachePayload(request | operation, variables, payload)</code> - will add payload to QueryResponse cache</li>
<li class=""><code>clearCache() </code>- will clear QueryResponse cache</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=mock-payload-generator-and-the-relay_test_operation-directive>Mock Payload Generator and the <code>@relay_test_operation</code> Directive<a href=#mock-payload-generator-and-the-relay_test_operation-directive class=hash-link aria-label="Direct link to mock-payload-generator-and-the-relay_test_operation-directive" title="Direct link to mock-payload-generator-and-the-relay_test_operation-directive" translate=no>â€‹</a></h2>
<p><code>MockPayloadGenerator</code> may drastically simplify the process of creating and maintaining mock data for your tests. <code>MockPayloadGenerator</code> can generate dummy data for the selection that you have in your operation. There is an API to modify the generated data - Mock Resolvers. With Mock Resolvers, you may adjust the data for your needs. Mock Resolvers are defined as an object where <strong>keys are names of GraphQL types (<code>ID</code>, <code>String</code>, <code>User</code>, <code>Comment</code>, etc),</strong> and values are functions that return the default data for the type.</p>
<p>Example of a simple Mock Resolver:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token constant" style=color:black>ID</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Return mock value for a scalar filed with type ID</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'my-id'</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token known-class-name class-name">String</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Every scalar field with type String will have this default value</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token string" style=color:#65822b>"Lorem Ipsum"</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<p>It is possible to define more resolvers for Object types</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// This will be the default values for User object in the query response</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function maybe-class-name" style=color:black>User</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token literal-property property" style=color:black>id</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token number" style=color:black>4</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token literal-property property" style=color:black>name</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token string" style=color:#65822b>"Mark"</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token literal-property property" style=color:black>profile_picture</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token literal-property property" style=color:black>uri</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token string" style=color:#65822b>"http://my-image..."</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=mock-resolver-context>Mock Resolver Context<a href=#mock-resolver-context class=hash-link aria-label="Direct link to Mock Resolver Context" title="Direct link to Mock Resolver Context" translate=no>â€‹</a></h3>
<p>The first argument of the MockResolver is the object that contains Mock Resolver Context. It is possible to return dynamic values from mock resolvers based on the context - for instance, name or alias of the field, a path in the selection, arguments, or parent type.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token known-class-name class-name">String</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">context</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'zip'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'94025'</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">path</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>!=</span><span class="token plain"> </span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&&</span><span class="token plain"> context</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">path</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>join</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'.'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'node.actor.name'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'Current Actor Name'</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">parentType</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'Image'</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&&</span><span class="token plain"> context</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'uri'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">       </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'http://my-image.url'</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=id-generation>ID Generation<a href=#id-generation class=hash-link aria-label="Direct link to ID Generation" title="Direct link to ID Generation" translate=no>â€‹</a></h3>
<p>The second argument of the Mock Resolver is a function that will generate a sequence of integers, useful to generate unique ids in the tests</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// will generate strings "my-id-1", "my-id-2", etc.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token constant" style=color:black>ID</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">_</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> generateId</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">     </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string string" style=color:#65822b>my-id-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#b58a5e>${</span><span class="token template-string interpolation function" style=color:black>generateId</span><span class="token template-string interpolation punctuation" style=color:#b58a5e>(</span><span class="token template-string interpolation punctuation" style=color:#b58a5e>)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#b58a5e>}</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=float-integer-boolean-etc>Float, Integer, Boolean, etc...<a href=#float-integer-boolean-etc class=hash-link aria-label="Direct link to Float, Integer, Boolean, etc..." title="Direct link to Float, Integer, Boolean, etc..." translate=no>â€‹</a></h3>
<p>Please note, that for production queries we don't have full type information for Scalar fields - like Boolean, Integer, Float. And in the MockResolvers, they map to String. You can use <code>context</code> to adjust return values, based on the field name, alias, etc.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=relay_test_operation>@relay_test_operation<a href=#relay_test_operation class=hash-link aria-label="Direct link to @relay_test_operation" title="Direct link to @relay_test_operation" translate=no>â€‹</a></h3>
<p>Most of GraphQL type information for a specific field in the selection is not available during Relay runtime. By default, Relay, cannot get type information for a scalar field in the selection, or an interface type of the object.</p>
<p>Operation with the @relay_test_operation directive will have additional metadata that will contain GraphQL type info for fields in the operation's selection. And it will improve the quality of the generated data. You also will be able to define Mock resolvers for Scalar (not only ID and String) and Abstract types:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function maybe-class-name" style=color:black>Float</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token number" style=color:black>123.456</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token known-class-name class-name">Boolean</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">context</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'can_edit'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token boolean" style=color:black>true</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token boolean" style=color:black>false</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function maybe-class-name" style=color:black>Node</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token literal-property property" style=color:black>__typename</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'User'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token literal-property property" style=color:black>id</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'my-user-id'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=examples>Examples<a href=#examples class=hash-link aria-label="Direct link to Examples" title="Direct link to Examples" translate=no>â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=relay-component-test>Relay Component Test<a href=#relay-component-test class=hash-link aria-label="Direct link to Relay Component Test" title="Direct link to Relay Component Test" translate=no>â€‹</a></h3>
<p>Using <code>createMockEnvironment</code> and <code>MockPayloadGenerator</code> allows writing concise tests for components that use Relay hooks. Both those modules can be imported from <code>relay-test-utils</code></p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token comment" style=color:#999988;font-style:italic>// Say you have a component with the useLazyLoadQuery or a QueryRenderer</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token maybe-class-name">MyAwesomeViewRoot</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>require</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'MyAwesomeViewRoot'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>require</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'relay-test-utils'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Relay may trigger 3 different states</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// for this component: Loading, Error, Data Loaded</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Here is examples of tests for those states.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Loading State'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyAwesomeViewRoot</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Here we just verify that the spinner is rendered</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">root</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>find</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> node</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>[</span><span class="token string" style=color:#65822b>'data-testid'</span><span class="token punctuation" style=color:#b58a5e>]</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'spinner'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBeDefined</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Data Render'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyAwesomeViewRoot</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Wrapping in ReactTestRenderer.act will ensure that components</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// are fully updated to their final state.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolveMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">operation</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// At this point operation will be resolved</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// and the data for a query will be available in the store</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">root</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>find</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> node</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>[</span><span class="token string" style=color:#65822b>'data-testid'</span><span class="token punctuation" style=color:#b58a5e>]</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'myButton'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBeDefined</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Error State'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyAwesomeViewRoot</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Wrapping in ReactTestRenderer.act will ensure that components</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// are fully updated to their final state.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// Error can be simulated with `rejectMostRecentOperation`</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>rejectMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Uh-oh'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">root</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>find</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">item</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">testID</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'errorMessage'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBeDefined</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id=component-tests-with-deferred-fragments>Component Tests With Deferred Fragments<a href=#component-tests-with-deferred-fragments class=hash-link aria-label="Direct link to Component Tests With Deferred Fragments" title="Direct link to Component Tests With Deferred Fragments" translate=no>â€‹</a></h4>
<p>When using <code>MockPayloadGenerator</code> to generate data for a Query that has fragments with <code>@defer</code> you may want to generate the deferred data as well. To do so, you can use <code>MockPayloadGenerator.generateWithDefer</code> passing the option <code>generateDeferredPayload</code>:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token comment" style=color:#999988;font-style:italic>// Say you have a component with useFragment</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style=color:black>ChildComponent</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter literal-property property" style=color:black>props</span><span class="token parameter operator" style=color:#b58a5e>:</span><span class="token parameter"> </span><span class="token parameter punctuation" style=color:#b58a5e>{</span><span class="token parameter literal-property property" style=color:black>user</span><span class="token parameter operator" style=color:#b58a5e>:</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">ChildComponentFragment_user$key</span><span class="token parameter punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> data </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useFragment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">  </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>fragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql fragment function" style=color:black>ChildComponentFragment_user</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>on</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql class-name">User</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string graphql language-graphql property" style=color:black>name</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">  </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">  </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> props</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">user</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">View</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">data</span><span class="token operator" style=color:#b58a5e>?.</span><span class="token plain">name</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">View</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Say you have a parent component that fetches data with useLazyLoadQuery and `@defer`s the data for the ChildComponent.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style=color:black>ParentComponent</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> data </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useLazyLoadQuery</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">  </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>query</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql definition-query function" style=color:black>ParentComponentQuery</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string graphql language-graphql object">user</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql property" style=color:black>id</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql operator" style=color:#b58a5e>...</span><span class="token template-string graphql language-graphql fragment function" style=color:black>ChildComponentFragment_user</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@defer</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">  </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">  </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">View</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">id</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">Suspense</span><span class="token plain"> fallback</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">data</span><span class="token operator" style=color:#b58a5e>?.</span><span class="token plain">user </span><span class="token operator" style=color:#b58a5e>&&</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">ChildComponent</span><span class="token plain"> user</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">data</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">user</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">Suspense</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">View</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>require</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'relay-test-utils'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Data Render with @defer'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">ParentComponent</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Wrapping in ReactTestRenderer.act will ensure that components</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// are fully updated to their final state.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> operation </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>getMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> mockData </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generateWithDefer</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token literal-property property" style=color:black>generateDeferredPayload</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token boolean" style=color:black>true</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolve</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">mockData</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// You may need this to make sure all payloads are retrieved</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    jest</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>runAllTimers</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// At this point operation will be resolved</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// and the data for a query will be available in the store</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toJSON</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toEqual</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>[</span><span class="token string" style=color:#65822b>'id'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'name'</span><span class="token punctuation" style=color:#b58a5e>]</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=fragment-component-tests>Fragment Component Tests<a href=#fragment-component-tests class=hash-link aria-label="Direct link to Fragment Component Tests" title="Direct link to Fragment Component Tests" translate=no>â€‹</a></h3>
<p>Essentially, in the example above, <code>resolveMostRecentOperation</code> will generate data for all child fragment containers (pagination, refetch). But, usually the root component may have many child fragment components and you may want to exercise a specific component that uses <code>useFragment</code>. The solution for that would be to wrap your fragment container with the <code>useLazyLoadQuery</code> component that renders a Query that spreads fragments from your fragment component:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Fragment'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style=color:black>TestRenderer</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> data </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useLazyLoadQuery</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>query</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql definition-query function" style=color:black>TestQuery</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@relay_test_operation</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>myData</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql property-query">node</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>id</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql string" style=color:#65822b>"test-id"</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">            </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Spread the fragment you want to test here</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">            </span><span class="token template-string graphql language-graphql operator" style=color:#b58a5e>...</span><span class="token template-string graphql language-graphql fragment function" style=color:black>MyFragment</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyFragmentComponent</span><span class="token plain"> myData</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">data</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">myData</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">Suspense</span><span class="token plain"> fallback</span><span class="token operator" style=color:#b58a5e>=</span><span class="token string" style=color:#65822b>"Loading..."</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">TestRenderer</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">Suspense</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Wrapping in ReactTestRenderer.act will ensure that components</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// are fully updated to their final state.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolveMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">operation</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">renderer</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toMatchSnapshot</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=pagination-component-test>Pagination Component Test<a href=#pagination-component-test class=hash-link aria-label="Direct link to Pagination Component Test" title="Direct link to Pagination Component Test" translate=no>â€‹</a></h3>
<p>Essentially, tests for pagination components (e.g. using <code>usePaginationFragment</code>) are not different from fragment component tests. But we can do more here, we can actually see how the pagination works - we can assert the behavior of our components when performing pagination (load more, refetch).</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token comment" style=color:#999988;font-style:italic>// Pagination Example</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'`Pagination` Container'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style=color:black>TestRenderer</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> data </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useLazyLoadQuery</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>query</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql definition-query function" style=color:black>TestQuery</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@relay_test_operation</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>myConnection</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql property-query">node</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>id</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql string" style=color:#65822b>"test-id"</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">            </span><span class="token template-string graphql language-graphql object">connection</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">              </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Spread the pagination fragment you want to test here</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">              </span><span class="token template-string graphql language-graphql operator" style=color:#b58a5e>...</span><span class="token template-string graphql language-graphql fragment function" style=color:black>MyConnectionFragment</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">            </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyPaginationContainer</span><span class="token plain"> connection</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">data</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">myConnection</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">connection</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">Suspense</span><span class="token plain"> fallback</span><span class="token operator" style=color:#b58a5e>=</span><span class="token string" style=color:#65822b>"Loading..."</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">TestRenderer</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">Suspense</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Wrapping in ReactTestRenderer.act will ensure that components</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// are fully updated to their final state.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolveMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">operation</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token constant" style=color:black>ID</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">_</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> generateId</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic>// Why we're doing this?</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic>// To make sure that we will generate a different set of ID</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic>// for elements on first page and the second page.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string string" style=color:#65822b>first-page-id-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#b58a5e>${</span><span class="token template-string interpolation function" style=color:black>generateId</span><span class="token template-string interpolation punctuation" style=color:#b58a5e>(</span><span class="token template-string interpolation punctuation" style=color:#b58a5e>)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#b58a5e>}</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token function maybe-class-name" style=color:black>PageInfo</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">            </span><span class="token literal-property property" style=color:black>has_next_page</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token boolean" style=color:black>true</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Let's find a `loadMore` button and click on it to initiate pagination request, for example</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> loadMore </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">root</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>find</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> node</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>[</span><span class="token string" style=color:#65822b>'data-testid'</span><span class="token punctuation" style=color:#b58a5e>]</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'loadMore'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">loadMore</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">disabled</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBe</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token boolean" style=color:black>false</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  loadMore</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>onClick</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Wrapping in ReactTestRenderer.act will ensure that components</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// are fully updated to their final state.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolveMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">operation</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token constant" style=color:black>ID</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">_</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> generateId</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token comment" style=color:#999988;font-style:italic>// See, the second page IDs will be different</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string string" style=color:#65822b>second-page-id-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#b58a5e>${</span><span class="token template-string interpolation function" style=color:black>generateId</span><span class="token template-string interpolation punctuation" style=color:#b58a5e>(</span><span class="token template-string interpolation punctuation" style=color:#b58a5e>)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#b58a5e>}</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token function maybe-class-name" style=color:black>PageInfo</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">            </span><span class="token comment" style=color:#999988;font-style:italic>// And the button should be disabled, now. Probably.</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">            </span><span class="token literal-property property" style=color:black>has_next_page</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token boolean" style=color:black>false</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">          </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">loadMore</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">disabled</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBe</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token boolean" style=color:black>true</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=refetch-component>Refetch Component<a href=#refetch-component class=hash-link aria-label="Direct link to Refetch Component" title="Direct link to Refetch Component" translate=no>â€‹</a></h3>
<p>We can use similar approach here with wrapping the component with a query. And for the sake of completeness, we will add an example here:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Refetch Container'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style=color:black>TestRenderer</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> data </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useLazyLoadQuery</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>query</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql definition-query function" style=color:black>TestQuery</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@relay_test_operation</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>myData</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql property-query">node</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>id</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql string" style=color:#65822b>"test-id"</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">            </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Spread the pagination fragment you want to test here</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">            </span><span class="token template-string graphql language-graphql operator" style=color:#b58a5e>...</span><span class="token template-string graphql language-graphql fragment function" style=color:black>MyRefetchableFragment</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyRefetchContainer</span><span class="token plain"> data</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">data</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">myData</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">Suspense</span><span class="token plain"> fallback</span><span class="token operator" style=color:#b58a5e>=</span><span class="token string" style=color:#65822b>"Loading..."</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">TestRenderer</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">Suspense</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token operator" style=color:#b58a5e>/</span><span class="token maybe-class-name">RelayEnvironmentProvider</span><span class="token operator" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolveMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">operation</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Assuming we have refetch button in the Container</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> refetchButton </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">root</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>find</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> node</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>[</span><span class="token string" style=color:#65822b>'data-testid'</span><span class="token punctuation" style=color:#b58a5e>]</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'refetch'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// This should trigger the `refetch`</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  refetchButton</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>onClick</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolveMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">operation</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>// We can customize mock resolvers, to change the output of the refetch query</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">renderer</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toMatchSnapshot</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=mutations>Mutations<a href=#mutations class=hash-link aria-label="Direct link to Mutations" title="Direct link to Mutations" translate=no>â€‹</a></h3>
<p>Mutations themselves are operations, so we can test them independently (unit-test) for a specific mutation, or in combination with the view from which this mutation is called.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>note</div><div class=admonitionContent_BuS1><p>the <code>useMutation</code> API is an improvement over calling <code>commitMutation</code> directly.</div></div>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token comment" style=color:#999988;font-style:italic>// Say, you have a mutation function</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:black>sendMutation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">environment</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> onCompleted</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> onError</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> variables</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>commitMutation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token literal-property property" style=color:black>mutation</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql operator" style=color:#b58a5e>...</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    onCompleted</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    onError</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    variables</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Example test may be written like so</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'it should send mutation'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> onCompleted </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> jest</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>fn</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>sendMutation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> onCompleted</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> jest</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>fn</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> operation </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>getMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>resolve</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      operation</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">onCompleted</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBeCalled</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=subscription>Subscription<a href=#subscription class=hash-link aria-label="Direct link to Subscription" title="Direct link to Subscription" translate=no>â€‹</a></h3>
<blockquote>
<p>The <code>useSubscription</code> API is an improvement over calling <code>requestSubscription</code> directly.</p>
</blockquote>
<p>We can test subscriptions similarly to how we test mutations.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token comment" style=color:#999988;font-style:italic>// Example subscribe function</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:black>subscribe</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">environment</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> onNext</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> onError</span><span class="token parameter punctuation" style=color:#b58a5e>,</span><span class="token parameter"> variables</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>requestSubscription</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token literal-property property" style=color:black>subscription</span><span class="token operator" style=color:#b58a5e>:</span><span class="token plain"> graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql operator" style=color:#b58a5e>...</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    onNext</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    onError</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    variables</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Example test may be written like so</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'it should subscribe'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> onNext </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> jest</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>fn</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>subscribe</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> onNext</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> jest</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>fn</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> operation </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>getMostRecentOperation</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>act</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>nextValue</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      operation</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">onNext</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBeCalled</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=example-with-queueoperationresolver>Example with <code>queueOperationResolver</code><a href=#example-with-queueoperationresolver class=hash-link aria-label="Direct link to example-with-queueoperationresolver" title="Direct link to example-with-queueoperationresolver" translate=no>â€‹</a></h3>
<p>With <code>queueOperationResolver</code> it is possible to define responses for operations that will be executed on the environment</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token comment" style=color:#999988;font-style:italic>// Say you have a component with the QueryRenderer</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token maybe-class-name">MyAwesomeViewRoot</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>require</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'MyAwesomeViewRoot'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>require</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'relay-test-utils'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Data Render'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>queueOperationResolver</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">operation</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token maybe-class-name">MockPayloadGenerator</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>generate</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">operation</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyAwesomeViewRoot</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// At this point operation will be resolved</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// and the data for a query will be available in the store</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">root</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>find</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">node</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> node</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>[</span><span class="token string" style=color:#65822b>'data-testid'</span><span class="token punctuation" style=color:#b58a5e>]</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'myButton'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBeDefined</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token function" style=color:black>test</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Error State'</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> environment </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>createMockEnvironment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  environment</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">mock</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>queueOperationResolver</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token string" style=color:#65822b>'Uh-oh'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> renderer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token maybe-class-name">ReactTestRenderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>create</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token operator" style=color:#b58a5e>&lt;</span><span class="token maybe-class-name">MyAwesomeViewRoot</span><span class="token plain"> environment</span><span class="token operator" style=color:#b58a5e>=</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">environment</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>/</span><span class="token operator" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token function" style=color:black>expect</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    renderer</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">root</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>find</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator" style=color:#b58a5e>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">item</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">props</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">testID</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token string" style=color:#65822b>'errorMessage'</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>toBeDefined</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=with-relay-hooks>With Relay Hooks<a href=#with-relay-hooks class=hash-link aria-label="Direct link to With Relay Hooks" title="Direct link to With Relay Hooks" translate=no>â€‹</a></h3>
<p>The examples in this guide should work for testing components both with Relay Hooks, Containers or Renderers. When writing tests that involve the <code>usePreloadedQuery</code> hook, please also see the <code>queuePendingOperation</code> note above.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=tomatchsnaphot>toMatchSnaphot(...)<a href=#tomatchsnaphot class=hash-link aria-label="Direct link to toMatchSnaphot(...)" title="Direct link to toMatchSnaphot(...)" translate=no>â€‹</a></h3>
<p>Even though in all of the examples here you can see assertions with <code>toMatchSnapshot()</code>, we keep it that way just to make examples concise. But it's not the recommended way to test your components.</p>
<p><strong><a href=https://testing-library.com/react target=_blank rel="noopener noreferrer" class="">React Testing Library</a></strong> is a set of helpers that let you test React components without relying on their implementation details. This approach makes refactoring a breeze and also nudges you towards best practices for accessibility. Although it doesn't provide a way to "shallowly" render a component without its children, a test runner like Jest lets you do this by <a href=https://reactjs.org/docs/testing-recipes.html#mocking-modules target=_blank rel="noopener noreferrer" class="">mocking</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=more-examples>More Examples<a href=#more-examples class=hash-link aria-label="Direct link to More Examples" title="Direct link to More Examples" translate=no>â€‹</a></h3>
<!-- -->
<p>The best source of example tests is in <a href=https://github.com/facebook/relay/tree/main/packages/relay-experimental/__tests__ target=_blank rel="noopener noreferrer" class="">the relay-experimental package</a>.</p>
<p>Testing is good. You should definitely do it.</p>
<div class=docsRating id=docsRating><hr/>Is this page useful?<svg class=i_thumbsup alt=Like id=docsRating-like xmlns=http://www.w3.org/2000/svg viewBox="0 0 81.13 89.76"><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"/></svg><svg class=i_thumbsdown alt=Dislike id=docsRating-dislike xmlns=http://www.w3.org/2000/svg viewBox="0 0 81.13 89.76"><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"/></svg><p>Help us make the site even better by<!-- --> <a href=https://www.surveymonkey.com/r/FYC9TCJ target=_blank rel="noopener noreferrer">answering a few quick questions</a>.</div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href=https://github.com/facebook/relay/tree/main/website/versioned_docs/version-v16.0.0/guides/testing-relay-components.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/v16.0.0/guides/client-schema-extensions/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Client Schema Extensions</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/v16.0.0/guides/testing-relay-with-preloaded-queries/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Testing Relay with Preloaded Queries</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#abstract class="table-of-contents__link toc-highlight">Abstract</a><li><a href=#testing-with-relay class="table-of-contents__link toc-highlight">Testing with Relay</a><li><a href=#relaymockenvironment-api-overview class="table-of-contents__link toc-highlight">RelayMockEnvironment API Overview</a><li><a href=#mock-payload-generator-and-the-relay_test_operation-directive class="table-of-contents__link toc-highlight">Mock Payload Generator and the <code>@relay_test_operation</code> Directive</a><ul><li><a href=#mock-resolver-context class="table-of-contents__link toc-highlight">Mock Resolver Context</a><li><a href=#id-generation class="table-of-contents__link toc-highlight">ID Generation</a><li><a href=#float-integer-boolean-etc class="table-of-contents__link toc-highlight">Float, Integer, Boolean, etc...</a><li><a href=#relay_test_operation class="table-of-contents__link toc-highlight">@relay_test_operation</a></ul><li><a href=#examples class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href=#relay-component-test class="table-of-contents__link toc-highlight">Relay Component Test</a><li><a href=#fragment-component-tests class="table-of-contents__link toc-highlight">Fragment Component Tests</a><li><a href=#pagination-component-test class="table-of-contents__link toc-highlight">Pagination Component Test</a><li><a href=#refetch-component class="table-of-contents__link toc-highlight">Refetch Component</a><li><a href=#mutations class="table-of-contents__link toc-highlight">Mutations</a><li><a href=#subscription class="table-of-contents__link toc-highlight">Subscription</a><li><a href=#example-with-queueoperationresolver class="table-of-contents__link toc-highlight">Example with <code>queueOperationResolver</code></a><li><a href=#with-relay-hooks class="table-of-contents__link toc-highlight">With Relay Hooks</a><li><a href=#tomatchsnaphot class="table-of-contents__link toc-highlight">toMatchSnaphot(...)</a><li><a href=#more-examples class="table-of-contents__link toc-highlight">More Examples</a></ul></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item target=_self href=/docs/>Introduction</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item target=_self href=/users/>User Showcase</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Legal</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://opensource.facebook.com/legal/privacy/ target=_blank rel="noopener noreferrer" class=footer__link-item>Privacy<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/terms/ target=_blank rel="noopener noreferrer" class=footer__link-item>Terms<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/data-policy/ target=_blank rel="noopener noreferrer" class=footer__link-item>Data Policy<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/cookie-policy/ target=_blank rel="noopener noreferrer" class=footer__link-item>Cookie Policy<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/relay.svg class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/img/relay.svg class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"/></div><div class=footer__copyright>Copyright Â© 2026 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div></body>