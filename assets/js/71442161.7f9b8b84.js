"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["69596"],{78265(e,n,t){t.r(n),t.d(n,{metadata:()=>a,default:()=>m,frontMatter:()=>d,contentTitle:()=>c,toc:()=>h,assets:()=>u});var a=JSON.parse('{"id":"guides/data-driven-dependencies/client-3d","title":"Client 3D","description":"Client side data driven dependencies (3D)","source":"@site/versioned_docs/version-v20.0.0/guides/data-driven-dependencies/client-3d.md","sourceDirName":"guides/data-driven-dependencies","slug":"/guides/data-driven-dependencies/client-3d/","permalink":"/docs/v20.0.0/guides/data-driven-dependencies/client-3d/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/relay/tree/main/website/versioned_docs/version-v20.0.0/guides/data-driven-dependencies/client-3d.md","tags":[],"version":"v20.0.0","frontMatter":{"id":"client-3d","title":"Client 3D","slug":"/guides/data-driven-dependencies/client-3d/","description":"Client side data driven dependencies (3D)","keywords":["3D","Client 3D","data driven dependencies","module","match","MatchContainer"]}}'),r=t(74848),l=t(28453),i=t(17352),o=t(78010),s=t(57250);let d={id:"client-3d",title:"Client 3D",slug:"/guides/data-driven-dependencies/client-3d/",description:"Client side data driven dependencies (3D)",keywords:["3D","Client 3D","data driven dependencies","module","match","MatchContainer"]},c,u={},h=[{value:"Example",id:"example",level:2},{value:"Schema",id:"schema",level:3},{value:"Relay Resolvers",id:"relay-resolvers",level:3},{value:"Component",id:"component",level:3},{value:"Limitations",id:"limitations",level:2}];function p(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Use client 3D when all the data fields used to render your 3D components are resolved by client-side ",(0,r.jsx)(n.a,{href:"../../relay-resolvers/introduction/",children:"Relay Resolvers"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.p,{children:"Here is an example of how Client 3D can be used in a React app."}),"\n",(0,r.jsx)(i.FbInternalOnly,{children:(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["For an example diff implementing Client 3D in a www repository, see"," ",(0,r.jsx)(n.a,{href:"https://internalfb.com/D62352682",children:"D62352682"}),"."]})})}),"\n",(0,r.jsx)(n.h3,{id:"schema",children:"Schema"}),"\n",(0,r.jsxs)(n.p,{children:["You have an interface ",(0,r.jsx)(n.code,{children:"IClient3D"})," that is a return type for a field on the query in your client schema extensions file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"type Client3DData {\n  type: String!\n  info: String!\n}\n\ninterface IClient3D {\n  id: ID!\n  data: Client3DData!\n}\n\nextend type Query {\n  client3D: IClient3D\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"relay-resolvers",children:"Relay Resolvers"}),"\n",(0,r.jsxs)(n.p,{children:["You have 3 Relay Resolvers that return concrete objects that implement the ",(0,r.jsx)(n.code,{children:"IClient3D"})," interface:"]}),"\n",(0,r.jsxs)(o.default,{children:[(0,r.jsx)(s.default,{value:"1",label:"Client3DBar",default:!0,children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"export type Client3DModel = {\n  __id: DataID,\n};\n\n/**\n * @RelayResolver Client3DBar implements IClient3D\n */\nfunction Client3DBar(id: DataID): ?Client3DModel {\n  if (id === INVALID_ID) {\n    return null;\n  }\n  return {\n    __id: id,\n  };\n}\n\n/**\n * @RelayResolver Client3DBar.data: Client3DData\n */\nfunction data(client3DModel: Client3DModel): Client3DData {\n  return {\n    type: 'BAR',\n    info: 'someBarInfo',\n  }\n}\n"})})}),(0,r.jsx)(s.default,{value:"2",label:"Client3DFoo",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"/**\n * @RelayResolver Client3DFoo implements IClient3D\n */\nfunction Client3DFoo(id: DataID): ?Client3DModel {\n  if (id === INVALID_ID) {\n    return null;\n  }\n  return {\n    __id: id,\n  };\n}\n\n/**\n * @RelayResolver Client3DFoo.data: Client3DData\n */\nfunction data(client3DModel: Client3DModel): Client3DData {\n  return {\n    type: 'FOO',\n    info: 'someFooInfo',\n  }\n}\n"})})}),(0,r.jsx)(s.default,{value:"3",label:"Client3DHelloWorld",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"/**\n * @RelayResolver Client3DHelloWorld implements IClient3D\n */\nfunction Client3DHelloWorld(id: DataID): ?Client3DModel {\n  if (id === INVALID_ID) {\n    return null;\n  }\n  return {\n    __id: id,\n  };\n}\n\n/**\n * @RelayResolver Client3DHelloWorld.data: Client3DData\n */\nfunction data(client3DModel: Client3DModel): Client3DData {\n  return {\n    type: 'HELLO_WORLD',\n    info: 'someHelloWorldInfo',\n  }\n}\n"})})})]}),"\n",(0,r.jsx)(n.h3,{id:"component",children:"Component"}),"\n",(0,r.jsx)(n.p,{children:"Before making use of Client 3D, your component will look something like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"component Client3DRelayRenderer() {\n  const CLIENT_3D_FRAGMENT = graphql`\n    fragment Client3DRelayRendererClient3DFragment on IClient3D {\n      data {\n        type\n        info\n      }\n    }\n  `;\n  const client3DData = useClientQuery(\n    graphql`\n      query Client3DRelayQuery {\n        client3D {\n          ...Client3DRelayRendererClient3DFragment\n        }\n      }\n    `\n  );\n\n  let component;\n  if (client3DData?.data?.type === 'FOO'):\n    component = <Client3DFooComponent data={client3DData.data} />\n  else if (client3DData?.data?.type === 'BAR'):\n    component = <Client3DBarComponent data={client3DData.data} />\n  else if (client3DData?.data?.type === 'HELLO_WORLD'):\n    component = <Client3DHelloWorldComponent data={client3DData.data} />\n\n  return (\n    component\n  );\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"In order to use Client 3D, you don't have to modify your Relay Resolvers or schema at all."}),"\n",(0,r.jsx)(n.p,{children:"Just modify your component in the following ways:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Declare separate fragments for each concrete type implementing ",(0,r.jsx)(n.code,{children:"IClient3D"})," that you're fetching. So\nin this example, these separate fragments are ",(0,r.jsx)(n.code,{children:"FOO_FRAGMENT"}),", ",(0,r.jsx)(n.code,{children:"BAR_FRAGMENT"}),", and ",(0,r.jsx)(n.code,{children:"HELLO_WORLD_FRAGMENT"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Add the ",(0,r.jsx)(n.code,{children:"@module"})," directive to your fragment, and include the name of the UI component corresponding\nto this fragment's data as an argument."]}),"\n",(0,r.jsxs)(n.li,{children:["Return the final component using Relay's ",(0,r.jsx)(n.code,{children:"MatchContainer"}),", providing the returned query data as a prop."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Notice that in Client 3D, just as in Server 3D, you cannot use ",(0,r.jsx)(n.code,{children:"@module"})," on multiple fragments on the SAME concrete type (but they can be on the same abstract type i.e. a union or an interface)."]}),"\n",(0,r.jsxs)(n.p,{children:["So in this example, ",(0,r.jsx)(n.code,{children:"Client3DFooComponent_Fragment"})," is on the concrete type ",(0,r.jsx)(n.code,{children:"Client3DFoo"}),", and ",(0,r.jsx)(n.code,{children:"Client3DBarComponent_Fragment"})," is on the concrete type ",(0,r.jsx)(n.code,{children:"Client3DBar"}),". If ",(0,r.jsx)(n.code,{children:"Client3DBarComponent_Fragment"})," was also on ",(0,r.jsx)(n.code,{children:"Client3DFoo"}),", the relay compiler would report an error. However, all three concrete types implement the same parent interface ",(0,r.jsx)(n.code,{children:"IClient3D"}),", which is fine."]}),"\n",(0,r.jsx)(i.FbInternalOnly,{children:(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you are in www, but not in Comet, you should use ",(0,r.jsx)(n.code,{children:"RelayFBMatchContainer"})," instead of ",(0,r.jsx)(n.code,{children:"MatchContainer"}),"."]})})}),"\n",(0,r.jsx)(n.p,{children:"After Client 3D, your component code should look something like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'const {graphql, useFragment, useClientQuery, MatchContainer} = require(\'react-relay\');\n\ncomponent Client3DRelayRenderer() {\n  const FOO_FRAGMENT = graphql`\n    fragment Client3DFooComponent_Fragment on Client3DFoo {\n      data {\n        type\n        info\n      }\n    }\n  `;\n  const BAR_FRAGMENT = graphql`\n    fragment Client3DBarComponent_Fragment on Client3DBar {\n      data {\n        type\n        info\n      }\n    }\n  `;\n  const HELLO_WORLD_FRAGMENT = graphql`\n    fragment Client3DHelloWorldComponent_Fragment on Client3DHelloWorld {\n      data {\n        type\n        info\n      }\n    }\n  `;\n  const client3DData = useClientQuery(\n    graphql`\n      query Client3DRelayQuery {\n        client3D {\n          ...Client3DFooComponent_Fragment\n            @module(name: "Client3DFooComponent.react")\n          ...Client3DBarComponent_Fragment\n            @module(name: "Client3DBarComponent.react")\n          ...Client3DHelloWorldComponent_Fragment\n            @module(name: "Client3DHelloWorldComponent.react")\n        }\n      }\n    `\n  );\n  return (\n    <MatchContainer match={client3DData.client3D} />\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,r.jsx)(n.p,{children:"While Client 3D can offer many benefits such as a more intuitive developer experience, enhanced maintanability, and faster performance, it also has some limitations that Server 3D does not."}),"\n",(0,r.jsx)(n.p,{children:"One key difference is the number of round trips required to fetch data. Server 3D requires at most two round trips: one to the server for data and one to the CDN. In contrast, Client 3D evaluates resolver code as part of rendering the component, which means that the client needs to render the component to discover what JavaScript code is needed. This can lead to additional round trips, especially when dealing with nested Client 3D usage."}),"\n",(0,r.jsx)(n.p,{children:"For example, consider a blog entry that uses Client 3D to render either a photo blog post or text blog post. The text blog post then uses Client 3D again to determine what type of text presentation format should be used. This can result in nested Client 3D usage, leading to multiple round trips."}),"\n",(0,r.jsx)(n.p,{children:"Relay is working on solutions to this drawback at the moment, but they have not been productionized yet. Hence, when using Client 3D please make sure that you're not using it in a nested manner to avoid performance degradation."})]})}function m(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},57250(e,n,t){t.r(n),t.d(n,{default:()=>l});var a=t(74848);t(96540);var r=t(18215);function l({children:e,hidden:n,className:t}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)("tabItem_Ymn6",t),hidden:n,children:e})}},78010(e,n,t){t.r(n),t.d(n,{default:()=>v});var a=t(74848),r=t(96540),l=t(18215),i=t(88287),o=t(28584),s=t(99770),d=t(99989),c=t(96629),u=t(80618),h=t(41367);function p(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}var D=t(19863);function f({className:e,block:n,selectedValue:t,selectValue:r,tabValues:i}){let s=[],{blockElementScrollPositionUntilNextRender:d}=(0,o.a_)(),c=e=>{let n=e.currentTarget,a=i[s.indexOf(n)].value;a!==t&&(d(n),r(a))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{let t=s.indexOf(e.currentTarget)+1;n=s[t]??s[0];break}case"ArrowLeft":{let t=s.indexOf(e.currentTarget)-1;n=s[t]??s[s.length-1]}}n?.focus()};return(0,a.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:r})=>(0,a.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{s.push(e)},onKeyDown:u,onClick:c,...r,className:(0,l.A)("tabs__item","tabItem_LNqP",r?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function C({lazy:e,children:n,selectedValue:t}){let i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){let e=i.find(e=>e.props.value===t);return e?(0,r.cloneElement)(e,{className:(0,l.A)("margin-top--md",e.props.className)}):null}return(0,a.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function y(e){let n=function(e){let n,{defaultValue:t,queryString:a=!1,groupId:l}=e,i=function(e){let{values:n,children:t}=e;return(0,r.useMemo)(()=>{let e=n??p(t).map(({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a})),a=(0,u.XI)(e,(e,n)=>e.value===n.value);if(a.length>0)throw Error(`Docusaurus error: Duplicate values "${a.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[n,t])}(e),[o,D]=(0,r.useState)(()=>(function({defaultValue:e,tabValues:n}){if(0===n.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}let t=n.find(e=>e.default)??n[0];if(!t)throw Error("Unexpected error: 0 tabValues");return t.value})({defaultValue:t,tabValues:i})),[f,C]=function({queryString:e=!1,groupId:n}){let t=(0,s.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(a),(0,r.useCallback)(e=>{if(!a)return;let n=new URLSearchParams(t.location.search);n.set(a,e),t.replace({...t.location,search:n.toString()})},[a,t])]}({queryString:a,groupId:l}),[y,v]=function({groupId:e}){let n=e?`docusaurus.tab.${e}`:null,[t,a]=(0,h.Dv)(n);return[t,(0,r.useCallback)(e=>{n&&a.set(e)},[n,a])]}({groupId:l}),x=m({value:n=f??y,tabValues:i})?n:null;return(0,d.A)(()=>{x&&D(x)},[x]),{selectedValue:o,selectValue:(0,r.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw Error(`Can't select invalid tab value=${e}`);D(e),C(e),v(e)},[C,v,i]),tabValues:i}}(e);return(0,a.jsxs)("div",{className:(0,l.A)(i.G.tabs.container,"tabs-container","tabList__CuJ"),children:[(0,a.jsx)(f,{...n,...e}),(0,a.jsx)(C,{...n,...e})]})}function v(e){let n=(0,D.default)();return(0,a.jsx)(y,{...e,children:p(e.children)},String(n))}},28453(e,n,t){t.d(n,{R:()=>i,x:()=>o});var a=t(96540);let r={},l=a.createContext(r);function i(e){let n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);