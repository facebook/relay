<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">One post tagged with &quot;relay-compiler&quot; | Relay</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://relay.dev/img/relay.png"><meta data-rh="true" name="twitter:image" content="https://relay.dev/img/relay.png"><meta data-rh="true" property="og:url" content="https://relay.dev/blog/tags/relay-compiler/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="One post tagged with &quot;relay-compiler&quot; | Relay"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://relay.dev/blog/tags/relay-compiler/"><link data-rh="true" rel="alternate" href="https://relay.dev/blog/tags/relay-compiler/" hreflang="en"><link data-rh="true" rel="alternate" href="https://relay.dev/blog/tags/relay-compiler/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UBPJPW35NS-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Relay RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Relay Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-DCSC7FDGL5","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DCSC7FDGL5"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DCSC7FDGL5",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Relay" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.3fffda90.css">
<link rel="preload" href="/assets/js/runtime~main.de535efd.js" as="script">
<link rel="preload" href="/assets/js/main.509dd6b3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Relay</b></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/help/">Help</a><a href="https://github.com/facebook/relay" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/">v20.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next ðŸš§</a></li><li><a class="dropdown__link" href="/docs/">v20.0.0</a></li><li><a class="dropdown__link" href="/docs/v19.0.0/">v19.0.0</a></li><li><a class="dropdown__link" href="/docs/v18.0.0/">v18.0.0</a></li><li><a class="dropdown__link" href="/docs/v17.0.0/">v17.0.0</a></li><li><a class="dropdown__link" href="/docs/v16.0.0/">v16.0.0</a></li><li><a class="dropdown__link" href="/docs/v15.0.0/">v15.0.0</a></li><li><a class="dropdown__link" href="/docs/v14.0.0/">v14.0.0</a></li><li><a class="dropdown__link" href="/docs/v13.0.0/">v13.0.0</a></li><li><a class="dropdown__link" href="/versions/">All versions</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/06/13/relay-20/">Relay v20.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/04/02/relay-19/">Relay v19.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/10/24/how-relay-enables-optimal-data-fetching/">How Relay Enables Optimal Data Fetching</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/30/relay-15/">Relay v15.0</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/03/resilient-relay-apps/">Resilient Relay Applications</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;relay-compiler&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="Introducing the new Relay compiler"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2021/12/08/introducing-the-new-relay-compiler/">Introducing the new Relay compiler</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-08T00:00:00.000Z" itemprop="datePublished">December 8, 2021</time> Â· <!-- -->12 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Robert Balicki, Tianyu Yao &amp; Andrey Lunyov</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>We&#x27;re extremely excited to release a preview of the new, Rust-based Relay compiler to open source today (as <a href="https://github.com/facebook/relay/releases/tag/v13.0.0-rc.1" target="_blank" rel="noopener noreferrer"><code>v13.0.0-rc.1</code></a>)! This new compiler is faster, supports new runtime features, and provides a strong foundation for additional growth in the future.</p><p>Leading up to this release, Meta&#x27;s codebase had been growing without signs of stopping. At our scale, the time it took to compile all of the queries in our codebase was increasing at the direct expense of developer productivity. Though we tried a number of strategies to optimize our JavaScript-based compiler (discussed below), our ability to incrementally eke out performance gains could not keep up with the growth in the number of queries in our codebase.</p><p>So, we decided to rewrite the compiler in Rust. We chose Rust because it is fast, memory-safe, and makes it easy to safely share large data structures across threads. Development began in early 2020, and the compiler shipped internally at the end of that year. The rollout was smooth, with no interruptions to application development. Initial internal benchmarks indicated that the compiler performed nearly 5x better on average, and nearly 7x better at P95. We&#x27;ve further improved the performance of the compiler since then.</p><p>This post will explore why Relay has a compiler, what we hope to unlock with the new compiler, its new features, and why we chose to use the Rust language. If you&#x27;re in a hurry to get started using the new compiler, check out <a href="https://github.com/facebook/relay/tree/main/packages/relay-compiler" target="_blank" rel="noopener noreferrer">the compiler package README</a> or the <a href="https://github.com/facebook/relay/releases/tag/v13.0.0-rc.1" target="_blank" rel="noopener noreferrer">release notes</a> instead!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-does-relay-have-a-compiler">Why does Relay have a compiler?<a href="#why-does-relay-have-a-compiler" class="hash-link" aria-label="Direct link to Why does Relay have a compiler?" title="Direct link to Why does Relay have a compiler?">â€‹</a></h2><p>Relay has a compiler in order to provide stability guarantees and achieve great runtime performance.</p><p>To understand why, consider the workflow of using the framework. With Relay, developers use a declarative language called GraphQL to specify what data each component needs, but not how to get it. The compiler then stitches these components&#x27; data dependencies into queries that fetch all of the data for a given page and precomputes artifacts that give Relay applications such a high level of performance and stability.</p><p>In this workflow, the compiler</p><ul><li>allows components to be reasoned about in isolation, making large classes of bugs impossible, and</li><li>shifts as much work as possible to build time, significantly improving the runtime performance of applications that use Relay.</li></ul><p>Let&#x27;s interrogate each of these in turn.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="supporting-local-reasoning">Supporting local reasoning<a href="#supporting-local-reasoning" class="hash-link" aria-label="Direct link to Supporting local reasoning" title="Direct link to Supporting local reasoning">â€‹</a></h3><p>With Relay, a component specifies only its own data requirements through the use of GraphQL fragments. The compiler then stitches these components data dependencies into queries that fetch all of the data for a given page. Developers can focus on writing a component without worrying how its data dependencies fit into a larger query.</p><p>However, Relay takes this local reasoning a step further. The compiler also generates files that are used by the Relay runtime to read out just the data selected by a given component&#x27;s fragment (we call this <a href="https://relay.dev/docs/principles-and-architecture/thinking-in-relay/#data-masking" target="_blank" rel="noopener noreferrer">data masking</a>). So a component never accesses (in practice, not just at the type level!) any data that it didn&#x27;t explicitly request.</p><p>Thus, modifying one component&#x27;s data dependencies cannot affect the data another component sees, meaning that <strong>developers can reason about components in isolation.</strong> This gives Relay apps an unparalleled level of stability and makes large classes of bugs impossible, and is a key part of why Relay can scale to many developers touching the same codebase.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="improved-runtime-performance">Improved runtime performance<a href="#improved-runtime-performance" class="hash-link" aria-label="Direct link to Improved runtime performance" title="Direct link to Improved runtime performance">â€‹</a></h3><p>Relay also makes use of the compiler to shift as much work as possible to build time, improving the performance of Relay apps.</p><p>Because the Relay compiler has global knowledge of all components&#x27; data dependencies, it is able to write queries that are as good â€” and generally even better â€” than they would be if they had been written by hand. It&#x27;s able to do this by optimizing queries in ways that would be impractically slow at runtime. For example, it prunes branches that can never be accessed from the generated queries and flattens identical sections of queries.</p><p>And because these queries are generated at build time, Relay applications never generate abstract syntax trees (ASTs) from GraphQL fragments, manipulate those ASTs, or generate query text at runtime. Instead, the Relay compiler replaces an application&#x27;s GraphQL fragments with precomputed, optimized instructions (as plain ol&#x27; Javascript data structures) that describe how to write network data to the store and read it back out.</p><p>An added benefit of this arrangement is that a Relay application bundle includes neither the schema nor â€” when using persisted queries â€” the string representation of the GraphQL fragments. This helps to reduce application size, saving users&#x27; bandwidth and improving application performance.</p><p>In fact, the new compiler goes further and saves users&#x27; bandwidth in another way â€” Relay can inform an application&#x27;s server about each query text at build time and generate a unique query ID, meaning that the application never needs to send the potentially very long query string over users&#x27; slow networks. When using such persisted queries, the only things that must be sent over the wire to make a network request are the query ID and the query variables!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-does-the-new-compiler-enable">What does the new compiler enable?<a href="#what-does-the-new-compiler-enable" class="hash-link" aria-label="Direct link to What does the new compiler enable?" title="Direct link to What does the new compiler enable?">â€‹</a></h2><p>Compiled languages are sometimes perceived as introducing friction and slowing developers down when compared to dynamic languages. However, Relay takes advantage of the compiler to reduce friction and make common developer tasks easier. For example, Relay exposes high-level primitives for common interactions that are easy to get subtly wrong, such as pagination and refetching a query with new variables.</p><p>What these interactions have in common is that they require generating a new query from an old one, and thus involve boilerplate and duplication â€” an ideal target for automation. Relay takes advantage of the compiler&#x27;s global knowledge to empower developers to enable pagination and refetching by adding one directive and changing one function call. That&#x27;s it.</p><p><strong>But giving developers the ability to easily add pagination is just the tip of the iceberg.</strong> Our vision for the compiler is that it provides even more high-level tools for shipping features and avoiding boilerplate, gives developers real-time assistance and insights, and is made up of parts that can be used by other tools for working with GraphQL.</p><p>A primary goal of this project was that the rewritten compiler&#x27;s architecture should set us up to achieve this vision over the coming years.</p><p>And while we&#x27;re not there yet, we have made significant achievements on each of the criteria.</p><p>For example, the new compiler ships with support for the new <code>@required</code> directive, which will nullify the parent linked field or throw an error if a given subfield is null when read out. This may sound like a trivial quality-of-life improvement, but if half of your component&#x27;s code is null checks, <code>@required</code> starts to look pretty good!</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><mdxadmonitiontitle>A component without <code>@required</code></mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><div style="text-align:center;padding-top:1rem;padding-bottom:1rem"><img src="/assets/images/2021-12-08-introducing-the-new-relay-compiler-pre-required-34d7c573b373c37510cb92f5d5bac681.png" width="90%" alt="" title="A component with null-checking boilerplate"></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><mdxadmonitiontitle>And with <code>@required</code>:</mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><div style="text-align:center;padding-top:1rem;padding-bottom:1rem"><img src="/assets/images/2021-12-08-introducing-the-new-relay-compiler-post-required-5d8885970f034d798e022fa46fb6508a.png" width="90%" alt="" title="A component will less null-checking boilerplate, due to the use of the `@required` directive"></div></div></div><p>Next, the compiler powers an internal-only VSCode extension that autocompletes field names when you type and shows type information on hover, among many other features. We haven&#x27;t made it public, yet, but we hope to at some point! Our experience is that this VSCode extension makes working with GraphQL data much easier and more intuitive.</p><p>Lastly, the new compiler was written as a series of independent modules that can be reused by other GraphQL tools. We call this the Relay compiler platform. Internally, these modules are being reused for other code generation tools and for other GraphQL clients for different platforms.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="compiler-performance">Compiler performance<a href="#compiler-performance" class="hash-link" aria-label="Direct link to Compiler performance" title="Direct link to Compiler performance">â€‹</a></h2><p>So far, we&#x27;ve discussed why Relay has a compiler and what we hope the rewrite enables. But we haven&#x27;t discussed why we decided to rewrite the compiler in 2020: performance.</p><p>Prior to the decision to rewrite the compiler, the time it took to compile all of the queries in our codebase was gradually, but unrelentingly, slowing as our codebase grew. Our ability to eke out performance gains could not keep up with the growth in the number of queries in our codebase, and we saw no incremental way out of this predicament.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reaching-the-end-of-javascript">Reaching the end of JavaScript<a href="#reaching-the-end-of-javascript" class="hash-link" aria-label="Direct link to Reaching the end of JavaScript" title="Direct link to Reaching the end of JavaScript">â€‹</a></h3><p>The previous compiler was written in JavaScript. This was a natural choice of language for several reasons: it was the language with which our team had the most experience, the language in which the Relay runtime was written (allowing us to share code between the compiler and runtime), and the language in which the GraphQL reference implementation and our mobile GraphQL tools were written.</p><p>The compiler&#x27;s performance remained reasonable for quite some time: Node/V8 comes with a heavily-optimized JIT compiler and garbage collector, and can be quite fast if you&#x27;re careful (we were). But compilation times were growing.</p><p>We tried a number of strategies to keep up:</p><ul><li>We had made the compiler incremental. In response to a change, it only recompiled the dependencies that were affected by that change.</li><li>We had identified which transforms were slow (namely, flatten), and made the algorithmic improvements we could (such as adding memoization).</li><li>The official <code>graphql</code> npm package&#x27;s GraphQL schema representation took multiple gigabytes of memory to represent our schema, so we replaced it with a custom fork.</li><li>We made profiler-guided micro-optimizations in our hottest code paths. For example, we stopped using the <code>...</code> operator to clone and modify objects, instead preferring to explicitly list out the properties of objects when copying them. This preserved the object&#x27;s hidden class, and enabled the code to better JIT-optimized.</li><li>We restructured the compiler to shell out to multiple workers, with each worker handling a single schema. Projects with multiple schemas are uncommon outside of Meta, so even with this, most users would have been using a single-threaded compiler.</li></ul><p>These optimizations weren&#x27;t enough to keep pace with the rapid internal adoption of Relay.</p><p>The biggest challenge was that NodeJS does not support multithreaded programs with shared memory. The best one can do is to start multiple workers that communicate by passing messages.</p><p>This works well in some scenarios. For example, Jest employs this pattern and makes use of all cores when running tests of transforming files. This is a good fit because Jest doesn&#x27;t need to share much data or memory between processes.</p><p>On the other hand, our schema is simply too large to have multiple instances in memory, so there was simply no good way to efficiently parallelize the Relay compiler with more than one thread per schema in JavaScript.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deciding-on-rust">Deciding on Rust<a href="#deciding-on-rust" class="hash-link" aria-label="Direct link to Deciding on Rust" title="Direct link to Deciding on Rust">â€‹</a></h3><p>After we decided to rewrite the compiler, we evaluated many languages to see which would meet the needs of our project. We wanted a language that was fast, memory-safe and supported concurrency â€” preferably with concurrency bugs caught at build time, not at runtime. At the same time we wanted a language that was well-supported internally. This narrowed it down to a few choices:</p><ul><li>C++ met most of the criteria, but felt difficult to learn. And, the compiler doesn&#x27;t assist with safety as much as we&#x27;d like.</li><li>Java was probably also a decent choice. It can be fast and is multi-core, but provides less low-level control.</li><li>OCaml is a proven choice in the compiler space, but multi-threading is challenging.</li><li>Rust is fast, memory-safe, and supports concurrency. It makes it easy to safely share large data structures across threads. With the general excitement around Rust, some previous experience on our team, and usage by other teams at Facebook, this was our clear top choice.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="internal-rollout">Internal rollout<a href="#internal-rollout" class="hash-link" aria-label="Direct link to Internal rollout" title="Direct link to Internal rollout">â€‹</a></h2><p>Rust turned out to be a great fit! The team of mostly JavaScript developers found Rust easy to adopt. And, Rust&#x27;s advanced type system caught many errors at build time, helping us maintain a high velocity.</p><p>We began development in early 2020, and rolled out the compiler internally at the end of that year. Initial internal benchmarks indicated that the compiler performed nearly 5x better on average, and nearly 7x better at P95. We&#x27;ve further improved the performance of the compiler since then.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="release-in-oss">Release in OSS<a href="#release-in-oss" class="hash-link" aria-label="Direct link to Release in OSS" title="Direct link to Release in OSS">â€‹</a></h2><p>Today, we&#x27;re excited to publish the new version of the compiler, as part of the Relay v13. New compiler features include:</p><ul><li><a href="https://relay.dev/docs/guides/required-directive/" target="_blank" rel="noopener noreferrer">The <code>@required</code> directive.</a></li><li>The <code>@no_inline</code> directive, which can be used to prevent common fragments from being inlined, resulting in smaller generated files.</li><li>Validation for conflicting GraphQL fields, arguments and directives</li><li><a href="https://github.com/facebook/relay/pull/3182" target="_blank" rel="noopener noreferrer">Support for TypeScript type generation</a></li><li>Support for remote query persisting.</li></ul><p>You can find more information about the compiler in the <a href="https://github.com/facebook/relay/tree/main/packages/relay-compiler" target="_blank" rel="noopener noreferrer">README</a> and in the <a href="https://github.com/facebook/relay/releases/tag/v13.0.0-rc.1" target="_blank" rel="noopener noreferrer">release notes</a>!</p><p>We&#x27;re continuing to develop features within the compiler, such as giving developers the ability to access derived values on the graph, adding support for a more ergonomic syntax for updating local data, and fully fleshing out our VSCode extension, all of which we hope to release to open source. We&#x27;re proud of this release, but there&#x27;s still a lot more to come!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="thanks">Thanks<a href="#thanks" class="hash-link" aria-label="Direct link to Thanks" title="Direct link to Thanks">â€‹</a></h2><p>Thank you Joe Savona, Lauren Tan, Jason Bonta and Jordan Eldredge for providing amazing feedback on this blog post. Thank you ch1ffa, robrichard, orta and sync for filing issues related to compiler bugs. Thank you to MaartenStaa for adding TypeScript support. Thank you @andrewingram for pointing out how difficult it is to enable the <code>@required</code> directive, which is now enabled by default. There are many others that contributed â€” this was truly a community effort!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/relay-compiler/">relay-compiler</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rust/">rust</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/required/">required</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/users/">User Showcase</a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/relay.svg" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/relay.svg" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright Â© 2025 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.de535efd.js"></script>
<script src="/assets/js/main.509dd6b3.js"></script>
</body>
</html>