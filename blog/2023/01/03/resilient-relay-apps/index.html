<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Resilient Relay Applications | Relay</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:image content=https://relay.dev/img/relay.png /><meta data-rh=true name=twitter:image content=https://relay.dev/img/relay.png /><meta data-rh=true property=og:url content=https://relay.dev/blog/2023/01/03/resilient-relay-apps/ /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docusaurus_tag content=default /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docsearch:docusaurus_tag content=default /><meta data-rh=true property=og:title content="Resilient Relay Applications | Relay"/><meta data-rh=true name=description content="Resilient Relay Applications"/><meta data-rh=true property=og:description content="Resilient Relay Applications"/><meta data-rh=true property=og:type content=article /><meta data-rh=true property=article:published_time content=2023-01-03T00:00:00.000Z /><link data-rh=true rel=icon href=/img/favicon.png /><link data-rh=true rel=canonical href=https://relay.dev/blog/2023/01/03/resilient-relay-apps/ /><link data-rh=true rel=alternate href=https://relay.dev/blog/2023/01/03/resilient-relay-apps/ hreflang=en /><link data-rh=true rel=alternate href=https://relay.dev/blog/2023/01/03/resilient-relay-apps/ hreflang=x-default /><link data-rh=true rel=preconnect href=https://UBPJPW35NS-dsn.algolia.net crossorigin=anonymous /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://relay.dev/blog/2023/01/03/resilient-relay-apps","@type":"BlogPosting","author":{"@type":"Person","name":"Ernie Turner"},"datePublished":"2023-01-03T00:00:00.000Z","description":"Resilient Relay Applications","headline":"Resilient Relay Applications","isPartOf":{"@id":"https://relay.dev/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://relay.dev/blog/2023/01/03/resilient-relay-apps","name":"Resilient Relay Applications","url":"https://relay.dev/blog/2023/01/03/resilient-relay-apps"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Relay RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Relay Atom Feed"><link rel=preconnect href=https://www.google-analytics.com><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-DCSC7FDGL5","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=preconnect href=https://www.google-analytics.com><link rel=preconnect href=https://www.googletagmanager.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-DCSC7FDGL5"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DCSC7FDGL5",{})</script><link rel=search type=application/opensearchdescription+xml title=Relay href=/opensearch.xml><link rel=stylesheet href=/assets/css/styles.deec89cd.css /><script src=/assets/js/runtime~main.a8bcdfc7.js defer></script><script src=/assets/js/main.a2788f68.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id=internaldocs-banner></div><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top navbar--primary"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">Relay</b></a><a class="navbar__item navbar__link" href=/docs/>Docs</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog/>Blog</a><a class="navbar__item navbar__link" href=/help/>Help</a><a href=https://github.com/facebook/relay target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class=navbar__link aria-haspopup=true aria-expanded=false role=button href=/docs/>v20.1.0</a><ul class=dropdown__menu><li><a class=dropdown__link href=/docs/next/>Next üöß</a><li><a class=dropdown__link href=/docs/>v20.1.0</a><li><a class=dropdown__link href=/docs/v20.0.0/>v20.0.0</a><li><a class=dropdown__link href=/docs/v19.0.0/>v19.0.0</a><li><a class=dropdown__link href=/docs/v18.0.0/>v18.0.0</a><li><a class=dropdown__link href=/docs/v17.0.0/>v17.0.0</a><li><a class=dropdown__link href=/docs/v16.0.0/>v16.0.0</a><li><a class=dropdown__link href=/docs/v15.0.0/>v15.0.0</a><li><a class=dropdown__link href=/docs/v14.0.0/>v14.0.0</a><li><a class=dropdown__link href=/docs/v13.0.0/>v13.0.0</a><li><a class=dropdown__link href=/versions/>All versions</a></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2025/06/13/relay-20/>Relay v20.0</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2025/04/02/relay-19/>Relay v19.0</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2023/10/24/how-relay-enables-optimal-data-fetching/>How Relay Enables Optimal Data Fetching</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2023/03/30/relay-15/>Relay v15.0</a><li class=sidebarItem__DBe><a aria-current=page class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href=/blog/2023/01/03/resilient-relay-apps/>Resilient Relay Applications</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>Resilient Relay Applications</h1><div class="container_mt6G margin-vert--md"><time datetime=2023-01-03T00:00:00.000Z>January 3, 2023</time> ¬∑ <!-- -->22 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><span class=authorName_yefp translate=no>Ernie Turner</span></div><div class=authorSocials_rSDt></div></div></div></div></div></header><div id=__blog-post-container class=markdown><div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>Guest Post</div><div class=admonitionContent_BuS1><p>This is a guest post written by Ernie Turner, a Staff Engineer at Coinbase. Coinbase has thoroughly adopted Relay in their applications and is a strong ally of the Relay Team. Last year they helped co-develop the <a href="https://marketplace.visualstudio.com/items?itemName=meta.relay" target=_blank rel="noopener noreferrer" class="">Relay VSCode extension</a>. Ernie has agreed to share this internal enginnering blog post with us.</div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=how-to-provide-the-best-experience-for-customers-during-service-disruptions>How to provide the best experience for customers during service disruptions<a href=#how-to-provide-the-best-experience-for-customers-during-service-disruptions class=hash-link aria-label="Direct link to How to provide the best experience for customers during service disruptions" title="Direct link to How to provide the best experience for customers during service disruptions" translate=no>‚Äã</a></h2>
<p>In a perfect world, none of the services at Coinbase would suffer outages, and all fields in our GraphQL schema would resolve correctly all the time. As this isn't practical, Coinbase applications should be resilient to downtime and minimize the impact on customers: a single service suffering downtime should not prevent users from using or interacting with an entire app. However, it's also important that we convey issues to users when our applications aren't working as expected. Showing error messages that convey downtime with retry buttons is a better experience than confusing users with missing content or UI they can't interact with.</p>
<p>This post will cover the common patterns and best practices for dealing with missing data in a Relay application.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=screen-architecture-and-error-boundaries>Screen Architecture and Error Boundaries<a href=#screen-architecture-and-error-boundaries class=hash-link aria-label="Direct link to Screen Architecture and Error Boundaries" title="Direct link to Screen Architecture and Error Boundaries" translate=no>‚Äã</a></h2>
<p>Before we discuss handling service downtime and failures in GraphQL queries, let's first discuss broader screen architecture and how React Error Boundaries can help create a better user experience when used correctly.</p>
<p>Like most things in life, Error Boundaries should be used in moderation. Let's look at a common screen in the Coinbase Retail app.</p>
<div style=text-align:center;padding-top:1rem;padding-bottom:1rem><img src=/assets/images/2023-01-03-resilient-relay-apps-asset-screen-8bf495a00add38597fe997cecd3791ff.png width=35% alt="" title="Asset detail screen"/></div>
<p>Any section in the above screen could fail to get the data required to render, but it's how we approach these failures that differentiates what experience a user has with our app. For example, only using a single screen-level ErrorBoundary for any failure causes the app to be unusable when any error occurs, regardless of the significance of that error. In contrast, wrapping each component in its own ErrorBoundary can create just as bad of an experience. Lastly, omitting components with errors entirely is as bad as the other two options. There is no one-size-fits-all approach, so let's break down each of these and explain why they create poor user experiences.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=full-screen-error>Full Screen Error<a href=#full-screen-error class=hash-link aria-label="Direct link to Full Screen Error" title="Direct link to Full Screen Error" translate=no>‚Äã</a></h3>
<div style=text-align:center;padding-top:1rem;padding-bottom:1rem><img src=/assets/images/2023-01-03-resilient-relay-apps-full-app-error-5ea0539d3141ab84d51f5768e2517676.png width=35% alt="" title="Full Screen Error"/></div>
<p>The UI above is Coinbase's full-screen error fallback that is displayed if a service is experiencing disruptions and we couldn't get the data necessary to render the components on this screen. In certain situations, this actually creates a good user experience. We may not be giving the user detailed information as to what happened, but in most situations providing the technical cause is not possible, nor would it improve the users' experience. However, we are telling them something isn't working correctly and giving them a clear Retry button to attempt to get the app working again.</p>
<p>If the reason we're showing this to the user is because we can't load something non-critical, like the asset price history graph or their watchlist status, we shouldn't take down the entire screen. Hiding the current price of bitcoin and preventing the user from trading, just because we can't tell them whether bitcoin is on their watchlist, is a negative user experience.</p>
<p>Another negative of this UI is that it hides all app navigation from the user. Even if we have a good reason to show the user a full screen error, that doesn't mean we should hide the rest of the app in the process. A user should still be able to navigate to a different screen. In practice, we should only show users a ‚Äúfull screen error‚Äù and not a ‚Äúfull app error‚Äù.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=error-messages-everywhere>Error Messages Everywhere<a href=#error-messages-everywhere class=hash-link aria-label="Direct link to Error Messages Everywhere" title="Direct link to Error Messages Everywhere" translate=no>‚Äã</a></h3>
<div style=text-align:center;padding-top:1rem;padding-bottom:1rem><img src=/assets/images/2023-01-03-resilient-relay-apps-errors-everywhere-0181401186dc69b371358f74ccc6b7db.png width=35% alt="" title="Error Messages Everywhere"/></div>
<p>The UI pictured above is, in many ways, worse. This is the opposite end of the previous experience and showing the user a full-screen error would be preferable. Error messages for the price history graph make sense, because the user would expect that UI to be on this screen, but if the user can't even see the price of bitcoin or find the Trade button, we really ought to show them the UI in the first screenshot (but with navigation) - as the core goal and purpose of this screen has been lost.</p>
<p>This image also demonstrates how ErrorBoundaries can be too prevalent. The entire price history graph with the time range selectors should only have a single error message, not one per time range.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=empty-fallbacks>Empty Fallbacks<a href=#empty-fallbacks class=hash-link aria-label="Direct link to Empty Fallbacks" title="Direct link to Empty Fallbacks" translate=no>‚Äã</a></h3>
<div style=text-align:center;padding-top:1rem;padding-bottom:1rem><img src=/assets/images/2023-01-03-resilient-relay-apps-empty-fallbacks-bdc4d221f15bc80db48505b71eaf0e60.png width=35% alt="" title="Empty Fallbacks"/></div>
<p>The UI above is just as bad as the example prior, In this case, our ErrorBoundaries fall back to empty content. For certain UI elements, this makes sense. The missing Share button next to the watchlist isn't critical for this UI, so omitting it makes sense. However, hiding the current price of bitcoin, the price history graph, and the Trade button makes the UI unusable and even somewhat misleading. Even users who don't use the app every day would know that something is off. We also aren't giving the user any option to retry any failures ‚Äîthe user just sees empty content with no way to recover.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=what-should-the-user-see-instead>What should the user see instead?<a href=#what-should-the-user-see-instead class=hash-link aria-label="Direct link to What should the user see instead?" title="Direct link to What should the user see instead?" translate=no>‚Äã</a></h3>
<p>The following two screenshots show an example of a better experience for the user. The first screenshot is what the user should see if we can't get the current price of bitcoin or if we can't determine whether the user is allowed to trade. The second screenshot would be a better experience for a user if we couldn't get the current change in the price of bitcoin or the price history.</p>
<div style=display:flex;justify-content:space-around><div style=text-align:center;padding-top:1rem;padding-bottom:1rem><img src=/assets/images/2023-01-03-resilient-relay-apps-full-screen-error-5d2a2ff3f60afd313c7da21b49006cf3.png width=90% alt="" title="Bummer, but at least I know something is wrong and can navigate to a different screen or try to refresh this screen."/></div><div style=text-align:center;padding-top:1rem;padding-bottom:1rem><img src=/assets/images/2023-01-03-resilient-relay-apps-missing-sparkline-4e908ee49044c181b875e97066c88649.png width=90% alt="" title="I wish I could see the price history, but at least I can still Trade or try to refresh the price history chart."/></div></div>
<p>All of this points to a need to classify sections of the UI on a screen: what is critical for the user's experience, what UI the user expects to see, and what supporting content is optional to the experience.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=critical-vs-expected-vs-optional-ui>Critical vs Expected vs Optional UI<a href=#critical-vs-expected-vs-optional-ui class=hash-link aria-label="Direct link to Critical vs Expected vs Optional UI" title="Direct link to Critical vs Expected vs Optional UI" translate=no>‚Äã</a></h2>
<p>Not all UI elements in an application screen are the same. Some portions of the UI are critical to the core purpose of the screen, others might just be more informational and helpful to users. For application design at Coinbase, we group UI elements into three categories, <strong>Critical</strong>, <strong>Expected</strong>, and <strong>Optional</strong>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=critical-ui-elements>Critical UI Elements<a href=#critical-ui-elements class=hash-link aria-label="Direct link to Critical UI Elements" title="Direct link to Critical UI Elements" translate=no>‚Äã</a></h3>
<p>The parts of a screen that define the core information or interaction a user has with the UI. Without these elements in the UI, the screen does not make sense, and if they were missing, users would be confused and/or angry, as it isn't clear why the app wasn't working as expected.</p>
<p>Suppose we can't load the data necessary to display these critical UI elements. In that case, we should show the user a full-screen error message explaining the problem (if possible) with a retry button that lets them easily attempt to re-request the missing data.</p>
<p>Letting users interact with an application that is missing critical UI elements will cause confusion, anger, and even possible loss of funds if the user is able to complete a transaction without knowing the full details of what is happening.</p>
<p>Examples of Critical UI elements:</p>
<ul>
<li class="">The user's current portfolio balance on the Coinbase app home screen</li>
<li class="">The Asset Price, Payment Method, and total Purchase Price on the order preview screen</li>
<li class="">The user's lifetime earnings and earnings per asset on the Earn screen</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=expected-ui-elements>Expected UI Elements<a href=#expected-ui-elements class=hash-link aria-label="Direct link to Expected UI Elements" title="Direct link to Expected UI Elements" translate=no>‚Äã</a></h3>
<p>Expected UI elements are the parts of a screen that might not serve the core purpose of a screen, but that most users would expect to be present. If Expected UI elements are missing from a screen, the user is likely to think that something is wrong, but this wouldn't prevent them from performing the core actions of the screen.</p>
<p>If we can't load the data necessary to display these expected UI elements, we should show the user a component-local error message telling them that there is an expected UI that is missing. These error messages should also be accompanied by a retry button to let the user re-request the missing data. Localized errors have a higher chance of not being seen or interacted with by the user, which is somewhat acceptable since they aren't required for the core purpose of the screen.</p>
<p>Letting users interact with an application that is missing expected UI elements should be acceptable but it might cause confusion about what is happening. Completely omitting these UI elements without an accompanying error message would create a worse experience.</p>
<p>Examples of Expected UI elements:</p>
<ul>
<li class="">An asset's current price on the Buy Asset screen (where they enter the amount to buy)</li>
<li class="">The price history graph on an asset detail screen</li>
<li class="">A list of recent transactions on the Coinbase Card screen</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=optional-ui-elements>Optional UI Elements<a href=#optional-ui-elements class=hash-link aria-label="Direct link to Optional UI Elements" title="Direct link to Optional UI Elements" translate=no>‚Äã</a></h3>
<p>Optional UI elements are the parts of a screen that are purely supportive to the main purpose of a screen. Some users might notice these missing elements, but others might be completely unaware that they're supposed to be present at all. In either scenario, a user wouldn't be prevented from accomplishing their main goal on the screen.</p>
<p>If we can't load the data necessary to display these Optional UI elements, we should instead just omit them entirely from the UI. However, this comes with the following risks:</p>
<p>A. The user might not know that anything is missing
B. There won't be a way for the user to re-request the data for this UI unless they do a full screen refresh.</p>
<p>Developers should consider these downsides and ensure that they do not cause a negative user experience. Instead, these failures should be logged so that product engineers are notified when the user experience is less than ideal.</p>
<p>Examples of Optional UI Elements:</p>
<ul>
<li class="">Offer cards on the asset detail screen</li>
<li class="">Asset category sections on the Trade screen (New on Coinbase, Top Movers, etc.)</li>
<li class="">News feed on the Home Screen</li>
</ul>
<p>Let's return to the image above and classify the sections of the UI into these categories.</p>
<div style=text-align:center;padding-top:1rem;padding-bottom:1rem><img src=/assets/images/2023-01-03-resilient-relay-apps-sections-ff21f3c07349fa588b5ae74a1228ecee.png width=35% alt="" title="Red: critical, Orange: expected, Yellow: optional"/></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=element-classification-limits>Element Classification Limits<a href=#element-classification-limits class=hash-link aria-label="Direct link to Element Classification Limits" title="Direct link to Element Classification Limits" translate=no>‚Äã</a></h3>
<p>In the example above, we have a screen that has two critical components, two expected components, and one optional component. Most screens in an app should only have a handful of critical UI components on them. For some screens, the entire UI might be composed of one single critical component.</p>
<p>The same is true for expected elements. If we have a screen that's composed of five separate expected UI elements, we'd end up with the screenshot above with ‚ÄòTry Again' buttons littered across the app. Limit the number of expected elements and retry buttons on a single screen to only one or two if possible.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=pull-to-refresh>Pull To Refresh<a href=#pull-to-refresh class=hash-link aria-label="Direct link to Pull To Refresh" title="Direct link to Pull To Refresh" translate=no>‚Äã</a></h3>
<p>For all of the above scenarios, users on mobile apps should be able to pull-to-refresh to retry any failed request on a screen. With Relay applications, this will usually mean retrying the full screen-level query. If a screen has any error messages or hidden components because of missing data, using pull-to-refresh should always attempt to fix all of those error conditions.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=work-with-your-product-managers-and-designers>Work with your Product Managers and Designers<a href=#work-with-your-product-managers-and-designers class=hash-link aria-label="Direct link to Work with your Product Managers and Designers" title="Direct link to Work with your Product Managers and Designers" translate=no>‚Äã</a></h3>
<p>All of this classification is subjective ‚Äî and all of the examples above are just one opinion and a designer or PM may have different opinions on how screens should degrade. It is important for cross-functional alignment when designing application UI. Teams should consult engineers, designers, and product managers to ensure seamless and on-brand screens across your entire app.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=how-relay-can-help>How Relay Can Help<a href=#how-relay-can-help class=hash-link aria-label="Direct link to How Relay Can Help" title="Direct link to How Relay Can Help" translate=no>‚Äã</a></h2>
<p>Once you've classified your screen into sections, the next step is to add the proper ErrorBoundaries to your app and configure your components' GraphQL fragments depending on their classification. This is where <a href=https://relay.dev target=_blank rel="noopener noreferrer" class="">Relay</a> can help. Based on our experience working with Relay apps, we've created several best practices around how to deal with missing data from GraphQL queries.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=background>Background<a href=#background class=hash-link aria-label="Direct link to Background" title="Direct link to Background" translate=no>‚Äã</a></h3>
<p>Our goal at Coinbase is to work with a nullable schema as <a href=https://relay.dev/docs/guides/required-directive/#why-not-implement-this-at-the-schemaserver-level target=_blank rel="noopener noreferrer" class="">recommended by the Relay team</a>. The primary driver is that it puts the decision on how to handle service outages and missing query data in the hands of the client engineer. Without a nullable schema, the decision of what to do with missing data is made on the server (by bubbling up null values to the nearest nullable parent), and the client code has no recourse to change this decision.</p>
<p>This decision is buoyed by the existence of the <a href=https://relay.dev/docs/guides/required-directive/ target=_blank rel="noopener noreferrer" class="">Relay <code>@required</code> directive</a>, which allows client engineers to annotate their queries and fragments with directives that tell Relay how to handle missing data at runtime. This reduces boilerplate code that engineers would be required to write otherwise. On the surface, the directive seems very simple: it only comes with three options which are all pretty straightforward. However, when attempting to use this directive for various use cases, it becomes clear that the choice of which option to pick is not always obvious, nor is the decision of whether to use the directive at all.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=locality-of-required>Locality of @required<a href=#locality-of-required class=hash-link aria-label="Direct link to Locality of @required" title="Direct link to Locality of @required" translate=no>‚Äã</a></h3>
<p>One great feature of the <code>@required</code> directive is that it only affects the fragment in which you use it. It will never change the behavior of other fragments that query the same field. This allows you to add or remove the directive without thinking about anything outside your component's scope. This is important because different components may be categorized differently, even if they get data from the same query. Being able to mark fields in fragments of the same query with different <code>@required</code> arguments is important to help build ideal user experiences.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=using-action-log-vs-action-none>Using action: LOG vs action: NONE<a href=#using-action-log-vs-action-none class=hash-link aria-label="Direct link to Using action: LOG vs action: NONE" title="Direct link to Using action: LOG vs action: NONE" translate=no>‚Äã</a></h3>
<p>The <code>LOG</code> and <code>NONE</code> actions both have the same runtime behavior, but <code>LOG</code> will send a message to your logging mechanism of choice, logging the full path to the field that was returned as null. For most use cases where the <code>@required</code> directive is needed, <code>LOG</code> should be used over <code>NONE</code>. The only time <code>NONE</code> should be preferred is if a field is expected to be null for some users.</p>
<p>While the log entry created by using <code>action: LOG</code> isn't likely to be actionable on its own, however, it can be a useful signal as a breadcrumb for future errors. Being able to look at the history of an error and see that a specific field was unexpectedly null can help track down future errors the user might encounter in a workflow.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=when-to-use-requiredactionlognone>When to use <code>@required(action:LOG/NONE)</code><a href=#when-to-use-requiredactionlognone class=hash-link aria-label="Direct link to when-to-use-requiredactionlognone" title="Direct link to when-to-use-requiredactionlognone" translate=no>‚Äã</a></h3>
<p>The <code>LOG/NONE</code> actions should only be used on fields which are necessary to display Optional UI in your components. There are two distinct use cases that this shows up when designing your application</p>
<ol>
<li class="">Your component is Optional UI and shouldn't be rendered at all if a field or set of fields is null</li>
<li class="">A portion of your component is Optional UI and relies on an object type field where that object makes no sense without one or more of its child fields</li>
</ol>
<p>Let's look at a fragment that encompasses both of these use cases:</p>
<div class="language-graphql codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-graphql codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token keyword" style=color:#00009f>fragment</span><span class="token plain"> </span><span class="token fragment function" style=color:black>MyFragment</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>on</span><span class="token plain"> </span><span class="token class-name">Asset</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token property" style=color:black>id</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token property" style=color:black>name</span><span class="token plain"> </span><span class="token directive function" style=color:black>@required</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token attr-name" style=color:#2a6883>action</span><span class="token punctuation" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token constant" style=color:black>LOG</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token property" style=color:black>slug</span><span class="token plain"> </span><span class="token directive function" style=color:black>@required</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token attr-name" style=color:#2a6883>action</span><span class="token punctuation" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token constant" style=color:black>LOG</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token property" style=color:black>color</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token object">supply</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token property" style=color:black>total</span><span class="token plain"> </span><span class="token directive function" style=color:black>@required</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token attr-name" style=color:#2a6883>action</span><span class="token punctuation" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token constant" style=color:black>LOG</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token property" style=color:black>circulating</span><span class="token plain"> </span><span class="token directive function" style=color:black>@required</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token attr-name" style=color:#2a6883>action</span><span class="token punctuation" style=color:#b58a5e>:</span><span class="token plain"> </span><span class="token constant" style=color:black>LOG</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<p>For this fragment, we're saying that the entire fragment is invalid if we don't get the name or slug fields. If those fields are returned from the server as null, we can't render this component at all. This fragment also shows how to use the <code>@required(action: LOG/NONE)</code> directive to invalidate an entire object type field. This fragment says that if we don't have either of the <code>supply.total</code> or <code>supply.circulating</code> fields, then the entire supply object is itself invalid and should be null. This nullability will then be used to hide an optional portion of this component's UI.</p>
<p>Now let's see how our component will handle the results from this query:</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> asset </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useFragment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>fragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql fragment function" style=color:black>MyFragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>on</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql class-name">Asset</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql property" style=color:black>id</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql property" style=color:black>name</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>LOG</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql property" style=color:black>slug</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>LOG</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql property" style=color:black>color</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql object">supply</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql property" style=color:black>total</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>LOG</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql property" style=color:black>circulating</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>LOG</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">  </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  assetRef</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// If we couldn't get the required asset name or slug fields, hide this entire UI</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">asset </span><span class="token operator" style=color:#b58a5e>===</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// Otherwise hide certain portions of the UI if data is missing</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag class-name" style=color:#00009f>Title</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#2a6883>color</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#b58a5e>=</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>{</span><span class="token tag script language-javascript" style=color:#00009f>asset</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>color</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>}</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">name</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag class-name" style=color:#00009f>Title</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag class-name" style=color:#00009f>Subtitle</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">slug</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag class-name" style=color:#00009f>Subtitle</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">    </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">supply</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&&</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag class-name" style=color:#00009f>SupplyStats</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#2a6883>total</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#b58a5e>=</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>{</span><span class="token tag script language-javascript" style=color:#00009f>asset</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>supply</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>total</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#2a6883>circulating</span><span class="token tag script language-javascript script-punctuation punctuation" style=color:#b58a5e>=</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>{</span><span class="token tag script language-javascript" style=color:#00009f>asset</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>supply</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>.</span><span class="token tag script language-javascript property-access" style=color:#00009f>circulating</span><span class="token tag script language-javascript punctuation" style=color:#b58a5e>}</span><span class="token tag" style=color:#00009f> </span><span class="token tag punctuation" style=color:#b58a5e>/></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">  </span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><br/></span></code></pre></div></div>
<p>The <code>@required</code> directive really shines here because it removes complex null checks that we'd have to write otherwise. Instead of having to check whether both the <code>asset.name</code> or <code>asset.slug</code> fields are null, we can simply check if our entire fragment was nulled out and prevent rendering. The same is true when checking whether we should render the SupplyStats component. We only have to check whether the parent field is null in order to know that the two subfields are non-null.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=when-to-use-requiredaction>When to use @required(action<!-- -->:THROW<!-- -->)<a href=#when-to-use-requiredaction class=hash-link aria-label="Direct link to when-to-use-requiredaction" title="Direct link to when-to-use-requiredaction" translate=no>‚Äã</a></h3>
<p>Using <code>@required(action: THROW)</code> is more straightforward. This action should be used on fields that are necessary to render your Expected or Critical UI component. If these fields are returned as null from the server, your component should throw an error to the nearest ErrorBoundary and the user should see an error message.</p>
<p>How far up the tree your ErrorBoundary is depends on how much of the UI you want to remove if there's an error. For example, if we're showing the user an error instead of an asset price history graph, it doesn't make sense to keep the time series buttons still in view, that entire UI should disappear as well. But we don't want to take out the entire screen if this happens either.</p>
<p>Make sure your ErrorBoundary provides a mechanism for the user to retry the failed query to see if they can get the data on a subsequent attempt. We should always pair an error message with an actionable element to let the user recover. We shouldn't rely on the user being able (or knowing) to use the pull-to-refresh to reload the screen.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id=a-note-about-using-requiredaction-throw-on-fields-in-arrays>A note about using @required(action: THROW) on fields in arrays<a href=#a-note-about-using-requiredaction-throw-on-fields-in-arrays class=hash-link aria-label="Direct link to A note about using @required(action: THROW) on fields in arrays" title="Direct link to A note about using @required(action: THROW) on fields in arrays" translate=no>‚Äã</a></h4>
<p>You should almost never use the <code>THROW</code> action in a component that selects both an array field and fields of that array. As an example of what not to do:</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:black>Component</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"> assetPriceRef </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"> quotes </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useFragment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>fragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql fragment function" style=color:black>ComponentFragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>on</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql class-name">AssetPriceData</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql object">quotes</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Returns an array of items</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql property" style=color:black>timestamp</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql property" style=color:black>price</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>THROW</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    assetPriceRef</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<p>This component selects both the <code>quotes</code> array along with the <code>timestamp</code> and <code>price</code> fields on every item in that array. Putting <code>THROW</code> on the <code>quotes</code> field would be acceptable if we want to show the user an error if we don't get back any quotes. But, putting <code>THROW</code> on the <code>price</code> field would result in showing the user an error if even a single price field in that array was null. That's probably not the behavior we want. If we got back 23 of the 24 quotes for the past day correctly, we should probably still display the results we have and just omit the empty values instead.</p>
<p>Instead, we should use <code>action: LOG/NONE</code> so that we only invalidate a single item in the array instead of all items. We can then optionally filter out the null values in the array if needed.</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:black>Component</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"> assetPriceRef </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"> quotes </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useFragment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>fragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql fragment function" style=color:black>ComponentFragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>on</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql class-name">AssetPriceData</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql object">quotes</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Returns an array of items</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql property" style=color:black>timestamp</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">          </span><span class="token template-string graphql language-graphql property" style=color:black>price</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>LOG</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    assetPriceRef</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> validQuotes </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> quotes</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token method function property-access" style=color:black>filter</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain">removeNull</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id=when-not-to-use-required-on-a-field>When NOT to use @required on a field<a href=#when-not-to-use-required-on-a-field class=hash-link aria-label="Direct link to When NOT to use @required on a field" title="Direct link to When NOT to use @required on a field" translate=no>‚Äã</a></h3>
<p>The unhelpful answer to this question would be ‚Äúdon't use <code>@required</code> when a field isn't required‚Äù. That answer trivializes the decision of what is required and what isn't when the answer is usually more nuanced, especially when your fragment has a dozen fields or more. However, we can follow a number of best practices to decide whether to mark a field as required or not. Again, it is important that you work with your PMs and Designers to help you with these decisions.</p>
<p>There is also a fine line between when to omit the <code>@required</code> directive vs using it with the <code>LOG/NONE</code> action. The primary difference is that you should omit the <code>@required</code> directive when the UI rendered by that field is Optional UI.</p>
<p>Some components in your application can render a combination of different classifications of UI. For example, a single component might be responsible for displaying both the current price of an asset as well as what percent of users have bought or sold the asset over some time frame. This means the component is mixing both Critical UI (asset price) and Optional UI (buy/sell stats).</p>
<p>If a field is used to render optional content which can instead be omitted from the UI entirely without causing confusion for the user (remember, that's the definition of Optional UI) then you shouldn't use the <code>@required</code> directive on that field. Instead, you should add checks to your code to omit the UI if the field is null.</p>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:black>SomeComponent</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"> queryRef </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"> asset </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useFragment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">   </span><span class="token template-string graphql language-graphql object">asset</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">     </span><span class="token template-string graphql language-graphql property" style=color:black>latestQuote</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>THROW</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Required data</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">     </span><span class="token template-string graphql language-graphql property" style=color:black>buyPercent</span><span class="token template-string graphql language-graphql">  </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Optional data</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">   </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    queryRef</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">      </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text">Price: </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">latestQuote</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">      </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">buyPercent</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>!==</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&&</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">        </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">          </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text">Buy Percent: </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">buyPercent</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">          </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text">Sell Percent: </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token number" style=color:black>1</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>-</span><span class="token plain"> asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">buyPercent</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">        </span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">      </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<p>In this example it would be incorrect to use <code>@required(action: LOG/NONE)</code> on the <code>buyPercent</code> field because that would invalidate the entire fragment which isn't the behavior we want.</p>
<p>Another less common use case of when to omit the <code>@required</code> directive is when you can provide a safe fallback value. Providing a fallback/default value for a field can be very dangerous if done incorrectly. While there are a few cases where it's potentially safe to fall back to a default value, it's generally pretty rare and should be avoided. However, if you can provide a safe fallback value, you should avoid adding <code>@required</code> to that field and instead use a fallback value.</p>
<p>A couple of guidelines of when to provide a fallback value:</p>
<ul>
<li class="">Fallback values for numeric fields (numbers or strings that represent numbers) should not be used.<!-- -->
<ul>
<li class="">Using a 0 in place of a missing value will always create more confusion for the user. Coinbase is a financial company and if we can't display accurate values to users, we shouldn't be displaying them at all. Showing a user that their account balance is $0.00 is clearly much worse than showing them an error message. That's an obvious use case, but even places such as the price change percent for an asset, APY% for Coinbase Card, or the amount a user can make via Coinbase Earn should never show 0 if we don't have the actual value.</li>
</ul>
</li>
<li class="">Fallback values for boolean fields should be used with caution.<!-- -->
<ul>
<li class="">The first choice for a fallback for boolean fields is usually to set the field to false. Depending on what the boolean field represents, falling back to false can create a worse customer experience than showing the user an error. Falling back to false for a field like <code>isEligibleForOffer</code> is probably acceptable because that is likely showing Optional content. Falling back to false for a field like <code>hasCoinbaseOneSubscription</code> would not be acceptable because for a user who is a CoinbaseOne subscriber the content is Expected and the user is going to be confused about why that UI is missing in the app</li>
</ul>
</li>
<li class="">Falling back to an empty array for array fields should be used with caution.<!-- -->
<ul>
<li class="">If you're showing the user their list of Coinbase Card transactions, falling back to an empty array is a bad idea, but if you're showing the user a list of recently added assets, it's probably okay to fallback to an empty array to omit the UI from displaying since the component is already doing to have to deal with the case of the array being empty.</li>
</ul>
</li>
<li class="">String fields should usually just deal with null instead.<!-- -->
<ul>
<li class="">In some cases, you might want to fallback to an empty string for string fields that are returned as null, but usually this creates the same code path if you just leave the field as null. Most string fields in a schema aren't expected to be empty so falling back to an empty string can create negative user experiences where the user will be shown an empty string instead of actual content.</li>
</ul>
</li>
</ul>
<div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:black;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-tsx codeBlock_bY9V thin-scrollbar" style=color:black;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:black><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:black>SomeComponent</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"> queryRef </span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> asset </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> </span><span class="token function" style=color:black>useFragment</span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    graphql</span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>fragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql fragment function" style=color:black>MyFragment</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql keyword" style=color:#00009f>on</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql class-name">Asset</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>{</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql property" style=color:black>canTrade</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql directive function" style=color:black>@required</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>(</span><span class="token template-string graphql language-graphql attr-name" style=color:#2a6883>action</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>:</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql constant" style=color:black>THROW</span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>)</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Required data</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">        </span><span class="token template-string graphql language-graphql property" style=color:black>hasOfferToStake</span><span class="token template-string graphql language-graphql"> </span><span class="token template-string graphql language-graphql comment" style=color:#999988;font-style:italic># Optional data</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">      </span><span class="token template-string graphql language-graphql punctuation" style=color:#b58a5e>}</span><span class="token template-string graphql language-graphql"></span><br/></span><span class=token-line style=color:black><span class="token template-string graphql language-graphql">    </span><span class="token template-string template-punctuation string" style=color:#65822b>`</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    assetRef</span><span class="token punctuation" style=color:#b58a5e>,</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> showStakeOffer </span><span class="token operator" style=color:#b58a5e>=</span><span class="token plain"> asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">hasOfferToStake</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>??</span><span class="token plain"> </span><span class="token boolean" style=color:black>false</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#b58a5e>(</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">    </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">      </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">asset</span><span class="token punctuation" style=color:#b58a5e>.</span><span class="token property-access">canTrade</span><span class="token plain"> </span><span class="token operator" style=color:#b58a5e>&&</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag class-name" style=color:#00009f>Button</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text">Trade</span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag class-name" style=color:#00009f>Button</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">      </span><span class="token punctuation" style=color:#b58a5e>{</span><span class="token plain">showStakeOffer </span><span class="token operator" style=color:#b58a5e>&&</span><span class="token plain"> </span><span class="token tag punctuation" style=color:#b58a5e>&lt;</span><span class="token tag class-name" style=color:#00009f>Button</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain-text">Stake your currency</span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag class-name" style=color:#00009f>Button</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token punctuation" style=color:#b58a5e>}</span><span class="token plain-text"></span><br/></span><span class=token-line style=color:black><span class="token plain-text">    </span><span class="token tag punctuation" style=color:#b58a5e>&lt;/</span><span class="token tag" style=color:#00009f>div</span><span class="token tag punctuation" style=color:#b58a5e>></span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain">  </span><span class="token punctuation" style=color:#b58a5e>)</span><span class="token punctuation" style=color:#b58a5e>;</span><span class="token plain"></span><br/></span><span class=token-line style=color:black><span class="token plain"></span><span class="token punctuation" style=color:#b58a5e>}</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id=summary>Summary<a href=#summary class=hash-link aria-label="Direct link to Summary" title="Direct link to Summary" translate=no>‚Äã</a></h2>
<p>If you've taken anything away from this document, hopefully, it's that a lot of thought needs to go into how to handle downtime and service interruptions. Handling failure states is an important part of building world-class applications. Make sure your design and PM team are on the same page with your team when scoping out new features. If they don't give you advice on what to show the user when data is missing, push back to come to a consensus as a team on these decisions.</p>
<p>Relay can be a powerful tool in helping deal with application failures. Its granular ability to help you decide how to deal with failure might involve more work than you're used to. However, this extra effort pays off in the long run and goes a long way to improving customer experience with your applications.</div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/blog/2023/03/30/relay-15/><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>Relay v15.0</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/blog/2021/12/08/introducing-the-new-relay-compiler/><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>Introducing the new Relay compiler</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#how-to-provide-the-best-experience-for-customers-during-service-disruptions class="table-of-contents__link toc-highlight">How to provide the best experience for customers during service disruptions</a><li><a href=#screen-architecture-and-error-boundaries class="table-of-contents__link toc-highlight">Screen Architecture and Error Boundaries</a><ul><li><a href=#full-screen-error class="table-of-contents__link toc-highlight">Full Screen Error</a><li><a href=#error-messages-everywhere class="table-of-contents__link toc-highlight">Error Messages Everywhere</a><li><a href=#empty-fallbacks class="table-of-contents__link toc-highlight">Empty Fallbacks</a><li><a href=#what-should-the-user-see-instead class="table-of-contents__link toc-highlight">What should the user see instead?</a></ul><li><a href=#critical-vs-expected-vs-optional-ui class="table-of-contents__link toc-highlight">Critical vs Expected vs Optional UI</a><ul><li><a href=#critical-ui-elements class="table-of-contents__link toc-highlight">Critical UI Elements</a><li><a href=#expected-ui-elements class="table-of-contents__link toc-highlight">Expected UI Elements</a><li><a href=#optional-ui-elements class="table-of-contents__link toc-highlight">Optional UI Elements</a><li><a href=#element-classification-limits class="table-of-contents__link toc-highlight">Element Classification Limits</a><li><a href=#pull-to-refresh class="table-of-contents__link toc-highlight">Pull To Refresh</a><li><a href=#work-with-your-product-managers-and-designers class="table-of-contents__link toc-highlight">Work with your Product Managers and Designers</a></ul><li><a href=#how-relay-can-help class="table-of-contents__link toc-highlight">How Relay Can Help</a><ul><li><a href=#background class="table-of-contents__link toc-highlight">Background</a><li><a href=#locality-of-required class="table-of-contents__link toc-highlight">Locality of @required</a><li><a href=#using-action-log-vs-action-none class="table-of-contents__link toc-highlight">Using action: LOG vs action: NONE</a><li><a href=#when-to-use-requiredactionlognone class="table-of-contents__link toc-highlight">When to use <code>@required(action:LOG/NONE)</code></a><li><a href=#when-to-use-requiredaction class="table-of-contents__link toc-highlight">When to use @required(action)</a><li><a href=#when-not-to-use-required-on-a-field class="table-of-contents__link toc-highlight">When NOT to use @required on a field</a></ul><li><a href=#summary class="table-of-contents__link toc-highlight">Summary</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item target=_self href=/docs/>Introduction</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item target=_self href=/users/>User Showcase</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Legal</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://opensource.facebook.com/legal/privacy/ target=_blank rel="noopener noreferrer" class=footer__link-item>Privacy<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/terms/ target=_blank rel="noopener noreferrer" class=footer__link-item>Terms<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/data-policy/ target=_blank rel="noopener noreferrer" class=footer__link-item>Data Policy<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://opensource.facebook.com/legal/cookie-policy/ target=_blank rel="noopener noreferrer" class=footer__link-item>Cookie Policy<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=margin-bottom--sm><img src=/img/relay.svg class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"/><img src=/img/relay.svg class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"/></div><div class=footer__copyright>Copyright ¬© 2026 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div></body>