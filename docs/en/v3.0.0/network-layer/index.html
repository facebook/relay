<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Network Layer · Relay</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="In order to know how to access your GraphQL server, Relay Modern requires developers to provide an object implementing the `NetworkLayer` interface when creating an instance of a [Relay Environment](relay-environment.html). The environment uses this network layer to execute queries, mutations, and (if your server supports them) subscriptions. This allows developers to use whatever transport (HTTP, WebSockets, etc) and authentication is most appropriate for their application, decoupling the environment from the particulars of each application&#x27;s network configuration."/><meta name="docsearch:version" content="v3.0.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Network Layer · Relay"/><meta property="og:type" content="website"/><meta property="og:url" content="https://relay.dev/"/><meta property="og:description" content="In order to know how to access your GraphQL server, Relay Modern requires developers to provide an object implementing the `NetworkLayer` interface when creating an instance of a [Relay Environment](relay-environment.html). The environment uses this network layer to execute queries, mutations, and (if your server supports them) subscriptions. This allows developers to use whatever transport (HTTP, WebSockets, etc) and authentication is most appropriate for their application, decoupling the environment from the particulars of each application&#x27;s network configuration."/><meta property="og:image" content="https://relay.dev/img/relay.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://relay.dev/img/relay.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-50', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="/js/redirect.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><h2 class="headerTitle">Relay</h2></a><a href="/en/versions"><h3>v3.0.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/en/v3.0.0/introduction-to-relay" target="_self">Docs</a></li><li class=""><a href="/en/help" target="_self">Help</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/facebook/relay" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>API Reference</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/introduction-to-relay">Introduction to Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/installation-and-setup">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/quick-start-guide">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/graphql-in-relay">GraphQL in Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/relay-environment">Relay Environment</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/v3.0.0/network-layer">Network Layer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/query-renderer">QueryRenderer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/fragment-container">Fragment Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/refetch-container">Refetch Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/pagination-container">Pagination Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/mutations">Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/subscriptions">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/relay-store">Relay Store</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/fetch-query">fetchQuery</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/routing">Routing</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/relay-debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/graphql-server-specification">GraphQL Server Specification</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/persisted-queries">Persisted Queries</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/type-emission">Type Emission</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Migration Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/new-in-relay-modern">New in Relay Modern</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/relay-compat">Compatibility Mode</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/migration-setup">Migration Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/conversion-playbook">Conversion Playbook</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/conversion-scripts">Conversion Scripts</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/upgrading-setvariables">Upgrading setVariables</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/converting-mutations">Converting Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/compatibility-cheatsheet">Compatibility Cheatsheet</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/api-cheatsheet">API Cheatsheet</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Principles &amp; Architecture<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/thinking-in-graphql">Thinking in GraphQL</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/thinking-in-relay">Thinking In Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/architecture-overview">Architecture Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/compiler-architecture">Compiler Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/runtime-architecture">Runtime Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/videos">Videos</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Community<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v3.0.0/community-learning-resources">Community Learning Resources</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebook/relay/edit/master/docs/Modern-NetworkLayer.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Network Layer</h1></header><article><div><span><p>In order to know how to access your GraphQL server, Relay Modern requires developers to provide an object implementing the <code>NetworkLayer</code> interface when creating an instance of a <a href="relay-environment.html">Relay Environment</a>. The environment uses this network layer to execute queries, mutations, and (if your server supports them) subscriptions. This allows developers to use whatever transport (HTTP, WebSockets, etc) and authentication is most appropriate for their application, decoupling the environment from the particulars of each application's network configuration.</p>
<p>Currently the easiest way to create a network layer is via a helper from the <code>relay-runtime</code> package:</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> {
  Environment,
  Network,
  RecordSource,
  Store,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;relay-runtime&#x27;</span>;

<span class="hljs-comment">// Define a function that fetches the results of an operation (query/mutation/etc)</span>
<span class="hljs-comment">// and returns its results as a Promise:</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchQuery</span>(<span class="hljs-params">
  operation,
  variables,
  cacheConfig,
  uploadables,
</span>) </span>{
  <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">&#x27;/graphql&#x27;</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-comment">// Add authentication and other headers here</span>
      <span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({
      <span class="hljs-attr">query</span>: operation.text, <span class="hljs-comment">// GraphQL text from input</span>
      variables,
    }),
  }).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> response.json();
  });
}

<span class="hljs-comment">// Create a network layer from the fetch function</span>
<span class="hljs-keyword">const</span> network = Network.create(fetchQuery);
<span class="hljs-keyword">const</span> store = <span class="hljs-keyword">new</span> Store(<span class="hljs-keyword">new</span> RecordSource())

<span class="hljs-keyword">const</span> environment = <span class="hljs-keyword">new</span> Environment({
  network,
  store
  <span class="hljs-comment">// ... other options</span>
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> environment;
</code></pre>
<p>Note that this is a basic example to help you get started. This example could be extended with additional features such as request/response caching (enabled e.g. when <code>cacheConfig.force</code> is false) and uploading form data for mutations (the <code>uploadables</code> parameter).</p>
<h2><a class="anchor" aria-hidden="true" id="caching"></a><a href="#caching" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Caching</h2>
<p>Relay modern makes no assumptions about what to cache and will garbage collect any data that is no longer referenced.</p>
<p>You have to implement your own cache strategy. A simple solution is to use <code>RelayQueryResponseCache</code>(an in-memory cache):</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">import</span> {
  Environment,
  Network,
  RecordSource,
  Store,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;relay-runtime&#x27;</span>;
<span class="hljs-keyword">import</span> RelayQueryResponseCache <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;relay-runtime/lib/RelayQueryResponseCache&#x27;</span>;

<span class="hljs-keyword">const</span> oneMinute = <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;
<span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">new</span> RelayQueryResponseCache({ <span class="hljs-attr">size</span>: <span class="hljs-number">250</span>, <span class="hljs-attr">ttl</span>: oneMinute });

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchQuery</span>(<span class="hljs-params">
  operation,
  variables,
  cacheConfig,
</span>) </span>{
  <span class="hljs-keyword">const</span> queryID = operation.text;
  <span class="hljs-keyword">const</span> isMutation = operation.operationKind === <span class="hljs-string">&#x27;mutation&#x27;</span>;
  <span class="hljs-keyword">const</span> isQuery = operation.operationKind === <span class="hljs-string">&#x27;query&#x27;</span>;
  <span class="hljs-keyword">const</span> forceFetch = cacheConfig &amp;&amp; cacheConfig.force;

  <span class="hljs-comment">// Try to get data from cache on queries</span>
  <span class="hljs-keyword">const</span> fromCache = cache.get(queryID, variables);
  <span class="hljs-keyword">if</span> (
    isQuery &amp;&amp;
    fromCache !== <span class="hljs-literal">null</span> &amp;&amp;
    !forceFetch
  ) {
    <span class="hljs-keyword">return</span> fromCache;
  }

  <span class="hljs-comment">// Otherwise, fetch data from server</span>
  <span class="hljs-keyword">return</span> fetch(<span class="hljs-string">&#x27;/graphql&#x27;</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,
    },
    <span class="hljs-attr">body</span>: <span class="hljs-built_in">JSON</span>.stringify({
      <span class="hljs-attr">query</span>: operation.text,
      variables,
    }),
  }).then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> response.json();
  }).then(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> {
    <span class="hljs-comment">// Update cache on queries</span>
    <span class="hljs-keyword">if</span> (isQuery &amp;&amp; json) {
      cache.set(queryID, variables, json);
    }
    <span class="hljs-comment">// Clear cache on mutations</span>
    <span class="hljs-keyword">if</span> (isMutation) {
      cache.clear();
    }

    <span class="hljs-keyword">return</span> json;
  });
}

<span class="hljs-keyword">const</span> environment = <span class="hljs-keyword">new</span> Environment({
  <span class="hljs-attr">network</span>: Network.create(fetchQuery),
  <span class="hljs-attr">store</span>: <span class="hljs-keyword">new</span> Store(<span class="hljs-keyword">new</span> RecordSource()),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> environment;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="custom-open-source-implementations"></a><a href="#custom-open-source-implementations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom open-source implementations</h2>
<p><strong><a href="https://github.com/relay-tools/react-relay-network-modern">react-relay-network-modern</a></strong> on <a href="https://www.npmjs.com/package/react-relay-network-modern">npm</a> - is a Network Layer for Relay Modern which has built-in highly customizable middlewares for commonly used scenarios: batching query requests, caching, authentication, request retrying, logging. Moreover, you may write your own middlewares with custom logic.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 6/17/2018 by nodkz</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/v3.0.0/relay-environment"><span class="arrow-prev">← </span><span>Relay Environment</span></a><a class="docs-next button" href="/docs/en/v3.0.0/query-renderer"><span class="function-name-prevnext">QueryRenderer</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#caching">Caching</a></li><li><a href="#custom-open-source-implementations">Custom open-source implementations</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/relay.svg" alt="Relay" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/introduction-to-relay.html">Introduction</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a></div><div><h5>More</h5><a href="https://github.com/facebook/relay">GitHub</a><a href="https://opensource.facebook.com/legal/terms">Terms of Use</a><a href="https://opensource.facebook.com/legal/privacy">Privacy Policy</a><a href="https://opensource.facebook.com/legal/data-policy/">Data Policy</a><a href="https://opensource.facebook.com/legal/cookie-policy/">Cookie Policy</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2021 Facebook Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '3d7d5825d50ea36bca0e6ad06c926f06',
                indexName: 'relay',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:v3.0.0"]}
              });
            </script></body></html>