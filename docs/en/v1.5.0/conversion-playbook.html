<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Conversion Playbook · Relay</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Incrementally modernize your Relay Classic app in these steps:"/><meta name="docsearch:version" content="v1.5.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Conversion Playbook · Relay"/><meta property="og:type" content="website"/><meta property="og:url" content="https://relay.dev/"/><meta property="og:description" content="Incrementally modernize your Relay Classic app in these steps:"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://relay.dev/img/relay.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="/js/redirect.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/relay-white.svg" alt="Relay"/><h2 class="headerTitleWithLogo">Relay</h2></a><a href="/en/versions"><h3>v1.5.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/en/v1.5.0/introduction-to-relay" target="_self">Docs</a></li><li class=""><a href="/en/help" target="_self">Support</a></li><li class=""><a href="https://github.com/facebook/relay" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Migration Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/introduction-to-relay">Introduction to Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/installation-and-setup">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/quick-start-guide">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/graphql-in-relay">GraphQL in Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/relay-environment">Relay Environment</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/network-layer">Network Layer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/query-renderer">QueryRenderer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/fragment-container">Fragment Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/refetch-container">Refetch Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/pagination-container">Pagination Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/mutations">Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/subscriptions">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/relay-store">Relay Store</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/routing">Routing</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/relay-debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/graphql-server-specification">GraphQL Server Specification</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Migration Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/new-in-relay-modern">New in Relay Modern</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/relay-compat">Compatibility Mode</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/migration-setup">Migration Setup</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/v1.5.0/conversion-playbook">Conversion Playbook</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/conversion-scripts">Conversion Scripts</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/upgrading-setvariables">Upgrading setVariables</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/converting-mutations">Converting Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/compatibility-cheatsheet">Compatibility Cheatsheet</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/api-cheatsheet">API Cheatsheet</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Principles &amp; Architecture<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/thinking-in-graphql">Thinking in GraphQL</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/thinking-in-relay">Thinking In Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/architecture-overview">Architecture Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/compiler-architecture">Compiler Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/runtime-architecture">Runtime Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/v1.5.0/videos">Videos</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebook/relay/edit/master/docs/Modern-ConversionPlaybook.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Conversion Playbook</h1></header><article><div><span><p>Incrementally modernize your Relay Classic app in these steps:</p>
<h2><a class="anchor" aria-hidden="true" id="step-0-install-and-configure-your-environment"></a><a href="#step-0-install-and-configure-your-environment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 0: Install and configure your environment</h2>
<p>Follow the steps outlined in the <a href="./migration-setup.html">Migration Setup</a> guide.</p>
<h2><a class="anchor" aria-hidden="true" id="step-1-incrementally-convert-to-relay-compat"></a><a href="#step-1-incrementally-convert-to-relay-compat" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 1: Incrementally convert to Relay Compat</h2>
<p>Start converting your components and mutations to use the Relay Modern APIs from the <code>'react-relay/compat'</code> module (<code>createFragmentContainer</code>, <code>createRefetchContainer</code>, <code>createPaginationContainer</code>, <code>commitMutation</code>). It will be easier to go from the leaf components up. The <a href="https://github.com/relayjs/relay-codemod">conversion scripts</a> should make this step less tedious.</p>
<p>If a fragment uses variables that are determined at runtime, <a href="#note-determining-variable-values-at-runtime">see below</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="step-2-introduce-queryrenderer"></a><a href="#step-2-introduce-queryrenderer" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 2: Introduce <QueryRenderer></h2>
<p>Once all the components and mutations have been converted to use the Relay Modern APIs, convert to using <code>QueryRenderer</code> instead of using <code>Relay.Renderer</code> or <code>Relay.RootContainer</code>. You may supply <code>Store</code> from <code>'react-relay/classic'</code> as the <code>environment</code> for most cases.</p>
<h2><a class="anchor" aria-hidden="true" id="step-3-introduce-relay-modern-runtime"></a><a href="#step-3-introduce-relay-modern-runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 3: Introduce Relay Modern runtime</h2>
<p>Once a few or all of your views are using <code>QueryRenderer</code>, <code>Store</code> from <code>'react-relay/classic'</code> could be replaced with a <code>RelayModernEnvironment</code>. Keep in mind that <code>RelayModernEnvironment</code> and <code>Store</code> do not share any data. You might want to hold off on this step until views that have significant data overlap can be switched over at the same time. This step is what unlocks the perf wins for your app. Apps using the <code>RelayModernEnvironment</code> get to send persisted query IDs instead of the full query strings to the server, as well as much more optimized data normalizing and processing.</p>
<h2><a class="anchor" aria-hidden="true" id="step-4-clean-up-by-replacing-relay-compat-with-relay-modern"></a><a href="#step-4-clean-up-by-replacing-relay-compat-with-relay-modern" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 4: Clean up by replacing Relay Compat with Relay Modern.</h2>
<p>Switch the <code>'react-relay/compat'</code> references in your app to <code>'react-relay'</code>. This is more of a clean-up step that prevents your app from pulling in unnecessary <code>'react-relay/classic'</code> code.</p>
<h2><a class="anchor" aria-hidden="true" id="note-determining-variable-values-at-runtime"></a><a href="#note-determining-variable-values-at-runtime" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Note: Determining variable values at runtime</h2>
<p>There is currently only one supported way to set the initial value of a variable dynamically: using global variables defined on the query that includes the fragment (or via <code>variables</code> on the <code>QueryRenderer</code>).</p>
<p>For example, if <code>currentDate</code> is set in <code>QueryRenderer</code> <code>variables</code>, then $currentDate may be referenced in any fragment included in the <code>QueryRenderer</code> <code>query</code>.</p>
<p>If you're using <code>createRefetchContainer</code> then your <code>refetch</code> method may also update these variables to render with new values.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 12/14/2017 by Juan Tejada</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/v1.5.0/migration-setup"><span class="arrow-prev">← </span><span>Previous</span></a><a class="docs-next button" href="/docs/en/v1.5.0/conversion-scripts"><span>Next</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#step-0-install-and-configure-your-environment">Step 0: Install and configure your environment</a></li><li><a href="#step-1-incrementally-convert-to-relay-compat">Step 1: Incrementally convert to Relay Compat</a></li><li><a href="#step-2-introduce-queryrenderer">Step 2: Introduce &lt;QueryRenderer&gt;</a></li><li><a href="#step-3-introduce-relay-modern-runtime">Step 3: Introduce Relay Modern runtime</a></li><li><a href="#step-4-clean-up-by-replacing-relay-compat-with-relay-modern">Step 4: Clean up by replacing Relay Compat with Relay Modern.</a></li><li><a href="#note-determining-variable-values-at-runtime">Note: Determining variable values at runtime</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/relay.svg" alt="Relay" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/introduction-to-relay.html">Introduction</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a></div><div><h5>More</h5><a href="https://github.com/facebook/relay">GitHub</a><a class="github-button" href="https://github.com/facebook/relay" data-icon="octicon-star" data-count-href="/facebook/relay/stargazers" data-count-api="/repos/facebook/relay#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 Facebook Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '3d7d5825d50ea36bca0e6ad06c926f06',
                indexName: 'relay',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:v1.5.0"]}
              });
            </script></body></html>