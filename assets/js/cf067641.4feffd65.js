"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[51398],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>d,MDXProvider:()=>p,mdx:()=>f,useMDXComponents:()=>h,withMDXComponents:()=>c});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var d=a.createContext({}),c=function(e){return function(t){var n=h(t.components);return a.createElement(e,r({},t,{components:n}))}},h=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=h(e.components);return a.createElement(d.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=h(n),p=o,m=c["".concat(i,".").concat(p)]||c[p]||u[p]||r;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},68629:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(39960),o=n(86341),r=n(67294);function i(){var e=window.encodeURI(JSON.stringify({title:"Feedback about "+window.location.pathname,description:"**!!! Required !!!**\n\nPlease modify the task description to let us know how the docs can be improved.\n\n**Please do not ask support questions via this form! Instead, ask in fburl.com/relay_support**",tag_ids:{add:[0xac96423e5b680,0x64079768ac750]}}));window.open("https://www.internalfb.com/tasks/?n="+e)}function s(e){var t=e.children;return r.createElement("div",{className:"docsRating",id:"docsRating"},r.createElement("hr",null),t)}var l=function(){var e=r.useState(!1),t=e[0],n=e[1],a=function(e){n(!0),function(e){window.ga&&window.ga("send",{hitType:"event",eventCategory:"button",eventAction:"feedback",eventValue:e})}(e)};return t?"Thank you for letting us know!":r.createElement(r.Fragment,null,"Is this page useful?",r.createElement("svg",{className:"i_thumbsup",alt:"Like",id:"docsRating-like",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 81.13 89.76",onClick:function(){return a(1)}},r.createElement("path",{d:"M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"})),r.createElement("svg",{className:"i_thumbsdown",alt:"Dislike",id:"docsRating-dislike",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 81.13 89.76",onClick:function(){return a(0)}},r.createElement("path",{d:"M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"})))},d=function(){return r.createElement("p",null,"Let us know how these docs can be improved by",r.createElement("a",{className:"button",role:"button",tabIndex:0,onClick:i},"Filing a task"))},c=function(){return r.createElement("p",null,"Help us make the site even better by"," ",r.createElement(a.default,{to:"https://www.surveymonkey.com/r/FYC9TCJ"},"answering a few quick questions"),".")},h=function(){return r.createElement(s,null,r.createElement(d,null),r.createElement(l,null),r.createElement(c,null))},p=function(){return r.createElement(s,null,r.createElement(l,null),r.createElement(c,null))};const u=function(){return(0,o.fbContent)({internal:r.createElement(h,null),external:r.createElement(p,null)})}},82059:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>d,default:()=>m,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var a=n(83117),o=n(80102),r=(n(67294),n(3905)),i=n(68629),s=["components"],l={id:"connections",title:"Why Connections?",slug:"/guided-tour/list-data/connections/",description:"Relay guide for connections",keywords:["pagination","connections"]},d="Why Connections?",c={unversionedId:"guided-tour/list-data/connections",id:"guided-tour/list-data/connections",title:"Why Connections?",description:"Relay guide for connections",source:"@site/docs/guided-tour/list-data/connections.md",sourceDirName:"guided-tour/list-data",slug:"/guided-tour/list-data/connections/",permalink:"/docs/next/guided-tour/list-data/connections/",draft:!1,editUrl:"https://github.com/facebook/relay/tree/main/website/docs/guided-tour/list-data/connections.md",tags:[],version:"current",frontMatter:{id:"connections",title:"Why Connections?",slug:"/guided-tour/list-data/connections/",description:"Relay guide for connections",keywords:["pagination","connections"]},sidebar:"docs",previous:{title:"Refetchable Fragments",permalink:"/docs/next/tutorial/refetchable-fragments"},next:{title:"Pagination with Connections",permalink:"/docs/next/guided-tour/list-data/pagination/"}},h={},p=[],u={toc:p};function m(e){var t=e.components,l=(0,o.Z)(e,s);return(0,r.mdx)("wrapper",(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("h1",{id:"why-connections"},"Why Connections?"),(0,r.mdx)("admonition",{type:"info"},(0,r.mdx)("p",{parentName:"admonition"},"For a video format of how the connection spec was derived, check out ",(0,r.mdx)("a",{parentName:"p",href:"/docs/next/guides/graphql-server-specification/#graphql-conf-talk"},"Sabrina Wasserman's GraphQL talk"),"!")),(0,r.mdx)("p",null,"Relay does a lot of the work for you when handling paginated collections of items. But to do that, it relies on a specific convention for how those collections are modeled in your schema. This convention is powerful and flexible, and comes out of experience building many products with collections of items. Let\u2019s step through the design process for this schema convention so that we can understand why it works this way."),(0,r.mdx)("p",null,"There are three important points to understand:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"You may need to model data about an item's inclusion in the collection, such as in a list of friends where you may wish to model the date you friended that person. We handle this by creating nodes that represent the edges, the relationship between the item in the collection and the collection itself."),(0,r.mdx)("li",{parentName:"ul"},"The page itself has properties, such as whether or not there is a next page available. We handle this with a node that represents the current page info."),(0,r.mdx)("li",{parentName:"ul"},"Pagination is done by ",(0,r.mdx)("em",{parentName:"li"},"cursors")," \u2014 opaque symbols that point to the next page of results \u2014 rather than offsets.")),(0,r.mdx)("p",null,"Imagine we want to show a list of the user\u2019s friends. At a high level, we imagine a graph where the viewer and their friends are each nodes. From the viewer to each friend node is an edge, and the edge itself has properties."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Conceptual graph with properties on its edges",src:n(74551).Z,width:"1570",height:"894"})),(0,r.mdx)("p",null,"Now let\u2019s try to model this situation using GraphQL."),(0,r.mdx)("p",null,"In GraphQL, only nodes can have properties, not edges. So the first thing we\u2019ll do is represent the conceptual edge from you to your friend with its very own node."),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"Edge properties modeled using nodes that represent the edges",src:n(88073).Z,width:"1466",height:"1076"})),(0,r.mdx)("p",null,"Now the properties of the edge are represented by a new type of node called a \u201c",(0,r.mdx)("inlineCode",{parentName:"p"},"FriendsEdge"),"\u201d."),(0,r.mdx)("p",null,"The GraphQL to query this would like this:"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre"},"// XXX example only, not final code\nfragment FriendsFragment1 on Viewer {\n  friends {\n    since // a property of the edge\n    node {\n      name // a property of the friend itself\n    }\n  }\n}\n")),(0,r.mdx)("p",null,"Now we have a good place in the GraphQL schema to put edge-specific information such as the date when the edge was created (that is, the date you friended that person)."),(0,r.mdx)("hr",null),(0,r.mdx)("p",null,"Now consider what we would need to model in our schema in order to support pagination and infinite scrolling."),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"The client must be able to specify how large of a page it wants."),(0,r.mdx)("li",{parentName:"ul"},"The client must be informed as to whether any more pages are available, so that it can enable or disable the \u2018next page\u2019 button (or, for infinite scrolling, can stop making further requests)."),(0,r.mdx)("li",{parentName:"ul"},"The client must be able to ask for the next page after the one it already has.")),(0,r.mdx)("p",null,"How can we use the features of GraphQL to do these things? Specifying the page size is done with field arguments. In other words, instead of just ",(0,r.mdx)("inlineCode",{parentName:"p"},"friends")," the query will say ",(0,r.mdx)("inlineCode",{parentName:"p"},"friends(first: 3)"),", passing the page size as an argument to the ",(0,r.mdx)("inlineCode",{parentName:"p"},"friends")," field."),(0,r.mdx)("p",null,"For the server to say whether there is a next page or not, we need to introduce a node in the graph that has information about the ",(0,r.mdx)("em",{parentName:"p"},"list of friends itself,")," just like we are introducing a node for each edge to store information about the edge itself. This new node is called a ",(0,r.mdx)("em",{parentName:"p"},"Connection"),"."),(0,r.mdx)("p",null,"The Connection node represents the connection itself between you and your friends. Metadata about the connection is stored there \u2014 for example, it could have a ",(0,r.mdx)("inlineCode",{parentName:"p"},"totalCount")," field that says how many friends you have. In addition, it always has two fields which represent the ",(0,r.mdx)("em",{parentName:"p"},"current")," page: a ",(0,r.mdx)("inlineCode",{parentName:"p"},"pageInfo")," field with metadata about the current page, such as whether there is another page available \u2014 and an ",(0,r.mdx)("inlineCode",{parentName:"p"},"edges")," field that points to the edges we saw before:"),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"The full connection model with page info and edges",src:n(49701).Z,width:"1924",height:"1334"})),(0,r.mdx)("p",null,"Finally, we need a way to request the next page of results. You\u2019ll notice in the above diagram that the ",(0,r.mdx)("inlineCode",{parentName:"p"},"PageInfo")," node has a field called ",(0,r.mdx)("inlineCode",{parentName:"p"},"lastCursor"),".  This is an opaque token provided by the server that represents the position in the list of the last edge that we were given (the friend \u201cCharmaine\u201d). We can then pass this cursor back to the server in order to retrieve the next page."),(0,r.mdx)("p",null,"By passing the ",(0,r.mdx)("inlineCode",{parentName:"p"},"lastCursor")," value back to the server as an argument to the ",(0,r.mdx)("inlineCode",{parentName:"p"},"friends")," field, we can ask the server for friends that are ",(0,r.mdx)("em",{parentName:"p"},"after")," the ones we\u2019ve already retrieved:"),(0,r.mdx)("p",null,(0,r.mdx)("img",{alt:"After fetching the next page of results",src:n(51913).Z,width:"1926",height:"1336"})),(0,r.mdx)("p",null,"This overall scheme for modeling paginated lists is specified in detail in the ",(0,r.mdx)("a",{parentName:"p",href:"https://relay.dev/graphql/connections.htm"},"GraphQL Cursor Connections Spec"),". It is flexible for many different applications, and although Relay relies on this convention to handle pagination automatically, designing your schema this way is a good idea whether or not you use Relay."),(0,r.mdx)("p",null,"Now that we've stepped through the underlying model for Connections, let\u2019s turn our attention to actually using it to implement Comments for our Newsfeed stories."),(0,r.mdx)(i.Z,{mdxType:"DocsRating"}))}m.isMDXComponent=!0},74551:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/connections-conceptual-graph-a88c591f79c81af5d67b28122e17c581.png"},88073:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/connections-edge-nodes-63a89a1f08749046137894e4b24774cc.png"},51913:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/connections-full-model-next-page-88f27142830f48b2f0184ebcd0e9ad8d.png"},49701:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/connections-full-model-13e2ea59a6271992070d77ae4ae5e9b6.png"}}]);