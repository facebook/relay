"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["62017"],{56918(e,n,t){t.r(n),t.d(n,{metadata:()=>i,default:()=>m,frontMatter:()=>r,contentTitle:()=>c,toc:()=>h,assets:()=>d});var i=JSON.parse('{"id":"guided-tour/list-data/pagination","title":"Pagination with Connections","description":"Relay guide to connections and pagination","source":"@site/docs/guided-tour/list-data/pagination.mdx","sourceDirName":"guided-tour/list-data","slug":"/guided-tour/list-data/pagination/","permalink":"/docs/next/guided-tour/list-data/pagination/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/relay/tree/main/website/docs/guided-tour/list-data/pagination.mdx","tags":[],"version":"current","frontMatter":{"id":"pagination","title":"Pagination with Connections","slug":"/guided-tour/list-data/pagination/","description":"Relay guide to connections and pagination","keywords":["pagination","connections","usePaginationFragment"]},"sidebar":"docs","previous":{"title":"Why Connections?","permalink":"/docs/next/guided-tour/list-data/connections/"},"next":{"title":"Advanced Pagination","permalink":"/docs/next/guided-tour/list-data/advanced-pagination/"}}'),o=t(74848),a=t(28453),s=t(86898);let r={id:"pagination",title:"Pagination with Connections",slug:"/guided-tour/list-data/pagination/",description:"Relay guide to connections and pagination",keywords:["pagination","connections","usePaginationFragment"]},c="Pagination with Connections",d={},h=[{value:"Connection Directives",id:"connection-directives",level:2},{value:"The usePaginationFragment hook",id:"the-usepaginationfragment-hook",level:2},{value:"React Loading States",id:"react-loading-states",level:2}];function l(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"pagination-with-connections",children:"Pagination with Connections"})}),"\n",(0,o.jsxs)(n.p,{children:['In order to paginate through lists of data (load only discrete slices of list data), Relay introduces an abstraction known as a "connection". Connections allow you to request discrete slices of data from the server as well as information about the list itself (e.g. how to get the next page of data). For more information about the design of connections, see ',(0,o.jsx)(n.a,{href:"/docs/next/guided-tour/list-data/connections/",children:"Why Connections?"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"A query with a connection includes:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["the ",(0,o.jsx)(n.em,{children:"connection"})," itself, a field that returns the ",(0,o.jsx)(n.code,{children:"edges"})," and ",(0,o.jsx)(n.code,{children:"pageInfo"}),". It includes a ",(0,o.jsx)(n.code,{children:"first"})," argument to indicate the page size and an ",(0,o.jsx)(n.code,{children:"after"})," argument to indicate where the beginning of the list is."]}),"\n",(0,o.jsxs)(n.li,{children:["the ",(0,o.jsx)(n.em,{children:"edge"}),", which contains the ",(0,o.jsx)(n.code,{children:"cursor"})," (a bookmark of where you are in the list) and the ",(0,o.jsx)(n.code,{children:"node"})," (the actual record the connection is paginating over)."]}),"\n",(0,o.jsxs)(n.li,{children:["the ",(0,o.jsx)(n.em,{children:"pageInfo"}),", which contains information about getting more edges (",(0,o.jsx)(n.code,{children:"hasPreviousPage"}),", ",(0,o.jsx)(n.code,{children:"hasNextPage"}),", ",(0,o.jsx)(n.code,{children:"startCursor"}),", and ",(0,o.jsx)(n.code,{children:"endCursor"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"A typical query fragment (for fetching a list of comments) may look like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"const StoryCommentsSectionFragment = graphql`\n  fragment StoryCommentsSectionFragment on Story {\n    # the connection with arguments to specify which items to fetch\n    comments(after: $cursor, first: $count) {\n      edges {                # the list of edges\n        node {               # the Comment record itself\n          ...CommentFragment # the fields on Comment to fetch\n        }\n        cursor               # an identifier of this Comment's place in the list\n      }\n      pageInfo {             # the page info\n        hasNextPage          # if another page of comments is available\n      }\n    }\n  }\n`;\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:['Relay uses "cursors" to specify the beginning of a list. Each node is associated with a unique cursor, which can be passed to the connection to fetch the next page ',(0,o.jsx)(n.em,{children:"after"})," that cursor. This makes it easy to fetch consecutive pages of data."]})}),"\n",(0,o.jsx)(n.h2,{id:"connection-directives",children:"Connection Directives"}),"\n",(0,o.jsx)(n.p,{children:"Relay handles a lot of the pagination logic for you but to do so, connections must be augmented with directives containing some additional information."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'const StoryCommentsSectionFragment = graphql`\n  fragment StoryCommentsSectionFragment on Story\n  @argumentDefinitions(\n    cursor: { type: "String" }\n    count: { type: "Int", defaultValue: 3 }\n  )\n  @refetchable(queryName: "StoryCommentsSectionPaginationQuery") {\n    comments(after: $cursor, first: $count)\n      @connection(key: "StoryCommentsSectionFragment_comments") {\n      edges {\n        node {\n          ...CommentFragment\n        }\n        cursor\n      }\n      pageInfo {\n        hasNextPage\n        hasPreviousPage\n        startCursor\n        endCursor\n      }\n    }\n  }\n`;\n'})}),"\n",(0,o.jsx)(n.p,{children:"Breaking this down:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"@argumentDefinitions"})," is just defining the ",(0,o.jsx)(n.code,{children:"$cursor"})," and ",(0,o.jsx)(n.code,{children:"$count"})," variables as ",(0,o.jsx)(n.a,{href:"/docs/next/api-reference/graphql-and-directives/#argumentdefinitions",children:"fragment arguments"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"@refetchable"})," makes the fragment ",(0,o.jsx)(n.a,{href:"/docs/next/tutorial/refetchable-fragments",children:"refetchable"})," so that Relay can fetch it again with new arguments \u2014 usually, a new cursor for the ",(0,o.jsx)(n.code,{children:"$cursor"})," argument."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"@connection"})," is what Relay uses to tell ",(0,o.jsx)(n.em,{children:"which field"})," within the fragment represents the connection to paginate over. The ",(0,o.jsx)(n.code,{children:"@connection"})," directive requires a ",(0,o.jsx)(n.code,{children:"key"})," argument which must be a unique string \u2014 here formed from the fragment name and field name. This key is used when editing the connection\u2019s contents via ",(0,o.jsx)(n.a,{href:"/docs/next/guided-tour/list-data/updating-connections/",children:"mutations"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["Relay\u2019s pagination features only work with fragments, not entire queries. This is usually fine as queries are generally issued at some high-level routing component, which would rarely be the same component that\u2019s showing a paginated list. If you need to paginate something at the query level, refactor the connection field out into a fragment that is defined on the ",(0,o.jsx)(n.code,{children:"Query"})," type."]})}),"\n",(0,o.jsxs)(n.p,{children:["For a full specification of connections, see the ",(0,o.jsx)(n.a,{href:"https://relay.dev/graphql/connections.htm",children:"GraphQL Cursor Connections Spec"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"the-usepaginationfragment-hook",children:"The usePaginationFragment hook"}),"\n",(0,o.jsxs)(n.p,{children:["Relay provides an easy way to use connections in React via the ",(0,o.jsx)(n.a,{href:"/docs/next/api-reference/use-pagination-fragment/",children:(0,o.jsx)(n.code,{children:"usePaginationFragment"})})," hook. This hook acts similarly to the ",(0,o.jsx)(n.a,{href:"/docs/next/api-reference/use-fragment/",children:(0,o.jsx)(n.code,{children:"useFragment"})})," hook but also provides additional callbacks for loading the next/previous page of data along with checking if those pages exist and loading indicators if a request is in flight. Using the ",(0,o.jsx)(n.code,{children:"usePaginationFragment"})," hook also means you can omit the ",(0,o.jsx)(n.code,{children:"pageInfo"})," and ",(0,o.jsx)(n.code,{children:"cursor"})," fields from your fragment as Relay will automatically insert them and use the information to paginate via the hook. Taking the previous example with the ",(0,o.jsx)(n.code,{children:"StoryCommentsSectionFragment"}),", the fragment can be reduced to:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'const StoryCommentsSectionFragment = graphql`\n  fragment StoryCommentsSectionFragment on Story\n  @argumentDefinitions(\n    cursor: { type: "String" }\n    count: { type: "Int", defaultValue: 3 }\n  )\n  @refetchable(queryName: "StoryCommentsSectionPaginationQuery") {\n    comments(after: $cursor, first: $count)\n      @connection(key: "StoryCommentsSectionFragment_comments") {\n      edges {\n        node {\n          ...CommentFragment\n        }\n      }\n    }\n  }\n`;\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Here's an example of how the ",(0,o.jsx)(n.code,{children:"usePaginationFragment"})," hook can be used to implement pagination in a React component:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"function StoryCommentsSection({story}) {\n  const {\n    data,\n    hasNext,\n    loadNext,\n    isLoadingNext,\n  } = usePaginationFragment(StoryCommentsSectionFragment, story);\n  return (\n    <>\n      {data.comments.edges.map(commentEdge =>\n        <Comment comment={commentEdge.node} />\n      )}\n      {hasNext && (\n        <LoadMoreCommentsButton\n          onClick={() => loadNext(3)}\n          disabled={isLoadingNext}\n        />\n      )}\n      {isLoadingNext && <SmallSpinner />}\n    </>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["In this example, the ",(0,o.jsx)(n.code,{children:"story"})," prop passed to the ",(0,o.jsx)(n.code,{children:"usePaginationFragment"})," is the same as the query reference passed to ",(0,o.jsx)(n.code,{children:"useFragment"}),". Along with the fragment ",(0,o.jsx)(n.code,{children:"data"}),", the hook in this example also returns ",(0,o.jsx)(n.code,{children:"loadNext"}),", ",(0,o.jsx)(n.code,{children:"hasNext"}),", and ",(0,o.jsx)(n.code,{children:"isLoadingNext"}),"."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"hasNext"})," indicates whether another page of data exists."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"loadNext"})," is a function that can be called to load the next page of data \u2014 for example when a user clicks on the ",(0,o.jsx)(n.code,{children:"LoadMoreCommentsButton"}),". It takes an argument to indicate how many new items to fetch."]}),"\n",(0,o.jsxs)(n.li,{children:["In order to provide a better user experience, ",(0,o.jsx)(n.code,{children:"isLoadingNext"})," can be used to show a loading indicator while the next page of comments is loading."]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["When the request to fetch the next items completes, the connection will be automatically updated and the component will re-render with the latest items in the connection. In our case, this means that the ",(0,o.jsx)(n.code,{children:"comments"})," field will always contain ",(0,o.jsx)(n.em,{children:"all"})," of the comments that we've fetched so far. By default, ",(0,o.jsx)(n.em,{children:"Relay will automatically append new items to the connection upon completing a pagination request,"})," and will make them available to your fragment component*.* If you need a different behavior, check out the ",(0,o.jsx)(n.a,{href:"/docs/next/guided-tour/list-data/advanced-pagination/",children:"Advanced Pagination Use Cases"})," section."]})}),"\n",(0,o.jsxs)(n.p,{children:["For the full information on the ",(0,o.jsx)(n.code,{children:"usePaginationFragment"})," hook, check out the ",(0,o.jsx)(n.a,{href:"/docs/next/api-reference/use-pagination-fragment/",children:"API reference"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"react-loading-states",children:"React Loading States"}),"\n",(0,o.jsxs)(n.p,{children:["React provides ",(0,o.jsx)(n.a,{href:"https://react.dev/reference/react/Suspense",children:"suspense"})," to allow a fallback while data is loading and ",(0,o.jsx)(n.a,{href:"https://react.dev/reference/react/startTransition",children:"transitions"})," to provide a better user experience when updating data. These can be used in conjunction with ",(0,o.jsx)(n.code,{children:"usePaginationFragment"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Taking the example above,"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"function StoryCommentsSection({story}) {\n  const {\n    data,\n    hasNext,\n    loadNext,\n    isLoadingNext,\n  } = usePaginationFragment(StoryCommentsSectionFragment, story);\n  return (\n    <>\n      {data.comments.edges.map(commentEdge => {\n        return (\n          <Suspense fallback={<Glimmer />}>\n            <Comment comment={commentEdge.node} />\n          </Suspense>\n        );\n      })}\n      {hasNext && (\n        <LoadMoreCommentsButton\n          onClick={() => {\n            startTransition(() => {\n              loadNext(3)\n            });\n          }}\n          disabled={isLoadingNext}\n        />\n      )}\n      {isLoadingNext && <SmallSpinner />}\n    </>\n  );\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Calling ",(0,o.jsx)(n.code,{children:"loadNext"})," may cause the component or new children components to suspend (as explained in ",(0,o.jsx)(n.a,{href:"/docs/next/guided-tour/rendering/loading-states/",children:"Loading States with Suspense"}),"). This means that you'll need to make sure that there's a ",(0,o.jsx)(n.code,{children:"Suspense"})," boundary wrapping this component from above and/or that you are using a transition in order to show the appropriate pending or loading state."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Since ",(0,o.jsx)(n.code,{children:"loadNext"})," may cause the component to suspend, regardless of whether a transition is used to render a pending state (i.e. with a loading indicator from ",(0,o.jsx)(n.a,{href:"https://react.dev/reference/react/useTransition",children:"useTransition"}),"), ",(0,o.jsx)(n.code,{children:"startTransition"})," should always be used to schedule that update for the best user experience."]})}),"\n",(0,o.jsx)(s.A,{})]})}function m(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},86898(e,n,t){t.d(n,{A:()=>g});var i=t(74848),o=t(95310),a=t(17352),s=t(96540);function r(){let e=window.encodeURI(JSON.stringify({title:"Feedback about "+window.location.pathname,description:"**!!! Required !!!**\n\nPlease modify the task description to let us know how the docs can be improved.\n\n**Please do not ask support questions via this form! Instead, ask in fburl.com/relay_support**",tag_ids:{add:[0xac96423e5b680,0x64079768ac750]}}));window.open("https://www.internalfb.com/tasks/?n="+e)}function c({children:e}){return(0,i.jsxs)("div",{className:"docsRating",id:"docsRating",children:[(0,i.jsx)("hr",{}),e]})}let d=()=>{let[e,n]=s.useState(!1),t=e=>{n(!0),window.ga&&window.ga("send",{hitType:"event",eventCategory:"button",eventAction:"feedback",eventValue:e})};return e?"Thank you for letting us know!":(0,i.jsxs)(i.Fragment,{children:["Is this page useful?",(0,i.jsx)("svg",{className:"i_thumbsup",alt:"Like",id:"docsRating-like",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 81.13 89.76",onClick:()=>t(1),children:(0,i.jsx)("path",{d:"M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"})}),(0,i.jsx)("svg",{className:"i_thumbsdown",alt:"Dislike",id:"docsRating-dislike",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 81.13 89.76",onClick:()=>t(0),children:(0,i.jsx)("path",{d:"M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"})})]})},h=()=>(0,i.jsxs)("p",{children:["Let us know how these docs can be improved by",(0,i.jsx)("a",{className:"button",role:"button",tabIndex:0,onClick:r,children:"Filing a task"})]}),l=()=>(0,i.jsxs)("p",{children:["Help us make the site even better by"," ",(0,i.jsx)(o.default,{to:"https://www.surveymonkey.com/r/FYC9TCJ",children:"answering a few quick questions"}),"."]}),m=()=>(0,i.jsxs)(c,{children:[(0,i.jsx)(h,{}),(0,i.jsx)(d,{}),(0,i.jsx)(l,{})]}),u=()=>(0,i.jsxs)(c,{children:[(0,i.jsx)(d,{}),(0,i.jsx)(l,{})]}),g=()=>(0,a.fbContent)({internal:(0,i.jsx)(m,{}),external:(0,i.jsx)(u,{})})},28453(e,n,t){t.d(n,{R:()=>s,x:()=>r});var i=t(96540);let o={},a=i.createContext(o);function s(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);