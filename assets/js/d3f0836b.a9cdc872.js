"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["71630"],{73244(e,n,t){t.r(n),t.d(n,{metadata:()=>i,default:()=>h,frontMatter:()=>a,contentTitle:()=>s,toc:()=>c,assets:()=>o});var i=JSON.parse('{"id":"guides/semantic-nullability","title":"Semantic Nullability","description":"Experimental support for semantic nullability","source":"@site/versioned_docs/version-v20.0.0/guides/semantic-nullability.md","sourceDirName":"guides","slug":"/guides/semantic-nullability/","permalink":"/docs/v20.0.0/guides/semantic-nullability/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/relay/tree/main/website/versioned_docs/version-v20.0.0/guides/semantic-nullability.md","tags":[],"version":"v20.0.0","frontMatter":{"id":"semantic-nullability","title":"Semantic Nullability","slug":"/guides/semantic-nullability/","description":"Experimental support for semantic nullability","keywords":["null","nullability","semanticNonNull"]},"sidebar":"docs","previous":{"title":"Error States with ErrorBoundaries","permalink":"/docs/v20.0.0/guided-tour/rendering/error-states/"},"next":{"title":"Introduction","permalink":"/docs/v20.0.0/guided-tour/updating-data/introduction"}}'),l=t(74848),r=t(28453);let a={id:"semantic-nullability",title:"Semantic Nullability",slug:"/guides/semantic-nullability/",description:"Experimental support for semantic nullability",keywords:["null","nullability","semanticNonNull"]},s,o={},c=[{value:"Motivation",id:"motivation",level:2},{value:"Proposed Solution",id:"proposed-solution",level:2},{value:"By Example",id:"by-example",level:2},{value:"GraphQL Conf Talk",id:"graphql-conf-talk",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,l.jsxs)(n.p,{children:["One of GraphQL's strengths is its field-granular error handling which can dramatically improve response resiliency. However, today that error handling depends upon field nullability, which is the reason it is a ",(0,l.jsx)(n.a,{href:"https://graphql.org/learn/best-practices/#nullability",children:"recommended best practice"})," to default all fields to being nullable. This creates a trade-off where ",(0,l.jsx)(n.strong,{children:"enabling maximum resiliency means client developers must manually handle all possible permutations of field nullability"})," within their components. ",(0,l.jsx)(n.a,{href:"/docs/v20.0.0/guides/required-directive/",children:(0,l.jsx)(n.code,{children:"@required"})})," can help a bit, but is ultimately a very blunt tool."]}),"\n",(0,l.jsx)(n.h2,{id:"proposed-solution",children:"Proposed Solution"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://github.com/graphql/graphql.github.io/blob/nullability-post/src/pages/blog/2024-08-14-exploring-true-nullability.mdx#our-latest-proposal",children:"Semantic Nullability"}),' is an early GraphQL spec proposal that aims to decouple error handling and nullability in the GraphQL spec to enable maximum resiliency while still exposing the "semantic nullability", (the nullability of the actual resolver function/method on the server) of the field to the client.']}),"\n",(0,l.jsxs)(n.p,{children:['The proposal works by allowing the schema to specify a new type of nullability of "null only on error". If a client sees this type, ',(0,l.jsx)(n.em,{children:"and"})," the client has some strategy for handling field errors out-of-band, it may treat the field that is exposed to user code as non-nullable."]}),"\n",(0,l.jsxs)(n.p,{children:["The full spec change will likely require adding additional syntax to GraphQL's schema definition language, but in the meantime, various GraphQL servers and clients have collaborated on a temporary directive ",(0,l.jsx)(n.a,{href:"https://specs.apollo.dev/nullability/v0.2/",children:(0,l.jsx)(n.code,{children:"@semanticNonNull"})})," that can be used to experiment with this idea."]}),"\n",(0,l.jsxs)(n.p,{children:["In short, you can add ",(0,l.jsx)(n.code,{children:"@semanticNonNull"})," to a field in your schema to indicate that the field is non-nullable in the semantic sense, but that the client should still be prepared to handle errors."]}),"\n",(0,l.jsxs)(n.p,{children:["Relay will look for ",(0,l.jsx)(n.code,{children:"@semanticNonNull"})," directives in your schema and generate non-nullable Flow/TypeScript types for those fields if you enable client-side error handling for your query or fragment by adding the ",(0,l.jsx)(n.a,{href:"/docs/v20.0.0/guides/throw-on-field-error-directive/",children:(0,l.jsx)(n.code,{children:"@throwOnFieldError"})})," directive."]}),"\n",(0,l.jsxs)(n.p,{children:["If your server will never return ",(0,l.jsx)(n.code,{children:"null"})," for a user's name, except in the case of errors, for example because it's resolver is typed as non-nullable, you can then apply ",(0,l.jsx)(n.code,{children:"@semanticNonNull"})," to that field in your schema."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-graphql",metastring:'title="schema.graphql"',children:"directive @semanticNonNull(levels: [Int] = [0]) on FIELD_DEFINITION\n\ntype User {\n  name: String @semanticNonNull\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Once you've added the directive to your schema, you can add ",(0,l.jsx)(n.code,{children:"@throwOnFieldError"})," to your fragment and queries to indicate that the client should throw an error if any field errors are encountered when the fragment is read."]}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.p,{children:["Be sure to add ",(0,l.jsx)(n.a,{href:"https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary",children:"React error boundaries"})," to your app above any components that are using ",(0,l.jsx)(n.code,{children:"@throwOnFieldError"}),"."]})}),"\n",(0,l.jsxs)(n.p,{children:["In the below example, Relay's generated TypeScript or Flow types for ",(0,l.jsx)(n.code,{children:"user.name"})," will be non-nullable."]}),"\n",(0,l.jsx)(n.admonition,{type:"caution",children:(0,l.jsxs)(n.p,{children:["If Relay receives a field error for ",(0,l.jsx)(n.code,{children:"user.name"}),", ",(0,l.jsx)(n.code,{children:"useFragment"})," will throw an error. For this reason, it's important to ensure that you are have adequate ",(0,l.jsx)(n.a,{href:"/docs/v20.0.0/guided-tour/rendering/error-states/",children:"React error boundaries"})," in place to catch these errors."]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",children:"import type {UserComponent_user$key} from 'UserComponent_user.graphql';\n\nconst React = require('React');\nconst {graphql, useFragment} = require('react-relay');\n\ntype Props = {\n  user: UserComponent_user$key,\n};\n\nfunction UserComponent(props: Props) {\n  const user = useFragment(\n    graphql`\n      fragment UserComponent_user on User @throwOnFieldError {\n        name # Will be typed as non-nullable\n      }\n    `,\n    props.user,\n  );\n\n  return <div>{user.name}</div>\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"by-example",children:"By Example"}),"\n",(0,l.jsxs)(n.p,{children:["For a hands on example, see ",(0,l.jsx)(n.a,{href:"https://github.com/captbaritone/grats-relay-example/pull/1",children:"this example project"})," showing Relay configured to use ",(0,l.jsx)(n.code,{children:"@semanticNonNull"})," and ",(0,l.jsx)(n.code,{children:"@throwOnFieldError"})," alongside ",(0,l.jsx)(n.a,{href:"https://grats.capt.dev/",children:"Grats"})," which ",(0,l.jsx)(n.a,{href:"https://grats.capt.dev/docs/guides/strict-semantic-nullability/",children:"has support"})," for automatically deriving a schema that includes the experimental ",(0,l.jsx)(n.code,{children:"@semanticNonNull"})," directives."]}),"\n",(0,l.jsx)(n.h2,{id:"graphql-conf-talk",children:"GraphQL Conf Talk"}),"\n",(0,l.jsx)(n.p,{children:"The Relay team gave a talk at GraphQL Conf 2024 about semantic nullability. You can watch it here:"}),"\n",(0,l.jsx)("iframe",{src:"https://www.youtube-nocookie.com/embed/kVYlplb1gKk",width:640,height:360,allowFullScreen:!0,frameBorder:"0"}),"\n",(0,l.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/graphql/graphql-wg/discussions/1394",children:"True Nullability Schema"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/graphql/graphql-wg/discussions/1410",children:"Strict Semantic Nullability"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/graphql/graphql-spec/pull/1065",children:"RFC: SemanticNonNull type (null only on error)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsxs)(n.a,{href:"https://grats.capt.dev/docs/guides/strict-semantic-nullability/",children:["Grat's support/documentation for ",(0,l.jsx)(n.code,{children:"@SemanticNonNull"})]})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://specs.apollo.dev/nullability/v0.2/",children:"Apollo's specification for this directive"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsxs)(n.a,{href:"https://www.apollographql.com/docs/kotlin/v4/advanced/nullability/#handle-semantic-non-null-with-semanticnonnull",children:["Support for ",(0,l.jsx)(n.code,{children:"@SemanticNonNull"})," in Apollo Kotlin"]})," added in ",(0,l.jsx)(n.a,{href:"https://github.com/apollographql/apollo-kotlin/releases/tag/v4.0.0-beta.3",children:"4.0.0-beta.3"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"https://github.com/captbaritone/awesome-semantic-nullability",children:"Awesome Semantic Nullability"})," a list of frameworks and stand alone tools that support semantic nullability"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},28453(e,n,t){t.d(n,{R:()=>a,x:()=>s});var i=t(96540);let l={},r=i.createContext(l);function a(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);