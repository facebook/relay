// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`compileRelayArtifacts matches expected output: client-conditions.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id
  name @include(if: $shouldInclude)

  client_nickname @include(if: $shouldInclude)

  foo {
    ... on ClientNamed @include(if: $shouldInclude) {
      client_name
      client_name_2
    }
  }

  ... on Actor @include(if: $shouldInclude) {
    client_actor_field
    address {
      city
      client_street_address_field(arg: $arg) # nested client field
    }
  }
}

extend type User {
  client_nickname: String
  client_actor_field: String
  foo: ClientNamed
}

extend type StreetAddress {
  client_street_address_field(arg: String): String
}

extend interface Actor {
  client_actor_field: String
}

extend type Page {
  client_actor_field: String
}

interface ClientNamed {
  client_name: String
  client_name_2: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "shouldInclude",
      type: "Boolean!",
    },
    RootArgument {
      name: "arg",
      type: "String",
    },
  ],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    Condition {
      condition: "shouldInclude",
      passingValue: true,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "StreetAddress",
          name: "address",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "city",
              storageKey: null,
            },
            ClientExtension {
              selections: [
                ScalarField {
                  alias: null,
                  args: [
                    Variable {
                      name: "arg",
                      variableName: "arg",
                    },
                  ],
                  name: "client_street_address_field",
                  storageKey: null,
                },
              ],
            },
          ],
          storageKey: null,
        },
        ClientExtension {
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "client_nickname",
              storageKey: null,
            },
            ScalarField {
              alias: null,
              args: null,
              name: "client_actor_field",
              storageKey: null,
            },
          ],
        },
      ],
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: null,
          name: "foo",
          plural: false,
          selections: [
            Condition {
              condition: "shouldInclude",
              passingValue: true,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "client_name",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "client_name_2",
                  storageKey: null,
                },
              ],
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: client-fields-in-inline-fragments.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id

  ... on Actor {
    client_actor_field
    address {
      city
      client_street_address_field(arg: $arg) # nested client field
    }
  }
}

extend type StreetAddress {
  client_street_address_field(arg: String): String
}

extend type User {
  client_actor_field: String
}

extend interface Actor {
  client_actor_field: String
}

extend type Page {
  client_actor_field: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "arg",
      type: "String",
    },
  ],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "StreetAddress",
      name: "address",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "city",
          storageKey: null,
        },
        ClientExtension {
          selections: [
            ScalarField {
              alias: null,
              args: [
                Variable {
                  name: "arg",
                  variableName: "arg",
                },
              ],
              name: "client_street_address_field",
              storageKey: null,
            },
          ],
        },
      ],
      storageKey: null,
    },
    ClientExtension {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "client_actor_field",
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: client-fields-of-client-type.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id

  client_foo {
    client_name
    profile_picture(scale: 2) {
      uri
    }
  }
}

extend type User {
  client_foo: Foo
}

type Foo {
  client_name: String
  profile_picture(scale: Float): Image
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "Foo",
          name: "client_foo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "client_name",
              storageKey: null,
            },
            LinkedField {
              alias: null,
              args: [
                Literal {
                  name: "scale",
                  value: 2,
                },
              ],
              concreteType: "Image",
              name: "profile_picture",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "uri",
                  storageKey: null,
                },
              ],
              storageKey: "profile_picture(scale:2)",
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: client-fields-on-roots.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query FooQuery($id: ID!) {
  client_root_field

  node(id: $id) {
    id
  }
}

mutation FooMutation($input: UnfriendInput) {
  client_root_field
  unfriend(input: $input) {
    clientMutationId
  }
}

subscription FooSubscription($input: FeedbackLikeInput) {
  client_root_field
  feedbackLikeSubscribe(input: $input) {
    clientSubscriptionId
  }
}

extend type Query {
  client_root_field: String
}

extend type Mutation {
  client_root_field: String
}

extend type Subscription {
  client_root_field: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "FooQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "client_root_field",
            storageKey: null,
          },
        ],
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "FooQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "client_root_field",
            storageKey: null,
          },
        ],
      },
    ],
  },
}

QUERY:

query FooQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    id
  }
}


Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "input",
        type: "UnfriendInput",
      },
    ],
    metadata: null,
    name: "FooMutation",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "input",
            variableName: "input",
          },
        ],
        concreteType: "UnfriendResponsePayload",
        name: "unfriend",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "clientMutationId",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "client_root_field",
            storageKey: null,
          },
        ],
      },
    ],
    type: "Mutation",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "input",
        type: "UnfriendInput",
      },
    ],
    name: "FooMutation",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "input",
            variableName: "input",
          },
        ],
        concreteType: "UnfriendResponsePayload",
        name: "unfriend",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "clientMutationId",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "client_root_field",
            storageKey: null,
          },
        ],
      },
    ],
  },
}

QUERY:

mutation FooMutation(
  $input: UnfriendInput
) {
  unfriend(input: $input) {
    clientMutationId
  }
}


Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "input",
        type: "FeedbackLikeInput",
      },
    ],
    metadata: null,
    name: "FooSubscription",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "input",
            variableName: "input",
          },
        ],
        concreteType: "FeedbackLikeResponsePayload",
        name: "feedbackLikeSubscribe",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "clientSubscriptionId",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "client_root_field",
            storageKey: null,
          },
        ],
      },
    ],
    type: "Subscription",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "input",
        type: "FeedbackLikeInput",
      },
    ],
    name: "FooSubscription",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "input",
            variableName: "input",
          },
        ],
        concreteType: "FeedbackLikeResponsePayload",
        name: "feedbackLikeSubscribe",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "clientSubscriptionId",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "client_root_field",
            storageKey: null,
          },
        ],
      },
    ],
  },
}

QUERY:

subscription FooSubscription(
  $input: FeedbackLikeInput
) {
  feedbackLikeSubscribe(input: $input) {
    clientSubscriptionId
  }
}

`;

exports[`compileRelayArtifacts matches expected output: client-fragment-spreads.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id
  foo {
    ...ClientTypeFragment # include fragment on client-only type
  }
}

extend type User {
  foo: ClientType
}

fragment ClientTypeFragment on ClientType {
  client_field
}

type ClientType {
  client_field: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "ClientType",
          name: "foo",
          plural: false,
          selections: [
            FragmentSpread {
              args: null,
              name: "ClientTypeFragment",
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "ClientTypeFragment",
  selections: [
    ClientExtension {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "client_field",
          storageKey: null,
        },
      ],
    },
  ],
  type: "ClientType",
}
`;

exports[`compileRelayArtifacts matches expected output: client-fragment-spreads-in-query.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query FooQuery($id: ID!) {
  node(id: $id) {
    ...Foo_user
  }
}

fragment Foo_user on User {
  id
  foo {
    ...ClientTypeFragment
  }
}

extend type User {
  foo: ClientType
}

fragment ClientTypeFragment on ClientType {
  client_field
}

type ClientType {
  client_field: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "FooQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "Foo_user",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "FooQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ClientExtension {
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "ClientType",
                    name: "foo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "client_field",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query FooQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...Foo_user
    id
  }
}

fragment Foo_user on User {
  id
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "ClientType",
          name: "foo",
          plural: false,
          selections: [
            FragmentSpread {
              args: null,
              name: "ClientTypeFragment",
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "ClientTypeFragment",
  selections: [
    ClientExtension {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "client_field",
          storageKey: null,
        },
      ],
    },
  ],
  type: "ClientType",
}
`;

exports[`compileRelayArtifacts matches expected output: client-inline-fragments.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id
  foo {
    ... on ClientNamed {
      client_name
    }
  }
}

extend type User {
  foo: ClientNamed
}

interface ClientNamed {
  client_name: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: null,
          name: "foo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "client_name",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: client-inline-fragments-in-query.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query FooQuery($id: ID!) {
  node(id: $id) {
    ...Foo_user
  }
}

fragment Foo_user on User {
  id
  foo {
    ... on ClientNamed {
      client_name
    }
  }
}

extend type User {
  foo: ClientNamed
}

interface ClientNamed {
  client_name: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "FooQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "Foo_user",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "FooQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ClientExtension {
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: null,
                    name: "foo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "__typename",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "client_name",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query FooQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...Foo_user
    id
  }
}

fragment Foo_user on User {
  id
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: null,
          name: "foo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "client_name",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: client-linked-fields.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id

  client_friends {
    edges {
      client_friend_edge_field # nested client field, should not create new ClientExtension node
      node {
        id
      }
    }
    pageInfo {
      hasNextPage
    }
  }
}

extend type User {
  client_friends: FriendsConnection
}

extend type FriendsEdge {
  client_friend_edge_field: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "FriendsConnection",
          name: "client_friends",
          plural: false,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "FriendsEdge",
              name: "edges",
              plural: true,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "client_friend_edge_field",
                  storageKey: null,
                },
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "User",
                  name: "node",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "id",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
            LinkedField {
              alias: null,
              args: null,
              concreteType: "PageInfo",
              name: "pageInfo",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "hasNextPage",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: client-scalar-fields.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id

  client_nickname # client field
  friends {
    count
    client_friends_connection_field # nested client field
  }
}

extend type User {
  client_nickname: String
}

extend type FriendsConnection {
  client_friends_connection_field: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "FriendsConnection",
      name: "friends",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "count",
          storageKey: null,
        },
        ClientExtension {
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "client_friends_connection_field",
              storageKey: null,
            },
          ],
        },
      ],
      storageKey: null,
    },
    ClientExtension {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "client_nickname",
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: complex-arguments.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query TestQuery($date: String) {
  items(filter: {date: $date}) {
    date
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "date",
        type: "String",
      },
    ],
    metadata: null,
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          ObjectValue {
            fields: [
              Variable {
                name: "date",
                variableName: "date",
              },
            ],
            name: "filter",
          },
        ],
        concreteType: "ItemFilterResult",
        name: "items",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "date",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "date",
        type: "String",
      },
    ],
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          ObjectValue {
            fields: [
              Variable {
                name: "date",
                variableName: "date",
              },
            ],
            name: "filter",
          },
        ],
        concreteType: "ItemFilterResult",
        name: "items",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "date",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query TestQuery(
  $date: String
) {
  items(filter: {date: $date}) {
    date
  }
}

`;

exports[`compileRelayArtifacts matches expected output: complex-arguments-in-list.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query CheckinSearchQuery(
  $queryText: String!
  $searchInputText: String
  $searchInput: CheckinSearchInput
  $searchInputLast: CheckinSearchInput!
) {
  checkinSearchQuery(
    query: {
      query: $queryText
      inputs: [{query: $searchInputText}, $searchInput, null, $searchInputLast]
    }
  ) {
    query
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "queryText",
        type: "String!",
      },
      LocalArgument {
        defaultValue: null,
        name: "searchInputText",
        type: "String",
      },
      LocalArgument {
        defaultValue: null,
        name: "searchInput",
        type: "CheckinSearchInput",
      },
      LocalArgument {
        defaultValue: null,
        name: "searchInputLast",
        type: "CheckinSearchInput!",
      },
    ],
    metadata: null,
    name: "CheckinSearchQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          ObjectValue {
            fields: [
              ListValue {
                items: [
                  ObjectValue {
                    fields: [
                      Variable {
                        name: "query",
                        variableName: "searchInputText",
                      },
                    ],
                    name: "inputs.0",
                  },
                  Variable {
                    name: "inputs.1",
                    variableName: "searchInput",
                  },
                  null,
                  Variable {
                    name: "inputs.3",
                    variableName: "searchInputLast",
                  },
                ],
                name: "inputs",
              },
              Variable {
                name: "query",
                variableName: "queryText",
              },
            ],
            name: "query",
          },
        ],
        concreteType: "CheckinSearchResult",
        name: "checkinSearchQuery",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "query",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "queryText",
        type: "String!",
      },
      LocalArgument {
        defaultValue: null,
        name: "searchInputText",
        type: "String",
      },
      LocalArgument {
        defaultValue: null,
        name: "searchInput",
        type: "CheckinSearchInput",
      },
      LocalArgument {
        defaultValue: null,
        name: "searchInputLast",
        type: "CheckinSearchInput!",
      },
    ],
    name: "CheckinSearchQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          ObjectValue {
            fields: [
              ListValue {
                items: [
                  ObjectValue {
                    fields: [
                      Variable {
                        name: "query",
                        variableName: "searchInputText",
                      },
                    ],
                    name: "inputs.0",
                  },
                  Variable {
                    name: "inputs.1",
                    variableName: "searchInput",
                  },
                  null,
                  Variable {
                    name: "inputs.3",
                    variableName: "searchInputLast",
                  },
                ],
                name: "inputs",
              },
              Variable {
                name: "query",
                variableName: "queryText",
              },
            ],
            name: "query",
          },
        ],
        concreteType: "CheckinSearchResult",
        name: "checkinSearchQuery",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "query",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query CheckinSearchQuery(
  $queryText: String!
  $searchInputText: String
  $searchInput: CheckinSearchInput
  $searchInputLast: CheckinSearchInput!
) {
  checkinSearchQuery(query: {query: $queryText, inputs: [{query: $searchInputText}, $searchInput, , $searchInputLast]}) {
    query
  }
}

`;

exports[`compileRelayArtifacts matches expected output: complex-arguments-with-mutliple-variables.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query TestQueryWithLiteral($latArg: String, $lonArg: String) {
  route(
    waypoints: [
      {lat: $latArg, lon: $lonArg}
      {lat: null, lon: $latArg}
      {lat: $lonArg, lon: "1234"}
    ]
  ) {
    __typename
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "latArg",
        type: "String",
      },
      LocalArgument {
        defaultValue: null,
        name: "lonArg",
        type: "String",
      },
    ],
    metadata: null,
    name: "TestQueryWithLiteral",
    selections: [
      LinkedField {
        alias: null,
        args: [
          ListValue {
            items: [
              ObjectValue {
                fields: [
                  Variable {
                    name: "lat",
                    variableName: "latArg",
                  },
                  Variable {
                    name: "lon",
                    variableName: "lonArg",
                  },
                ],
                name: "waypoints.0",
              },
              ObjectValue {
                fields: [
                  Literal {
                    name: "lat",
                    value: null,
                  },
                  Variable {
                    name: "lon",
                    variableName: "latArg",
                  },
                ],
                name: "waypoints.1",
              },
              ObjectValue {
                fields: [
                  Variable {
                    name: "lat",
                    variableName: "lonArg",
                  },
                  Literal {
                    name: "lon",
                    value: "1234",
                  },
                ],
                name: "waypoints.2",
              },
            ],
            name: "waypoints",
          },
        ],
        concreteType: "Route",
        name: "route",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "latArg",
        type: "String",
      },
      LocalArgument {
        defaultValue: null,
        name: "lonArg",
        type: "String",
      },
    ],
    name: "TestQueryWithLiteral",
    selections: [
      LinkedField {
        alias: null,
        args: [
          ListValue {
            items: [
              ObjectValue {
                fields: [
                  Variable {
                    name: "lat",
                    variableName: "latArg",
                  },
                  Variable {
                    name: "lon",
                    variableName: "lonArg",
                  },
                ],
                name: "waypoints.0",
              },
              ObjectValue {
                fields: [
                  Literal {
                    name: "lat",
                    value: null,
                  },
                  Variable {
                    name: "lon",
                    variableName: "latArg",
                  },
                ],
                name: "waypoints.1",
              },
              ObjectValue {
                fields: [
                  Variable {
                    name: "lat",
                    variableName: "lonArg",
                  },
                  Literal {
                    name: "lon",
                    value: "1234",
                  },
                ],
                name: "waypoints.2",
              },
            ],
            name: "waypoints",
          },
        ],
        concreteType: "Route",
        name: "route",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query TestQueryWithLiteral(
  $latArg: String
  $lonArg: String
) {
  route(waypoints: [{lat: $latArg, lon: $lonArg}, {lon: $latArg}, {lat: $lonArg, lon: "1234"}]) {
    __typename
  }
}

`;

exports[`compileRelayArtifacts matches expected output: connection.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NodeQuery($id: ID!) {
  node(id: $id) {
    id
    ... on Story {
      comments(first: 10) @connection(key: "NodeQuery_comments") {
        edges {
          node {
            actor {
              name
              friends(first: 10) @connection(key: "NodeQuery_friends") {
                edges {
                  node {
                    name
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: "comments",
                args: null,
                concreteType: "CommentsConnection",
                name: "__NodeQuery_comments_connection",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: null,
                            name: "actor",
                            plural: false,
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "name",
                                storageKey: null,
                              },
                              LinkedField {
                                alias: "friends",
                                args: null,
                                concreteType: "FriendsConnection",
                                name: "__NodeQuery_friends_connection",
                                plural: false,
                                selections: [
                                  LinkedField {
                                    alias: null,
                                    args: null,
                                    concreteType: "FriendsEdge",
                                    name: "edges",
                                    plural: true,
                                    selections: [
                                      LinkedField {
                                        alias: null,
                                        args: null,
                                        concreteType: "User",
                                        name: "node",
                                        plural: false,
                                        selections: [
                                          ScalarField {
                                            alias: null,
                                            args: null,
                                            name: "name",
                                            storageKey: null,
                                          },
                                          ScalarField {
                                            alias: null,
                                            args: null,
                                            name: "__typename",
                                            storageKey: null,
                                          },
                                        ],
                                        storageKey: null,
                                      },
                                      ScalarField {
                                        alias: null,
                                        args: null,
                                        name: "cursor",
                                        storageKey: null,
                                      },
                                    ],
                                    storageKey: null,
                                  },
                                  LinkedField {
                                    alias: null,
                                    args: null,
                                    concreteType: "PageInfo",
                                    name: "pageInfo",
                                    plural: false,
                                    selections: [
                                      ScalarField {
                                        alias: null,
                                        args: null,
                                        name: "endCursor",
                                        storageKey: null,
                                      },
                                      ScalarField {
                                        alias: null,
                                        args: null,
                                        name: "hasNextPage",
                                        storageKey: null,
                                      },
                                    ],
                                    storageKey: null,
                                  },
                                ],
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                concreteType: "CommentsConnection",
                name: "comments",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: null,
                            name: "actor",
                            plural: false,
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "__typename",
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "name",
                                storageKey: null,
                              },
                              LinkedField {
                                alias: null,
                                args: [
                                  Literal {
                                    name: "first",
                                    value: 10,
                                  },
                                ],
                                concreteType: "FriendsConnection",
                                name: "friends",
                                plural: false,
                                selections: [
                                  LinkedField {
                                    alias: null,
                                    args: null,
                                    concreteType: "FriendsEdge",
                                    name: "edges",
                                    plural: true,
                                    selections: [
                                      LinkedField {
                                        alias: null,
                                        args: null,
                                        concreteType: "User",
                                        name: "node",
                                        plural: false,
                                        selections: [
                                          ScalarField {
                                            alias: null,
                                            args: null,
                                            name: "name",
                                            storageKey: null,
                                          },
                                          ScalarField {
                                            alias: null,
                                            args: null,
                                            name: "id",
                                            storageKey: null,
                                          },
                                          ScalarField {
                                            alias: null,
                                            args: null,
                                            name: "__typename",
                                            storageKey: null,
                                          },
                                        ],
                                        storageKey: null,
                                      },
                                      ScalarField {
                                        alias: null,
                                        args: null,
                                        name: "cursor",
                                        storageKey: null,
                                      },
                                    ],
                                    storageKey: null,
                                  },
                                  LinkedField {
                                    alias: null,
                                    args: null,
                                    concreteType: "PageInfo",
                                    name: "pageInfo",
                                    plural: false,
                                    selections: [
                                      ScalarField {
                                        alias: null,
                                        args: null,
                                        name: "endCursor",
                                        storageKey: null,
                                      },
                                      ScalarField {
                                        alias: null,
                                        args: null,
                                        name: "hasNextPage",
                                        storageKey: null,
                                      },
                                    ],
                                    storageKey: null,
                                  },
                                ],
                                storageKey: "friends(first:10)",
                              },
                              LinkedHandle {
                                alias: null,
                                args: [
                                  Literal {
                                    name: "first",
                                    value: 10,
                                  },
                                ],
                                filters: null,
                                handle: "connection",
                                key: "NodeQuery_friends",
                                name: "friends",
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "id",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: "comments(first:10)",
              },
              LinkedHandle {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                filters: null,
                handle: "connection",
                key: "NodeQuery_comments",
                name: "comments",
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NodeQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    id
    ... on Story {
      comments(first: 10) {
        edges {
          node {
            actor {
              __typename
              name
              friends(first: 10) {
                edges {
                  node {
                    name
                    id
                    __typename
                  }
                  cursor
                }
                pageInfo {
                  endCursor
                  hasNextPage
                }
              }
              id
            }
            id
            __typename
          }
          cursor
        }
        pageInfo {
          endCursor
          hasNextPage
        }
      }
    }
  }
}

`;

exports[`compileRelayArtifacts matches expected output: connection-with-aliased-edges-pageInfo.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NodeQuery($id: ID!) {
  node(id: $id) {
    id
    ... on Story {
      comments(first: 10) @connection(key: "NodeQuery_comments") {
        commentEdges: edges {
          node {
            actor {
              name
            }
          }
        }
        commentPageInfo: pageInfo {
          hasNextPage
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: "comments",
                args: null,
                concreteType: "CommentsConnection",
                name: "__NodeQuery_comments_connection",
                plural: false,
                selections: [
                  LinkedField {
                    alias: "commentEdges",
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: null,
                            name: "actor",
                            plural: false,
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "name",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: "commentPageInfo",
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                concreteType: "CommentsConnection",
                name: "comments",
                plural: false,
                selections: [
                  LinkedField {
                    alias: "commentEdges",
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: null,
                            name: "actor",
                            plural: false,
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "__typename",
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "name",
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "id",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: "commentPageInfo",
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: "comments(first:10)",
              },
              LinkedHandle {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                filters: null,
                handle: "connection",
                key: "NodeQuery_comments",
                name: "comments",
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NodeQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    id
    ... on Story {
      comments(first: 10) {
        commentEdges: edges {
          node {
            actor {
              __typename
              name
              id
            }
            id
          }
        }
        commentPageInfo: pageInfo {
          hasNextPage
        }
        edges {
          cursor
          node {
            __typename
            id
          }
        }
        pageInfo {
          endCursor
          hasNextPage
        }
      }
    }
  }
}

`;

exports[`compileRelayArtifacts matches expected output: connection-with-dynamic-key.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query FeedbackQuery($id: ID!, $commentsKey: String) {
  node(id: $id) {
    ...FeedbackFragment
  }
}

query PaginationQuery(
  $id: ID!
  $commentsKey: String
  $count: Int!
  $cursor: ID!
) {
  node(id: $id) {
    ...FeedbackFragment @arguments(count: $count, cursor: $cursor)
  }
}

fragment FeedbackFragment on Feedback
  @argumentDefinitions(
    count: {type: "Int", defaultValue: 2}
    cursor: {type: "ID"}
  ) {
  id
  comments(after: $cursor, first: $count, orderby: "date")
    @connection(
      key: "FeedbackFragment_comments"
      dynamicKey_UNSTABLE: $commentsKey
      filters: ["orderby"]
    ) {
    edges {
      node {
        id
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "commentsKey",
        type: "String",
      },
    ],
    metadata: null,
    name: "FeedbackQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "FeedbackFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "commentsKey",
        type: "String",
      },
    ],
    name: "FeedbackQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 2,
                  },
                  Literal {
                    name: "orderby",
                    value: "date",
                  },
                ],
                concreteType: "CommentsConnection",
                name: "comments",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: "comments(first:2,orderby:\\"date\\")",
              },
              LinkedHandle {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 2,
                  },
                  Literal {
                    name: "orderby",
                    value: "date",
                  },
                ],
                filters: [
                  "orderby",
                ],
                handle: "connection",
                key: "FeedbackFragment_comments",
                name: "comments",
                dynamicKey: Variable {
                  name: "__dynamicKey",
                  variableName: "commentsKey",
                },
              },
            ],
            type: "Feedback",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query FeedbackQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...FeedbackFragment
    id
  }
}

fragment FeedbackFragment on Feedback {
  id
  comments(first: 2, orderby: "date") {
    edges {
      node {
        id
        __typename
      }
      cursor
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}


Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "commentsKey",
        type: "String",
      },
      LocalArgument {
        defaultValue: null,
        name: "count",
        type: "Int!",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "PaginationQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: [
              Variable {
                name: "count",
                variableName: "count",
              },
              Variable {
                name: "cursor",
                variableName: "cursor",
              },
            ],
            name: "FeedbackFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "commentsKey",
        type: "String",
      },
      LocalArgument {
        defaultValue: null,
        name: "count",
        type: "Int!",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID!",
      },
    ],
    name: "PaginationQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                  Literal {
                    name: "orderby",
                    value: "date",
                  },
                ],
                concreteType: "CommentsConnection",
                name: "comments",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
              LinkedHandle {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                  Literal {
                    name: "orderby",
                    value: "date",
                  },
                ],
                filters: [
                  "orderby",
                ],
                handle: "connection",
                key: "FeedbackFragment_comments",
                name: "comments",
                dynamicKey: Variable {
                  name: "__dynamicKey",
                  variableName: "commentsKey",
                },
              },
            ],
            type: "Feedback",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query PaginationQuery(
  $id: ID!
  $count: Int!
  $cursor: ID!
) {
  node(id: $id) {
    __typename
    ...FeedbackFragment_1G22uz
    id
  }
}

fragment FeedbackFragment_1G22uz on Feedback {
  id
  comments(after: $cursor, first: $count, orderby: "date") {
    edges {
      node {
        id
        __typename
      }
      cursor
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}


Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: 2,
      name: "count",
      type: "Int",
    },
    LocalArgument {
      defaultValue: null,
      name: "cursor",
      type: "ID",
    },
    RootArgument {
      name: "commentsKey",
      type: "String",
    },
  ],
  metadata: {
    "connection": [
      {
        "count": "count",
        "cursor": "cursor",
        "direction": "forward",
        "path": [
          "comments",
        ],
      },
    ],
  },
  name: "FeedbackFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: "comments",
      args: [
        Variable {
          name: "__dynamicKey",
          variableName: "commentsKey",
        },
        Literal {
          name: "orderby",
          value: "date",
        },
      ],
      concreteType: "CommentsConnection",
      name: "__FeedbackFragment_comments_connection",
      plural: false,
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "CommentsEdge",
          name: "edges",
          plural: true,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "Comment",
              name: "node",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "id",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "__typename",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
            ScalarField {
              alias: null,
              args: null,
              name: "cursor",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "PageInfo",
          name: "pageInfo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "endCursor",
              storageKey: null,
            },
            ScalarField {
              alias: null,
              args: null,
              name: "hasNextPage",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "Feedback",
}
`;

exports[`compileRelayArtifacts matches expected output: connection-with-dynamic-key-missing-variable-definition.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query FeedbackQuery($id: ID!) {
  node(id: $id) {
    ...FeedbackFragment
  }
}

query PaginationQuery($id: ID!, $count: Int!, $cursor: ID!) {
  node(id: $id) {
    ...FeedbackFragment @arguments(count: $count, cursor: $cursor)
  }
}

fragment FeedbackFragment on Feedback
  @argumentDefinitions(
    count: {type: "Int", defaultValue: 2}
    cursor: {type: "ID"}
  ) {
  id
  comments(after: $cursor, first: $count, orderby: "date")
    @connection(
      key: "FeedbackFragment_comments"
      dynamicKey_UNSTABLE: $commentsKey
      filters: ["orderby"]
    ) {
    edges {
      node {
        id
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Encountered 2 errors:
- Operation 'FeedbackQuery' references undefined variable(s):
  - $commentsKey: String.
  
  Source (derived): GraphQL request (23:28)
  22:       key: "FeedbackFragment_comments"
  23:       dynamicKey_UNSTABLE: $commentsKey
                                 ^
  24:       filters: ["orderby"]
  
- Operation 'PaginationQuery' references undefined variable(s):
  - $commentsKey: String.
  
  Source (derived): GraphQL request (23:28)
  22:       key: "FeedbackFragment_comments"
  23:       dynamicKey_UNSTABLE: $commentsKey
                                 ^
  24:       filters: ["orderby"]
  
`;

exports[`compileRelayArtifacts matches expected output: defer-multiple-fragments-same-parent.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query QueryWithMultipeDeferredFragmentsOnSameParent($id: ID!) {
  feedback: node(id: $id) {
    id
    ...FeedbackComments_feedback @defer
    ...FeedbackText_feedback @defer
  }
}

fragment FeedbackComments_feedback on Feedback {
  comments(first: 10) {
    edges {
      node {
        id
      }
    }
    pageInfo {
      hasNextPage
    }
  }
}

fragment FeedbackText_feedback on Feedback {
  body {
    text
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "QueryWithMultipeDeferredFragmentsOnSameParent",
    selections: [
      LinkedField {
        alias: "feedback",
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          Defer {
            selections: [
              FragmentSpread {
                args: null,
                name: "FeedbackComments_feedback",
              },
            ],
          },
          Defer {
            selections: [
              FragmentSpread {
                args: null,
                name: "FeedbackText_feedback",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "QueryWithMultipeDeferredFragmentsOnSameParent",
    selections: [
      LinkedField {
        alias: "feedback",
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          Defer {
            if: null,
            label: "QueryWithMultipeDeferredFragmentsOnSameParent$defer$FeedbackComments_feedback",
            metadata: null,
            selections: [
              InlineFragment {
                selections: [
                  LinkedField {
                    alias: null,
                    args: [
                      Literal {
                        name: "first",
                        value: 10,
                      },
                    ],
                    concreteType: "CommentsConnection",
                    name: "comments",
                    plural: false,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "CommentsEdge",
                        name: "edges",
                        plural: true,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: "Comment",
                            name: "node",
                            plural: false,
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "id",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "PageInfo",
                        name: "pageInfo",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "hasNextPage",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: "comments(first:10)",
                  },
                ],
                type: "Feedback",
              },
            ],
          },
          Defer {
            if: null,
            label: "QueryWithMultipeDeferredFragmentsOnSameParent$defer$FeedbackText_feedback",
            metadata: null,
            selections: [
              InlineFragment {
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "Text",
                    name: "body",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "text",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                type: "Feedback",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query QueryWithMultipeDeferredFragmentsOnSameParent(
  $id: ID!
) {
  feedback: node(id: $id) {
    __typename
    id
    ...FeedbackComments_feedback @defer(label: "QueryWithMultipeDeferredFragmentsOnSameParent$defer$FeedbackComments_feedback")
    ...FeedbackText_feedback @defer(label: "QueryWithMultipeDeferredFragmentsOnSameParent$defer$FeedbackText_feedback")
  }
}

fragment FeedbackComments_feedback on Feedback {
  comments(first: 10) {
    edges {
      node {
        id
      }
    }
    pageInfo {
      hasNextPage
    }
  }
}

fragment FeedbackText_feedback on Feedback {
  body {
    text
  }
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "FeedbackComments_feedback",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "first",
          value: 10,
        },
      ],
      concreteType: "CommentsConnection",
      name: "comments",
      plural: false,
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "CommentsEdge",
          name: "edges",
          plural: true,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "Comment",
              name: "node",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "id",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "PageInfo",
          name: "pageInfo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "hasNextPage",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
      storageKey: "comments(first:10)",
    },
  ],
  type: "Feedback",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "FeedbackText_feedback",
  selections: [
    LinkedField {
      alias: null,
      args: null,
      concreteType: "Text",
      name: "body",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "Feedback",
}
`;

exports[`compileRelayArtifacts matches expected output: explicit-null-argument.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query Test {
  # The compiler currently strips this null which isn't right.
  node(id: null) {
    __typename
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "Test",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "Test",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query Test {
  node {
    __typename
    id
  }
}

`;

exports[`compileRelayArtifacts matches expected output: false-positive-circular-fragment-reference-regression.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query TestQuery {
  viewer {
    ...MyViewer
    ...MyOtherViewer
    actor {
      name
    }
  }
}

fragment MyViewer on Viewer {
  ...MyNestedViewer
}

fragment MyOtherViewer on Viewer {
  ...MyNestedViewer
}

fragment MyNestedViewer on Viewer
  @argumentDefinitions(includeEmail: {type: "Boolean!", defaultValue: false}) {
  primaryEmail @include(if: $includeEmail)
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
          FragmentSpread {
            args: null,
            name: "MyViewer",
          },
          FragmentSpread {
            args: null,
            name: "MyOtherViewer",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query TestQuery {
  viewer {
    actor {
      __typename
      name
      id
    }
  }
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MyViewer",
  selections: [
    FragmentSpread {
      args: null,
      name: "MyNestedViewer",
    },
  ],
  type: "Viewer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MyOtherViewer",
  selections: [
    FragmentSpread {
      args: null,
      name: "MyNestedViewer",
    },
  ],
  type: "Viewer",
}

Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: false,
      name: "includeEmail",
      type: "Boolean!",
    },
  ],
  metadata: null,
  name: "MyNestedViewer",
  selections: [
    Condition {
      condition: "includeEmail",
      passingValue: true,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "primaryEmail",
          storageKey: null,
        },
      ],
    },
  ],
  type: "Viewer",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-on-node-interface.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableFragment on Node
  @refetchable(queryName: "RefetchableFragmentQuery") {
  id
  ... on User {
    name
    ...ProfilePicture
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "RefetchableFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "size",
                    variableName: "size",
                  },
                ],
                concreteType: "Image",
                name: "profilePicture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $size: [Int]
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...RefetchableFragment
    id
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

fragment RefetchableFragment on Node {
  id
  ... on User {
    name
    ...ProfilePicture
  }
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: {
    "refetch": {
      "connection": null,
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "RefetchableFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    InlineFragment {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
        FragmentSpread {
          args: null,
          name: "ProfilePicture",
        },
      ],
      type: "User",
    },
  ],
  type: "Node",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "ProfilePicture",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-on-non-node-fetchable-type.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableFragment on NonNodeStory
  @refetchable(queryName: "RefetchableFragmentQuery") {
  actor {
    ...ProfilePicture
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "input_fetch_id",
            variableName: "id",
          },
        ],
        concreteType: "NonNodeStory",
        name: "fetch__NonNodeStory",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "RefetchableFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "input_fetch_id",
            variableName: "id",
          },
        ],
        concreteType: "NonNodeStory",
        name: "fetch__NonNodeStory",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
              InlineFragment {
                selections: [
                  LinkedField {
                    alias: null,
                    args: [
                      Variable {
                        name: "size",
                        variableName: "size",
                      },
                    ],
                    concreteType: "Image",
                    name: "profilePicture",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "uri",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                type: "User",
              },
            ],
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "fetch_id",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $size: [Int]
  $id: ID!
) {
  fetch__NonNodeStory(input_fetch_id: $id) {
    ...RefetchableFragment
    id
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

fragment RefetchableFragment on NonNodeStory {
  actor {
    __typename
    ...ProfilePicture
    id
  }
  fetch_id
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: {
    "refetch": {
      "connection": null,
      "fragmentPathInResult": [
        "fetch__NonNodeStory",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
      "identifierField": "fetch_id",
    },
  },
  name: "RefetchableFragment",
  selections: [
    LinkedField {
      alias: null,
      args: null,
      concreteType: null,
      name: "actor",
      plural: false,
      selections: [
        FragmentSpread {
          args: null,
          name: "ProfilePicture",
        },
      ],
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "fetch_id",
      storageKey: null,
    },
  ],
  type: "NonNodeStory",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "ProfilePicture",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-on-object-implementing-node-interface.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableFragment on User
  @refetchable(queryName: "RefetchableFragmentQuery") {
  id
  name
  ...ProfilePicture
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "RefetchableFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "size",
                    variableName: "size",
                  },
                ],
                concreteType: "Image",
                name: "profilePicture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $size: [Int]
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...RefetchableFragment
    id
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

fragment RefetchableFragment on User {
  id
  name
  ...ProfilePicture
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: {
    "refetch": {
      "connection": null,
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "RefetchableFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "name",
      storageKey: null,
    },
    FragmentSpread {
      args: null,
      name: "ProfilePicture",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "ProfilePicture",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-on-query.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableFragment on Query
  @refetchable(queryName: "RefetchableFragmentQuery")
  @argumentDefinitions(id: {type: "ID!"}) {
  node(id: $id) {
    ... on User {
      id
      name
      ...ProfilePicture
    }
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      FragmentSpread {
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        name: "RefetchableFragment",
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "size",
                    variableName: "size",
                  },
                ],
                concreteType: "Image",
                name: "profilePicture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $id: ID!
  $size: [Int]
) {
  ...RefetchableFragment_1Bmzm5
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

fragment RefetchableFragment_1Bmzm5 on Query {
  node(id: $id) {
    __typename
    ... on User {
      id
      name
      ...ProfilePicture
    }
    id
  }
}


Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: null,
      name: "id",
      type: "ID!",
    },
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: {
    "refetch": {
      "connection": null,
      "fragmentPathInResult": [],
      "operation": require('RefetchableFragmentQuery.graphql'),
    },
  },
  name: "RefetchableFragment",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "id",
          variableName: "id",
        },
      ],
      concreteType: null,
      name: "node",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "id",
              storageKey: null,
            },
            ScalarField {
              alias: null,
              args: null,
              name: "name",
              storageKey: null,
            },
            FragmentSpread {
              args: null,
              name: "ProfilePicture",
            },
          ],
          type: "User",
        },
      ],
      storageKey: null,
    },
  ],
  type: "Query",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "ProfilePicture",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-on-query-with-cycle.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
fragment RefetchableFragment on Query
  @refetchable(queryName: "RefetchableFragmentQuery")
  @argumentDefinitions(id: {type: "ID!"}) {
  node(id: $id) {
    ... on User {
      id
      name
      ...Profile @arguments(includeProfile: true)
    }
  }
}

fragment Profile on User
  @argumentDefinitions(
    includeProfile: {type: "Boolean!", defaultValue: false}
  ) {
  id
  name
  profilePicture(size: $pictureSize) {
    uri
  }
  friends(first: $count) {
    edges {
      node {
        ...Profile
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Error: Found a circular reference from fragment 'Profile'.

Source (derived): GraphQL request (2:1)
1: # expected-to-throw
2: fragment RefetchableFragment on Query
   ^
3:   @refetchable(queryName: "RefetchableFragmentQuery")

Source (derived): GraphQL request (2:1)
1: # expected-to-throw
2: fragment RefetchableFragment on Query
   ^
3:   @refetchable(queryName: "RefetchableFragmentQuery")

Source: GraphQL request (9:7)
 8:       name
 9:       ...Profile @arguments(includeProfile: true)
          ^
10:     }

Source: GraphQL request (26:9)
25:       node {
26:         ...Profile
            ^
27:       }

Source: GraphQL request (26:9)
25:       node {
26:         ...Profile
            ^
27:       }

`;

exports[`compileRelayArtifacts matches expected output: fragment-on-viewer.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableFragment on Viewer
  @refetchable(queryName: "RefetchableFragmentQuery") {
  actor {
    id
    name
    ...ProfilePicture
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "RefetchableFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              InlineFragment {
                selections: [
                  LinkedField {
                    alias: null,
                    args: [
                      Variable {
                        name: "size",
                        variableName: "size",
                      },
                    ],
                    concreteType: "Image",
                    name: "profilePicture",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "uri",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                type: "User",
              },
            ],
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $size: [Int]
) {
  viewer {
    ...RefetchableFragment
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

fragment RefetchableFragment on Viewer {
  actor {
    __typename
    id
    name
    ...ProfilePicture
  }
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: {
    "refetch": {
      "connection": null,
      "fragmentPathInResult": [
        "viewer",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
    },
  },
  name: "RefetchableFragment",
  selections: [
    LinkedField {
      alias: null,
      args: null,
      concreteType: null,
      name: "actor",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
        FragmentSpread {
          args: null,
          name: "ProfilePicture",
        },
      ],
      storageKey: null,
    },
  ],
  type: "Viewer",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "ProfilePicture",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-with-defer-arguments.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query QueryWithFragmentWithDefer {
  me {
    id
    ...UserFragment
  }
}

fragment UserFragment on User {
  id
  emailAddresses
  ...DeferredFragment
    @defer(label: "DeferredFragmentLabel")
    @arguments(scale: 1.5)
}

fragment DeferredFragment on User @argumentDefinitions(scale: {type: "Float"}) {
  id
  name
  profile_picture(scale: $scale) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "QueryWithFragmentWithDefer",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          FragmentSpread {
            args: null,
            name: "UserFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "QueryWithFragmentWithDefer",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "emailAddresses",
            storageKey: null,
          },
          Defer {
            if: null,
            label: "UserFragment$defer$DeferredFragmentLabel",
            metadata: null,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "scale",
                    value: 1.5,
                  },
                ],
                concreteType: "Image",
                name: "profile_picture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: "profile_picture(scale:1.5)",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query QueryWithFragmentWithDefer {
  me {
    id
    ...UserFragment
  }
}

fragment DeferredFragment_QMvSr on User {
  id
  name
  profile_picture(scale: 1.5) {
    uri
  }
}

fragment UserFragment on User {
  id
  emailAddresses
  ...DeferredFragment_QMvSr @defer(label: "UserFragment$defer$DeferredFragmentLabel")
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "UserFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "emailAddresses",
      storageKey: null,
    },
    Defer {
      selections: [
        FragmentSpread {
          args: [
            Literal {
              name: "scale",
              value: 1.5,
            },
          ],
          name: "DeferredFragment",
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: null,
      name: "scale",
      type: "Float",
    },
  ],
  metadata: null,
  name: "DeferredFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "name",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "scale",
          variableName: "scale",
        },
      ],
      concreteType: "Image",
      name: "profile_picture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-with-defer-arguments-without-label.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query QueryWithFragmentWithDefer {
  me {
    id
    ...UserFragment
  }
}

fragment UserFragment on User {
  id
  emailAddresses
  ...DeferredFragment @defer @arguments(scale: 1.5)
  ...DeferredFragment @defer @arguments(scale: 2)
}

fragment DeferredFragment on User @argumentDefinitions(scale: {type: "Float"}) {
  id
  name
  profile_picture(scale: $scale) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "QueryWithFragmentWithDefer",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          FragmentSpread {
            args: null,
            name: "UserFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "QueryWithFragmentWithDefer",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "emailAddresses",
            storageKey: null,
          },
          Defer {
            if: null,
            label: "UserFragment$defer$DeferredFragment_4edD5n",
            metadata: null,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "scale",
                    value: 1.5,
                  },
                ],
                concreteType: "Image",
                name: "profile_picture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: "profile_picture(scale:1.5)",
              },
            ],
          },
          Defer {
            if: null,
            label: "UserFragment$defer$DeferredFragment_2gdat4",
            metadata: null,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "scale",
                    value: 2,
                  },
                ],
                concreteType: "Image",
                name: "profile_picture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: "profile_picture(scale:2)",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query QueryWithFragmentWithDefer {
  me {
    id
    ...UserFragment
  }
}

fragment DeferredFragment_42I9Ds on User {
  id
  name
  profile_picture(scale: 2) {
    uri
  }
}

fragment DeferredFragment_QMvSr on User {
  id
  name
  profile_picture(scale: 1.5) {
    uri
  }
}

fragment UserFragment on User {
  id
  emailAddresses
  ...DeferredFragment_QMvSr @defer(label: "UserFragment$defer$DeferredFragment_4edD5n")
  ...DeferredFragment_42I9Ds @defer(label: "UserFragment$defer$DeferredFragment_2gdat4")
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "UserFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "emailAddresses",
      storageKey: null,
    },
    Defer {
      selections: [
        FragmentSpread {
          args: [
            Literal {
              name: "scale",
              value: 1.5,
            },
          ],
          name: "DeferredFragment",
        },
      ],
    },
    Defer {
      selections: [
        FragmentSpread {
          args: [
            Literal {
              name: "scale",
              value: 2,
            },
          ],
          name: "DeferredFragment",
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: null,
      name: "scale",
      type: "Float",
    },
  ],
  metadata: null,
  name: "DeferredFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "name",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "scale",
          variableName: "scale",
        },
      ],
      concreteType: "Image",
      name: "profile_picture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-with-defer-on-abstract-type.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query QueryWithFragmentWithDefer {
  node(id: "my-id") {
    ...NodeFragment @defer(label: "node")
  }
}

fragment NodeFragment on Node {
  id
  ... on User {
    name
  }
  ... on Page {
    websites
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "QueryWithFragmentWithDefer",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Literal {
            name: "id",
            value: "my-id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          Defer {
            selections: [
              FragmentSpread {
                args: null,
                name: "NodeFragment",
              },
            ],
          },
        ],
        storageKey: "node(id:\\"my-id\\")",
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "QueryWithFragmentWithDefer",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Literal {
            name: "id",
            value: "my-id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          Defer {
            if: null,
            label: "QueryWithFragmentWithDefer$defer$node",
            metadata: null,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
              InlineFragment {
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "name",
                    storageKey: null,
                  },
                ],
                type: "User",
              },
              InlineFragment {
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "websites",
                    storageKey: null,
                  },
                ],
                type: "Page",
              },
            ],
          },
        ],
        storageKey: "node(id:\\"my-id\\")",
      },
    ],
  },
}

QUERY:

query QueryWithFragmentWithDefer {
  node(id: "my-id") {
    __typename
    ...NodeFragment @defer(label: "QueryWithFragmentWithDefer$defer$node")
    id
  }
}

fragment NodeFragment on Node {
  id
  ... on User {
    name
  }
  ... on Page {
    websites
  }
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NodeFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    InlineFragment {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
      ],
      type: "User",
    },
    InlineFragment {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "websites",
          storageKey: null,
        },
      ],
      type: "Page",
    },
  ],
  type: "Node",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-with-defer-on-client.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query QueryWithFragmentWithDefer {
  me {
    id
    ...UserFragment
  }
}

fragment UserFragment on User {
  id
  emailAddresses
  clientUser {
    ...DeferredFragment @defer(label: "DeferredFragmentLabel")
  }
}

extend type User {
  clientUser: ClientUser
}

fragment DeferredFragment on ClientUser {
  clientname
}

interface ClientUser {
  id: String
  clientname: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Unexpected directive: @defer. This directive can only be used on fields/fragments that are fetched from the server schema, but it is used inside a client-only selection.

Source (derived): GraphQL request (13:25)
12:   clientUser {
13:     ...DeferredFragment @defer(label: "DeferredFragmentLabel")
                            ^
14:   }

Source: GraphQL request (12:3)
11:   emailAddresses
12:   clientUser {
      ^
13:     ...DeferredFragment @defer(label: "DeferredFragmentLabel")

`;

exports[`compileRelayArtifacts matches expected output: fragment-with-match-directive.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment NameRendererFragment on User {
  id
  nameRenderer @match {
    ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "supported",
          value: [
            "PlainUserNameRenderer",
            "MarkdownUserNameRenderer",
          ],
        },
      ],
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "PlainUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "PlainUserNameRenderer",
        },
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
      ],
      storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-with-match-directive-with-literal-condition.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query Test($use3D: Boolean!) {
  node {
    ... on User {
      nameRenderer {
        ...MarkdownUserNameRenderer_name
      }
      ...UserFragment_with3d @arguments(use3D: $use3D)
    }
  }
}

query Test2 {
  node {
    ...UserFragment_with3d
  }
}

fragment UserFragment_with3d on User
  @argumentDefinitions(use3D: {type: "Boolean!", defaultValue: false}) {
  id
  name
  ... @include(if: $use3D) {
    test: nameRenderer {
      ...MarkdownUserNameRenderer_name
        @module(name: "MarkdownUserNameRenderer.react")
    }
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "use3D",
        type: "Boolean!",
      },
    ],
    metadata: null,
    name: "Test",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  FragmentSpread {
                    args: null,
                    name: "MarkdownUserNameRenderer_name",
                  },
                ],
                storageKey: null,
              },
              FragmentSpread {
                args: [
                  Variable {
                    name: "use3D",
                    variableName: "use3D",
                  },
                ],
                name: "UserFragment_with3d",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "use3D",
        type: "Boolean!",
      },
    ],
    name: "Test",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "markdown",
                        storageKey: null,
                      },
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "MarkdownUserNameData",
                        name: "data",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "markup",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              Condition {
                condition: "use3D",
                passingValue: true,
                selections: [
                  LinkedField {
                    alias: "test",
                    args: null,
                    concreteType: null,
                    name: "nameRenderer",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "__typename",
                        storageKey: null,
                      },
                      InlineFragment {
                        selections: [
                          ModuleImport {
                            documentName: "UserFragment_with3d",
                            fragmentName: "MarkdownUserNameRenderer_name",
                            fragmentPropName: "name",
                          },
                        ],
                        type: "MarkdownUserNameRenderer",
                      },
                    ],
                    storageKey: null,
                  },
                ],
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query Test(
  $use3D: Boolean!
) {
  node {
    __typename
    ... on User {
      nameRenderer {
        __typename
        ...MarkdownUserNameRenderer_name
      }
      ...UserFragment_with3d_1RtaO1
    }
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment UserFragment_with3d_1RtaO1 on User {
  id
  name
  test: nameRenderer @include(if: $use3D) {
    __typename
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_UserFragment_with3d: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "UserFragment_with3d.test")
      __module_component_UserFragment_with3d: js(module: "MarkdownUserNameRenderer.react", id: "UserFragment_with3d.test")
    }
  }
}


Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "Test2",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "UserFragment_with3d",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "Test2",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query Test2 {
  node {
    __typename
    ...UserFragment_with3d
    id
  }
}

fragment UserFragment_with3d on User {
  id
  name
}


SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: false,
      name: "use3D",
      type: "Boolean!",
    },
  ],
  metadata: null,
  name: "UserFragment_with3d",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "name",
      storageKey: null,
    },
    Condition {
      condition: "use3D",
      passingValue: true,
      selections: [
        LinkedField {
          alias: "test",
          args: null,
          concreteType: null,
          name: "nameRenderer",
          plural: false,
          selections: [
            InlineFragment {
              selections: [
                ModuleImport {
                  documentName: "UserFragment_with3d",
                  fragmentName: "MarkdownUserNameRenderer_name",
                  fragmentPropName: "name",
                },
              ],
              type: "MarkdownUserNameRenderer",
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: fragment-with-stream.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query QueryWithFragmentWithStream($id: ID!) {
  node(id: $id) {
    id
    ...FeedbackFragment
  }
}

fragment FeedbackFragment on Feedback {
  id
  actors @stream(initial_count: 1, label: "StreamedActorsLabel") {
    name
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "QueryWithFragmentWithStream",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          FragmentSpread {
            args: null,
            name: "FeedbackFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "QueryWithFragmentWithStream",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              Stream {
                if: null,
                label: "FeedbackFragment$stream$StreamedActorsLabel",
                metadata: null,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: null,
                    name: "actors",
                    plural: true,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "__typename",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "name",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "id",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                useCustomizedBatch: null,
              },
            ],
            type: "Feedback",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query QueryWithFragmentWithStream(
  $id: ID!
) {
  node(id: $id) {
    __typename
    id
    ...FeedbackFragment
  }
}

fragment FeedbackFragment on Feedback {
  id
  actors @stream(label: "FeedbackFragment$stream$StreamedActorsLabel", initial_count: 1) {
    __typename
    name
    id
  }
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "FeedbackFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    Stream {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: null,
          name: "actors",
          plural: true,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "name",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "Feedback",
}
`;

exports[`compileRelayArtifacts matches expected output: id-as-alias.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
fragment User_fragment on User {
  id: name
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    id: uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Encountered 2 errors:
- Relay does not allow aliasing fields to \`id\`. This name is reserved for the globally unique \`id\` field on \`Node\`.
  
  Source: GraphQL request (3:3)
  2: fragment User_fragment on User {
  3:   id: name
       ^
  4: }
  
- Relay does not allow aliasing fields to \`id\`. This name is reserved for the globally unique \`id\` field on \`Node\`.
  
  Source: GraphQL request (8:5)
  7:   profilePicture(size: $size) {
  8:     id: uri
         ^
  9:   }
  
`;

exports[`compileRelayArtifacts matches expected output: inline-and-mask-are-incompatible.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw

fragment ParentFragment on Query {
  me {
    ...Profile @relay(mask: false)
  }
}

fragment Profile on User @inline {
  id
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Cannot use @relay(mask: false) on fragment spreads for fragments with directives.

Source: GraphQL request (5:5)
4:   me {
5:     ...Profile @relay(mask: false)
       ^
6:   }

Source: GraphQL request (9:26)
 8: 
 9: fragment Profile on User @inline {
                             ^
10:   id

`;

exports[`compileRelayArtifacts matches expected output: inline-data-fragment.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query Test {
  ...ParentFragment
}

fragment ParentFragment on Query {
  me {
    # No refinement needed, field and fragment are both User.
    ...Profile
    profilePicture(size: 100) {
      uri
      height
    }
  }

  username(name: "test") {
    # Should refine from type Actor to User.
    ...Profile
  }
}

fragment Profile on User @inline {
  profilePicture(size: 100) {
    uri
    width
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "Test",
    selections: [
      FragmentSpread {
        args: null,
        name: "ParentFragment",
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "Test",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: [
              Literal {
                name: "size",
                value: 100,
              },
            ],
            concreteType: "Image",
            name: "profilePicture",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "uri",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "width",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "height",
                storageKey: null,
              },
            ],
            storageKey: "profilePicture(size:100)",
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
      LinkedField {
        alias: null,
        args: [
          Literal {
            name: "name",
            value: "test",
          },
        ],
        concreteType: null,
        name: "username",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "size",
                    value: 100,
                  },
                ],
                concreteType: "Image",
                name: "profilePicture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "width",
                    storageKey: null,
                  },
                ],
                storageKey: "profilePicture(size:100)",
              },
            ],
            type: "User",
          },
        ],
        storageKey: "username(name:\\"test\\")",
      },
    ],
  },
}

QUERY:

query Test {
  ...ParentFragment
}

fragment ParentFragment on Query {
  me {
    ...Profile
    profilePicture(size: 100) {
      uri
      height
    }
    id
  }
  username(name: "test") {
    __typename
    ...Profile
    id
  }
}

fragment Profile on User {
  profilePicture(size: 100) {
    uri
    width
  }
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "ParentFragment",
  selections: [
    LinkedField {
      alias: null,
      args: null,
      concreteType: "User",
      name: "me",
      plural: false,
      selections: [
        LinkedField {
          alias: null,
          args: [
            Literal {
              name: "size",
              value: 100,
            },
          ],
          concreteType: "Image",
          name: "profilePicture",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "uri",
              storageKey: null,
            },
            ScalarField {
              alias: null,
              args: null,
              name: "height",
              storageKey: null,
            },
          ],
          storageKey: "profilePicture(size:100)",
        },
        InlineDataFragmentSpread {
          name: "Profile",
          selections: [
            LinkedField {
              alias: null,
              args: [
                Literal {
                  name: "size",
                  value: 100,
                },
              ],
              concreteType: "Image",
              name: "profilePicture",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "uri",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "width",
                  storageKey: null,
                },
              ],
              storageKey: "profilePicture(size:100)",
            },
          ],
        },
      ],
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "name",
          value: "test",
        },
      ],
      concreteType: null,
      name: "username",
      plural: false,
      selections: [
        InlineDataFragmentSpread {
          name: "Profile",
          selections: [
            InlineFragment {
              selections: [
                LinkedField {
                  alias: null,
                  args: [
                    Literal {
                      name: "size",
                      value: 100,
                    },
                  ],
                  concreteType: "Image",
                  name: "profilePicture",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "uri",
                      storageKey: null,
                    },
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "width",
                      storageKey: null,
                    },
                  ],
                  storageKey: "profilePicture(size:100)",
                },
              ],
              type: "User",
            },
          ],
        },
      ],
      storageKey: "username(name:\\"test\\")",
    },
  ],
  type: "Query",
}

InlineDataFragment {
  name: "Profile",
}
`;

exports[`compileRelayArtifacts matches expected output: inline-data-fragment-global-vars.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw

fragment ParentFragment on Query {
  me {
    ...Profile
  }
}

fragment Profile on User @inline {
  profilePicture(size: $pictureSize) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Variables are not yet supported inside @inline fragments.

Source: GraphQL request (10:24)
 9: fragment Profile on User @inline {
10:   profilePicture(size: $pictureSize) {
                           ^
11:     uri

`;

exports[`compileRelayArtifacts matches expected output: inline-data-fragment-local-args.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw

fragment ParentFragment on Query {
  usingLiteralPassedValue: me {
    ...Profile @arguments(sizeArg: [100])
  }
  usingGlobalPassedValue: me {
    ...Profile @arguments(sizeArg: $globalSizeVar)
  }
  usingDefaultValue: me {
    ...Profile
  }
}

fragment Profile on User
  @inline
  @argumentDefinitions(sizeArg: {type: "[Int]", defaultValue: [50]}) {
  profilePicture(size: $sizeArg) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Variables are not yet supported inside @inline fragments.

Source: GraphQL request (17:24)
16:   @inline
17:   @argumentDefinitions(sizeArg: {type: "[Int]", defaultValue: [50]}) {
                           ^
18:   profilePicture(size: $sizeArg) {

`;

exports[`compileRelayArtifacts matches expected output: kitchen-sink.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NodeQuery($id: ID!, $cond: Boolean!, $PictureSize: [Int]!) {
  node(id: $id) {
    id
    ... on User @include(if: $cond) {
      name
    }
    ...UserFragment @include(if: $cond) @arguments(size: $PictureSize)
  }
}

fragment UserFragment on User
  @argumentDefinitions(
    after: {type: "ID"}
    cond: {type: "Boolean!", defaultValue: false}
    first: {type: "Int", defaultValue: 5}
    size: {type: "[Int]"}
  ) {
  id
  __typename
  friends(after: $after, first: $first) {
    count
  }
  name @include(if: $cond)
  thumbnail: profilePicture(size: 32) {
    height
    width
    src: uri
  }
  profilePicture(size: $size) {
    height
    width
    src: uri
  }
  scaled: profilePicture(size: $PictureSize) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "cond",
        type: "Boolean!",
      },
      LocalArgument {
        defaultValue: null,
        name: "PictureSize",
        type: "[Int]!",
      },
    ],
    metadata: null,
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          Condition {
            condition: "cond",
            passingValue: true,
            selections: [
              InlineFragment {
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "name",
                    storageKey: null,
                  },
                ],
                type: "User",
              },
              FragmentSpread {
                args: [
                  Variable {
                    name: "size",
                    variableName: "PictureSize",
                  },
                ],
                name: "UserFragment",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "cond",
        type: "Boolean!",
      },
      LocalArgument {
        defaultValue: null,
        name: "PictureSize",
        type: "[Int]!",
      },
    ],
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          Condition {
            condition: "cond",
            passingValue: true,
            selections: [
              InlineFragment {
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "name",
                    storageKey: null,
                  },
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: [
                      Literal {
                        name: "first",
                        value: 5,
                      },
                    ],
                    concreteType: "FriendsConnection",
                    name: "friends",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "count",
                        storageKey: null,
                      },
                    ],
                    storageKey: "friends(first:5)",
                  },
                  LinkedField {
                    alias: "thumbnail",
                    args: [
                      Literal {
                        name: "size",
                        value: 32,
                      },
                    ],
                    concreteType: "Image",
                    name: "profilePicture",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "height",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "width",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: "src",
                        args: null,
                        name: "uri",
                        storageKey: null,
                      },
                    ],
                    storageKey: "profilePicture(size:32)",
                  },
                  LinkedField {
                    alias: null,
                    args: [
                      Variable {
                        name: "size",
                        variableName: "PictureSize",
                      },
                    ],
                    concreteType: "Image",
                    name: "profilePicture",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "height",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "width",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: "src",
                        args: null,
                        name: "uri",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: "scaled",
                    args: [
                      Variable {
                        name: "size",
                        variableName: "PictureSize",
                      },
                    ],
                    concreteType: "Image",
                    name: "profilePicture",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "uri",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                type: "User",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NodeQuery(
  $id: ID!
  $cond: Boolean!
  $PictureSize: [Int]!
) {
  node(id: $id) {
    __typename
    id
    ... on User @include(if: $cond) {
      name
    }
  ...UserFragment_3M2EvT @include(if: $cond)
  }
}

fragment UserFragment_3M2EvT on User {
  id
  __typename
  friends(first: 5) {
    count
  }
  thumbnail: profilePicture(size: 32) {
    height
    width
    src: uri
  }
  profilePicture(size: $PictureSize) {
    height
    width
    src: uri
  }
  scaled: profilePicture(size: $PictureSize) {
    uri
  }
}


Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: null,
      name: "after",
      type: "ID",
    },
    LocalArgument {
      defaultValue: false,
      name: "cond",
      type: "Boolean!",
    },
    LocalArgument {
      defaultValue: 5,
      name: "first",
      type: "Int",
    },
    LocalArgument {
      defaultValue: null,
      name: "size",
      type: "[Int]",
    },
    RootArgument {
      name: "PictureSize",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "UserFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "__typename",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "after",
          variableName: "after",
        },
        Variable {
          name: "first",
          variableName: "first",
        },
      ],
      concreteType: "FriendsConnection",
      name: "friends",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "count",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
    LinkedField {
      alias: "thumbnail",
      args: [
        Literal {
          name: "size",
          value: 32,
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "height",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "width",
          storageKey: null,
        },
        ScalarField {
          alias: "src",
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: "profilePicture(size:32)",
    },
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "height",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "width",
          storageKey: null,
        },
        ScalarField {
          alias: "src",
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
    LinkedField {
      alias: "scaled",
      args: [
        Variable {
          name: "size",
          variableName: "PictureSize",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
    Condition {
      condition: "cond",
      passingValue: true,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: linked-handle-field.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query LinkedHandleField($id: ID!) {
  node(id: $id) {
    ... on User {
      friends(first: 10) @__clientField(handle: "clientFriends") {
        count
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "LinkedHandleField",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          InlineFragment {
            selections: [
              LinkedField {
                alias: "friends",
                args: null,
                concreteType: "FriendsConnection",
                name: "__friends_clientFriends",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "count",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "LinkedHandleField",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                concreteType: "FriendsConnection",
                name: "friends",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "count",
                    storageKey: null,
                  },
                ],
                storageKey: "friends(first:10)",
              },
              LinkedHandle {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                filters: null,
                handle: "clientFriends",
                key: "",
                name: "friends",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query LinkedHandleField(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ... on User {
      friends(first: 10) {
        count
      }
    }
    id
  }
}

`;

exports[`compileRelayArtifacts matches expected output: match-field-overlap-across-documents.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query MultipleNameRendererQuery($id: ID!) {
  node(id: $id) {
    ...FooNameRendererFragment
    ...BarNameRendererFragment
  }
}

fragment FooNameRendererFragment on User {
  id
  nameRenderer @match {
    ...MarkdownUserNameRenderer_name
      @module(name: "FooMarkdownUserNameRenderer.react")
  }
}

fragment BarNameRendererFragment on User {
  # same field and supported types as above but different selections:
  # should flatten together
  nameRenderer @match {
    ...MarkdownUserNameRenderer_name
      @module(name: "BarMarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Found conflicting @module selections: use a unique alias on the parent fields.

Source: GraphQL request (22:7)
21:     ...MarkdownUserNameRenderer_name
22:       @module(name: "BarMarkdownUserNameRenderer.react")
          ^
23:   }

Source: GraphQL request (13:7)
12:     ...MarkdownUserNameRenderer_name
13:       @module(name: "FooMarkdownUserNameRenderer.react")
          ^
14:   }

`;

exports[`compileRelayArtifacts matches expected output: match-on-child-of-plural.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment ActorsRendererFragment on Node {
  id
  actors {
    nameRenderer @match {
      ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
      ...MarkdownUserNameRenderer_name
        @module(name: "MarkdownUserNameRenderer.react")
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "ActorsRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: null,
      name: "actors",
      plural: true,
      selections: [
        LinkedField {
          alias: null,
          args: [
            Literal {
              name: "supported",
              value: [
                "PlainUserNameRenderer",
                "MarkdownUserNameRenderer",
              ],
            },
          ],
          concreteType: null,
          name: "nameRenderer",
          plural: false,
          selections: [
            InlineFragment {
              selections: [
                ModuleImport {
                  documentName: "ActorsRendererFragment",
                  fragmentName: "PlainUserNameRenderer_name",
                  fragmentPropName: "name",
                },
              ],
              type: "PlainUserNameRenderer",
            },
            InlineFragment {
              selections: [
                ModuleImport {
                  documentName: "ActorsRendererFragment",
                  fragmentName: "MarkdownUserNameRenderer_name",
                  fragmentPropName: "name",
                },
              ],
              type: "MarkdownUserNameRenderer",
            },
          ],
          storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
        },
      ],
      storageKey: null,
    },
  ],
  type: "Node",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: match-with-invalid-key.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query MatchWithVariableName {
  me {
    nameRenderer @match(key: "error-not-prefixed-with-document-name") {
      ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Expected the 'key' argument of @match to be a literal string starting with the document name, e.g. 'MatchWithVariableName_<localName>'.

Source: GraphQL request (4:25)
3:   me {
4:     nameRenderer @match(key: "error-not-prefixed-with-document-name") {
                           ^
5:       ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")

`;

exports[`compileRelayArtifacts matches expected output: match-with-variable-key.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query MatchWithVariableName($key: String) {
  me {
    nameRenderer @match(key: $key) {
      ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Variable '$key' is never used in operation 'MatchWithVariableName'.

Source: GraphQL request (2:29)
1: # expected-to-throw
2: query MatchWithVariableName($key: String) {
                               ^
3:   me {

`;

exports[`compileRelayArtifacts matches expected output: missing-argument-on-field.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query TestQuery {
  node {
    hometown {
      nameWithArgs
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Required argument 'capitalize: Boolean!' is missing on 'nameWithArgs' in 'TestQuery'.

Source: GraphQL request (5:7)
4:     hometown {
5:       nameWithArgs
         ^
6:     }

Source: GraphQL request (2:1)
1: # expected-to-throw
2: query TestQuery {
   ^
3:   node {

`;

exports[`compileRelayArtifacts matches expected output: module-overlap-across-documents.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query FooNameRendererQuery($id: ID!) {
  node(id: $id) {
    ...FooNameRendererFragment
  }
}

fragment FooNameRendererFragment on User {
  id
  nameRenderer {
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
    ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
  }
}

query BarNameRendererQuery($id: ID!) {
  node(id: $id) {
    ...BarNameRendererFragment
  }
}

fragment BarNameRendererFragment on User {
  # same field alias as above and using standalone @module, so this should
  # flatten with the above selections even though the supported types are
  # different
  nameRenderer {
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "FooNameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "FooNameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "FooNameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "FooNameRendererFragment",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "FooNameRendererFragment",
                        fragmentName: "PlainUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "PlainUserNameRenderer",
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query FooNameRendererQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...FooNameRendererFragment
    id
  }
}

fragment FooNameRendererFragment on User {
  id
  nameRenderer {
    __typename
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_FooNameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "FooNameRendererFragment.nameRenderer")
      __module_component_FooNameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "FooNameRendererFragment.nameRenderer")
    }
    ... on PlainUserNameRenderer {
      ...PlainUserNameRenderer_name
      __module_operation_FooNameRendererFragment: js(module: "PlainUserNameRenderer_name$normalization.graphql", id: "FooNameRendererFragment.nameRenderer")
      __module_component_FooNameRendererFragment: js(module: "PlainUserNameRenderer.react", id: "FooNameRendererFragment.nameRenderer")
    }
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
    id
  }
}


Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "BarNameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "BarNameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "BarNameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "BarNameRendererFragment",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query BarNameRendererQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...BarNameRendererFragment
    id
  }
}

fragment BarNameRendererFragment on User {
  nameRenderer {
    __typename
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_BarNameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "BarNameRendererFragment.nameRenderer")
      __module_component_BarNameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "BarNameRendererFragment.nameRenderer")
    }
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "FooNameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "FooNameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "FooNameRendererFragment",
              fragmentName: "PlainUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "PlainUserNameRenderer",
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "BarNameRendererFragment",
  selections: [
    LinkedField {
      alias: null,
      args: null,
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "BarNameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: module-overlap-within-document.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query MultipleNameRendererQuery($id: ID!) {
  node(id: $id) {
    ...FooNameRendererFragment
    ...BarNameRendererFragment
  }
}

fragment FooNameRendererFragment on User {
  id
  nameRenderer {
    ...MarkdownUserNameRenderer_name
      @module(name: "FooMarkdownUserNameRenderer.react")
    ...PlainUserNameRenderer_name
      @module(name: "FooPlainUserNameRenderer.react")
  }
}

fragment BarNameRendererFragment on User {
  # conflicts with above: same alias but different selections
  nameRenderer {
    ...MarkdownUserNameRenderer_name
      @module(name: "BarMarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Found conflicting @module selections: use a unique alias on the parent fields.

Source: GraphQL request (23:7)
22:     ...MarkdownUserNameRenderer_name
23:       @module(name: "BarMarkdownUserNameRenderer.react")
          ^
24:   }

Source: GraphQL request (13:7)
12:     ...MarkdownUserNameRenderer_name
13:       @module(name: "FooMarkdownUserNameRenderer.react")
          ^
14:     ...PlainUserNameRenderer_name

`;

exports[`compileRelayArtifacts matches expected output: multiple-modules-different-component.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query MatchQuery {
  node(id: "<user-id>") {
    ... on Actor {
      nameRenderer {
        ...MarkdownUserNameRenderer_name
          @module(name: "MarkdownUserNameRenderer.react")
      }
    }
    ... on User {
      nameRenderer {
        ...MarkdownUserNameRenderer_name
          @module(name: "OtherMarkdownUserNameRenderer.react")
      }
    }
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Invalid @module selection: concrete type 'MarkdownUserNameRenderer' was matched multiple times at path 'node.nameRenderer' but with a different fragment or module name.

Source: GraphQL request (12:9)
11:       nameRenderer {
12:         ...MarkdownUserNameRenderer_name
            ^
13:           @module(name: "OtherMarkdownUserNameRenderer.react")

Source: GraphQL request (6:9)
5:       nameRenderer {
6:         ...MarkdownUserNameRenderer_name
           ^
7:           @module(name: "MarkdownUserNameRenderer.react")

`;

exports[`compileRelayArtifacts matches expected output: multiple-modules-different-fragment.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query MatchQuery {
  node(id: "<user-id>") {
    ... on Actor {
      nameRenderer {
        ...MarkdownUserNameRenderer_name
          @module(name: "MarkdownUserNameRenderer.react")
      }
    }
    ... on User {
      nameRenderer {
        ...OtherMarkdownUserNameRenderer_name
          @module(name: "MarkdownUserNameRenderer.react")
      }
    }
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

fragment OtherMarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Invalid @module selection: concrete type 'MarkdownUserNameRenderer' was matched multiple times at path 'node.nameRenderer' but with a different fragment or module name.

Source: GraphQL request (12:9)
11:       nameRenderer {
12:         ...OtherMarkdownUserNameRenderer_name
            ^
13:           @module(name: "MarkdownUserNameRenderer.react")

Source: GraphQL request (6:9)
5:       nameRenderer {
6:         ...MarkdownUserNameRenderer_name
           ^
7:           @module(name: "MarkdownUserNameRenderer.react")

`;

exports[`compileRelayArtifacts matches expected output: multiple-modules-same-selections.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query MatchQuery {
  node(id: "<user-id>") {
    ... on Actor {
      nameRenderer {
        ...MarkdownUserNameRenderer_name
          @module(name: "MarkdownUserNameRenderer.react")
      }
    }
    ... on User {
      nameRenderer {
        ...MarkdownUserNameRenderer_name
          @module(name: "MarkdownUserNameRenderer.react")
      }
    }
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "MatchQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Literal {
            name: "id",
            value: "<user-id>",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "nameRenderer",
            plural: false,
            selections: [
              InlineFragment {
                selections: [
                  ModuleImport {
                    documentName: "MatchQuery",
                    fragmentName: "MarkdownUserNameRenderer_name",
                    fragmentPropName: "name",
                  },
                ],
                type: "MarkdownUserNameRenderer",
              },
            ],
            storageKey: null,
          },
        ],
        storageKey: "node(id:\\"<user-id>\\")",
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "MatchQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Literal {
            name: "id",
            value: "<user-id>",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "nameRenderer",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              InlineFragment {
                selections: [
                  ModuleImport {
                    documentName: "MatchQuery",
                    fragmentName: "MarkdownUserNameRenderer_name",
                    fragmentPropName: "name",
                  },
                ],
                type: "MarkdownUserNameRenderer",
              },
            ],
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: "node(id:\\"<user-id>\\")",
      },
    ],
  },
}

QUERY:

query MatchQuery {
  node(id: "<user-id>") {
    __typename
    ... on Actor {
      nameRenderer {
        __typename
        ... on MarkdownUserNameRenderer {
          ...MarkdownUserNameRenderer_name
          __module_operation_MatchQuery: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "MatchQuery.node.nameRenderer")
          __module_component_MatchQuery: js(module: "MarkdownUserNameRenderer.react", id: "MatchQuery.node.nameRenderer")
        }
      }
    }
    ... on User {
      nameRenderer {
        __typename
        ... on MarkdownUserNameRenderer {
          ...MarkdownUserNameRenderer_name
          __module_operation_MatchQuery: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "MatchQuery.node.nameRenderer")
          __module_component_MatchQuery: js(module: "MarkdownUserNameRenderer.react", id: "MatchQuery.node.nameRenderer")
        }
      }
    }
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: multiple-modules-with-key.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query MatchQuery {
  node(id: "<user-id>") {
    ... on Actor {
      nameRenderer @match(key: "MatchQuery_nameRenderer") {
        ...PlainUserNameRenderer_name
          @module(name: "PlainUserNameRenderer.react")
      }
    }
    ... on User {
      nameRenderable {
        ...MarkdownUserNameRenderer_name
          @module(name: "MarkdownUserNameRenderer.react")
      }
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "MatchQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Literal {
            name: "id",
            value: "<user-id>",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: [
              Literal {
                name: "supported",
                value: [
                  "PlainUserNameRenderer",
                ],
              },
            ],
            concreteType: null,
            name: "nameRenderer",
            plural: false,
            selections: [
              InlineFragment {
                selections: [
                  ModuleImport {
                    documentName: "MatchQuery_nameRenderer",
                    fragmentName: "PlainUserNameRenderer_name",
                    fragmentPropName: "name",
                  },
                ],
                type: "PlainUserNameRenderer",
              },
            ],
            storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\"])",
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderable",
                plural: false,
                selections: [
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "MatchQuery",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: "node(id:\\"<user-id>\\")",
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "MatchQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Literal {
            name: "id",
            value: "<user-id>",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          LinkedField {
            alias: null,
            args: [
              Literal {
                name: "supported",
                value: [
                  "PlainUserNameRenderer",
                ],
              },
            ],
            concreteType: null,
            name: "nameRenderer",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              InlineFragment {
                selections: [
                  ModuleImport {
                    documentName: "MatchQuery_nameRenderer",
                    fragmentName: "PlainUserNameRenderer_name",
                    fragmentPropName: "name",
                  },
                ],
                type: "PlainUserNameRenderer",
              },
            ],
            storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\"])",
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderable",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "MatchQuery",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: "node(id:\\"<user-id>\\")",
      },
    ],
  },
}

QUERY:

query MatchQuery {
  node(id: "<user-id>") {
    __typename
    ... on Actor {
      nameRenderer(supported: ["PlainUserNameRenderer"]) {
        __typename
        ... on PlainUserNameRenderer {
          ...PlainUserNameRenderer_name
          __module_operation_MatchQuery_nameRenderer: js(module: "PlainUserNameRenderer_name$normalization.graphql", id: "MatchQuery.node.nameRenderer")
          __module_component_MatchQuery_nameRenderer: js(module: "PlainUserNameRenderer.react", id: "MatchQuery.node.nameRenderer")
        }
      }
    }
    ... on User {
      nameRenderable {
        __typename
        ... on MarkdownUserNameRenderer {
          ...MarkdownUserNameRenderer_name
          __module_operation_MatchQuery: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "MatchQuery.node.nameRenderable")
          __module_component_MatchQuery: js(module: "MarkdownUserNameRenderer.react", id: "MatchQuery.node.nameRenderable")
        }
      }
    }
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
    id
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: multiple-modules-without-key.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query MatchQuery {
  node(id: "<user-id>") {
    ... on Actor {
      nameRenderer {
        ...PlainUserNameRenderer_name
          @module(name: "PlainUserNameRenderer.react")
      }
    }
    ... on User {
      nameRenderable {
        ...MarkdownUserNameRenderer_name
          @module(name: "MarkdownUserNameRenderer.react")
      }
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Invalid @module selection: documents with multiple fields containing 3D selections must specify a unique 'key' value for each field: use 'nameRenderable @match(key: "MatchQuery_<localName>")'.

Source: GraphQL request (11:7)
10:     ... on User {
11:       nameRenderable {
          ^
12:         ...MarkdownUserNameRenderer_name

`;

exports[`compileRelayArtifacts matches expected output: nested_conditions.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment QueryFragment on Query {
  viewer {
    ... @include(if: $sentinel) {
      account_user {
        name
        ... @skip(if: $bar) @include(if: $foo) {
          alternate_name
          canViewerComment
        }
      }
      ... @skip(if: $foo) {
        actor {
          name
        }
      }
    }
  }
}

fragment QueryFragment2 on Query {
  viewer {
    ... @include(if: $sentinel) @skip(if: $foo) {
      account_user @include(if: $bar) {
        name
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "sentinel",
      type: "Boolean!",
    },
    RootArgument {
      name: "bar",
      type: "Boolean!",
    },
    RootArgument {
      name: "foo",
      type: "Boolean!",
    },
  ],
  metadata: null,
  name: "QueryFragment",
  selections: [
    LinkedField {
      alias: null,
      args: null,
      concreteType: "Viewer",
      name: "viewer",
      plural: false,
      selections: [
        Condition {
          condition: "sentinel",
          passingValue: true,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "User",
              name: "account_user",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "name",
                  storageKey: null,
                },
                Condition {
                  condition: "foo",
                  passingValue: true,
                  selections: [
                    Condition {
                      condition: "bar",
                      passingValue: false,
                      selections: [
                        ScalarField {
                          alias: null,
                          args: null,
                          name: "alternate_name",
                          storageKey: null,
                        },
                        ScalarField {
                          alias: null,
                          args: null,
                          name: "canViewerComment",
                          storageKey: null,
                        },
                      ],
                    },
                  ],
                },
              ],
              storageKey: null,
            },
            Condition {
              condition: "foo",
              passingValue: false,
              selections: [
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: null,
                  name: "actor",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "name",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
              ],
            },
          ],
        },
      ],
      storageKey: null,
    },
  ],
  type: "Query",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "sentinel",
      type: "Boolean!",
    },
    RootArgument {
      name: "foo",
      type: "Boolean!",
    },
    RootArgument {
      name: "bar",
      type: "Boolean!",
    },
  ],
  metadata: null,
  name: "QueryFragment2",
  selections: [
    LinkedField {
      alias: null,
      args: null,
      concreteType: "Viewer",
      name: "viewer",
      plural: false,
      selections: [
        Condition {
          condition: "sentinel",
          passingValue: true,
          selections: [
            Condition {
              condition: "foo",
              passingValue: false,
              selections: [
                Condition {
                  condition: "bar",
                  passingValue: true,
                  selections: [
                    LinkedField {
                      alias: null,
                      args: null,
                      concreteType: "User",
                      name: "account_user",
                      plural: false,
                      selections: [
                        ScalarField {
                          alias: null,
                          args: null,
                          name: "name",
                          storageKey: null,
                        },
                      ],
                      storageKey: null,
                    },
                  ],
                },
              ],
            },
          ],
        },
      ],
      storageKey: null,
    },
  ],
  type: "Query",
}
`;

exports[`compileRelayArtifacts matches expected output: original-client-fields-test.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query BestFriendsQuery($id: ID!) {
  node(id: $id) {
    ...BestFriends
    ...OnlyClientFields
  }
}

# This fragment disappears because all selections are removed
fragment OnlyClientFields on User {
  best_friends {
    __typename
  }
}

fragment BestFriends on User {
  # this is the only field that is part of the base schema
  ...NodeFragment
  # fields defined in type extensions are skipped
  best_friends {
    edges {
      cursor
      node {
        id
      }
    }
    pageInfo {
      hasNextPage
    }
  }
  ... on Named {
    # fragments on extension types are skipped
    ...FooFragment
    ... on Foo {
      name
    }
  }
}

fragment NodeFragment on Node {
  id
}

fragment FooFragment on Foo {
  name
}

extend type User {
  best_friends: FriendsConnection
}

type Foo implements Named {
  name: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "BestFriendsQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "BestFriends",
          },
          FragmentSpread {
            args: null,
            name: "OnlyClientFields",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "BestFriendsQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ClientExtension {
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "FriendsConnection",
                    name: "best_friends",
                    plural: false,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "FriendsEdge",
                        name: "edges",
                        plural: true,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "cursor",
                            storageKey: null,
                          },
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: "User",
                            name: "node",
                            plural: false,
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "id",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "PageInfo",
                        name: "pageInfo",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "hasNextPage",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "__typename",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "name",
                        storageKey: null,
                      },
                    ],
                    type: "Foo",
                  },
                ],
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query BestFriendsQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...BestFriends
    id
  }
}

fragment BestFriends on User {
  ...NodeFragment
}

fragment NodeFragment on Node {
  id
}


Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "OnlyClientFields",
  selections: [
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "FriendsConnection",
          name: "best_friends",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "__typename",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "BestFriends",
  selections: [
    FragmentSpread {
      args: null,
      name: "NodeFragment",
    },
    FragmentSpread {
      args: null,
      name: "FooFragment",
    },
    ClientExtension {
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "FriendsConnection",
          name: "best_friends",
          plural: false,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "FriendsEdge",
              name: "edges",
              plural: true,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "cursor",
                  storageKey: null,
                },
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "User",
                  name: "node",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "id",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
            LinkedField {
              alias: null,
              args: null,
              concreteType: "PageInfo",
              name: "pageInfo",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "hasNextPage",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
        InlineFragment {
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "name",
              storageKey: null,
            },
          ],
          type: "Foo",
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NodeFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
  ],
  type: "Node",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "FooFragment",
  selections: [
    ClientExtension {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
      ],
    },
  ],
  type: "Foo",
}
`;

exports[`compileRelayArtifacts matches expected output: plural-fragment.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment PluralFragment on User @relay(plural: true) {
  name
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [],
  metadata: {
    "plural": true,
  },
  name: "PluralFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "name",
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-conditional-module.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NameRendererQuery($id: ID!, $fetchModule: Boolean!) {
  node(id: $id) {
    ...NameRendererFragment
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer {
    # note: intentionally no @match here
    ...MarkdownUserNameRenderer_name
      @include(if: $fetchModule)
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "fetchModule",
        type: "Boolean!",
      },
    ],
    metadata: null,
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "NameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "fetchModule",
        type: "Boolean!",
      },
    ],
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  Condition {
                    condition: "fetchModule",
                    passingValue: true,
                    selections: [
                      InlineFragment {
                        selections: [
                          ModuleImport {
                            documentName: "NameRendererFragment",
                            fragmentName: "MarkdownUserNameRenderer_name",
                            fragmentPropName: "name",
                          },
                        ],
                        type: "MarkdownUserNameRenderer",
                      },
                    ],
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NameRendererQuery(
  $id: ID!
  $fetchModule: Boolean!
) {
  node(id: $id) {
    __typename
    ...NameRendererFragment
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer {
    __typename
    ... on MarkdownUserNameRenderer @include(if: $fetchModule) {
      ...MarkdownUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "fetchModule",
      type: "Boolean!",
    },
  ],
  metadata: null,
  name: "NameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        Condition {
          condition: "fetchModule",
          passingValue: true,
          selections: [
            InlineFragment {
              selections: [
                ModuleImport {
                  documentName: "NameRendererFragment",
                  fragmentName: "MarkdownUserNameRenderer_name",
                  fragmentPropName: "name",
                },
              ],
              type: "MarkdownUserNameRenderer",
            },
          ],
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-fragment-variables.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query TestQuery($id: ID!, $cond: Boolean!, $pictureSize: [Int] = [128]) {
  node(id: $id) {
    id
    ...Profile @arguments(pictureSize: $pictureSize)
    ...ProfileFriends @include(if: $cond)
  }
}

fragment ProfileFriends on User {
  friends(first: 10) {
    edges {
      node {
        ...Profile @arguments(pictureSize: $pictureSize)
      }
    }
  }
}

fragment Profile on User @argumentDefinitions(pictureSize: {type: "[Int]"}) {
  profilePicture(size: $pictureSize) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "cond",
        type: "Boolean!",
      },
      LocalArgument {
        defaultValue: [
          128,
        ],
        name: "pictureSize",
        type: "[Int]",
      },
    ],
    metadata: null,
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          FragmentSpread {
            args: [
              Variable {
                name: "pictureSize",
                variableName: "pictureSize",
              },
            ],
            name: "Profile",
          },
          Condition {
            condition: "cond",
            passingValue: true,
            selections: [
              FragmentSpread {
                args: null,
                name: "ProfileFriends",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "cond",
        type: "Boolean!",
      },
      LocalArgument {
        defaultValue: [
          128,
        ],
        name: "pictureSize",
        type: "[Int]",
      },
    ],
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "size",
                    variableName: "pictureSize",
                  },
                ],
                concreteType: "Image",
                name: "profilePicture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
          Condition {
            condition: "cond",
            passingValue: true,
            selections: [
              InlineFragment {
                selections: [
                  LinkedField {
                    alias: null,
                    args: [
                      Literal {
                        name: "first",
                        value: 10,
                      },
                    ],
                    concreteType: "FriendsConnection",
                    name: "friends",
                    plural: false,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "FriendsEdge",
                        name: "edges",
                        plural: true,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: "User",
                            name: "node",
                            plural: false,
                            selections: [
                              LinkedField {
                                alias: null,
                                args: [
                                  Variable {
                                    name: "size",
                                    variableName: "pictureSize",
                                  },
                                ],
                                concreteType: "Image",
                                name: "profilePicture",
                                plural: false,
                                selections: [
                                  ScalarField {
                                    alias: null,
                                    args: null,
                                    name: "uri",
                                    storageKey: null,
                                  },
                                ],
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "id",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: "friends(first:10)",
                  },
                ],
                type: "User",
              },
            ],
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query TestQuery(
  $id: ID!
  $cond: Boolean!
  $pictureSize: [Int] = [128]
) {
  node(id: $id) {
    __typename
    id
    ...Profile_4CNNX6
    ...ProfileFriends @include(if: $cond)
  }
}

fragment ProfileFriends on User {
  friends(first: 10) {
    edges {
      node {
        ...Profile_4CNNX6
        id
      }
    }
  }
}

fragment Profile_4CNNX6 on User {
  profilePicture(size: $pictureSize) {
    uri
  }
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "pictureSize",
      type: null,
    },
  ],
  metadata: null,
  name: "ProfileFriends",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "first",
          value: 10,
        },
      ],
      concreteType: "FriendsConnection",
      name: "friends",
      plural: false,
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "FriendsEdge",
          name: "edges",
          plural: true,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "User",
              name: "node",
              plural: false,
              selections: [
                FragmentSpread {
                  args: [
                    Variable {
                      name: "pictureSize",
                      variableName: "pictureSize",
                    },
                  ],
                  name: "Profile",
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
      storageKey: "friends(first:10)",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: null,
      name: "pictureSize",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "Profile",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "pictureSize",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-match-directive.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NameRendererQuery($id: ID!) {
  node(id: $id) {
    ...NameRendererFragment
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer @match {
    ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "NameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "supported",
                    value: [
                      "PlainUserNameRenderer",
                      "MarkdownUserNameRenderer",
                    ],
                  },
                ],
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "PlainUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "PlainUserNameRenderer",
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NameRendererQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...NameRendererFragment
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer(supported: ["PlainUserNameRenderer", "MarkdownUserNameRenderer"]) {
    __typename
    ... on PlainUserNameRenderer {
      ...PlainUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "PlainUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "PlainUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
    id
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "supported",
          value: [
            "PlainUserNameRenderer",
            "MarkdownUserNameRenderer",
          ],
        },
      ],
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "PlainUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "PlainUserNameRenderer",
        },
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
      ],
      storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-match-directive-no-inline-experimental.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NameRendererQuery($id: ID!) {
  node(id: $id) {
    ...NameRendererFragment
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer @match {
    ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "NameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "supported",
                    value: [
                      "PlainUserNameRenderer",
                      "MarkdownUserNameRenderer",
                    ],
                  },
                ],
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "PlainUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "PlainUserNameRenderer",
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NameRendererQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...NameRendererFragment
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer(supported: ["PlainUserNameRenderer", "MarkdownUserNameRenderer"]) {
    __typename
    ... on PlainUserNameRenderer {
      ...PlainUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "PlainUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "PlainUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
    id
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "supported",
          value: [
            "PlainUserNameRenderer",
            "MarkdownUserNameRenderer",
          ],
        },
      ],
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "PlainUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "PlainUserNameRenderer",
        },
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
      ],
      storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-match-directive-no-modules.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query NameRendererQuery($id: ID!) {
  node(id: $id) {
    ...NameRendererFragment
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer @match {
    __typename
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Invalid @match selection: expected at least one @module selection. Remove @match or add a '...Fragment @module()' selection.

Source: GraphQL request (10:16)
 9:   id
10:   nameRenderer @match {
                   ^
11:     __typename

`;

exports[`compileRelayArtifacts matches expected output: query-with-match-directive-with-extra-argument.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NameRendererQuery($id: ID!) {
  node(id: $id) {
    ...NameRendererFragment
  }
}

fragment NameRendererFragment on User {
  id
  nameRendererForContext(context: HEADER) @match {
    ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "NameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "context",
                    value: "HEADER",
                  },
                  Literal {
                    name: "supported",
                    value: [
                      "PlainUserNameRenderer",
                      "MarkdownUserNameRenderer",
                    ],
                  },
                ],
                concreteType: null,
                name: "nameRendererForContext",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "PlainUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "PlainUserNameRenderer",
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: "nameRendererForContext(context:\\"HEADER\\",supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NameRendererQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...NameRendererFragment
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment NameRendererFragment on User {
  id
  nameRendererForContext(context: HEADER, supported: ["PlainUserNameRenderer", "MarkdownUserNameRenderer"]) {
    __typename
    ... on PlainUserNameRenderer {
      ...PlainUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "PlainUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRendererForContext")
      __module_component_NameRendererFragment: js(module: "PlainUserNameRenderer.react", id: "NameRendererFragment.nameRendererForContext")
    }
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRendererForContext")
      __module_component_NameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "NameRendererFragment.nameRendererForContext")
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
    id
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "context",
          value: "HEADER",
        },
        Literal {
          name: "supported",
          value: [
            "PlainUserNameRenderer",
            "MarkdownUserNameRenderer",
          ],
        },
      ],
      concreteType: null,
      name: "nameRendererForContext",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "PlainUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "PlainUserNameRenderer",
        },
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
      ],
      storageKey: "nameRendererForContext(context:\\"HEADER\\",supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-match-directive-with-typename.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NameRendererQuery($id: ID!) {
  node(id: $id) {
    ...NameRendererFragment
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer @match {
    __typename
    ...PlainUserNameRenderer_name @module(name: "PlainUserNameRenderer.react")
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "NameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "supported",
                    value: [
                      "PlainUserNameRenderer",
                      "MarkdownUserNameRenderer",
                    ],
                  },
                ],
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "PlainUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "PlainUserNameRenderer",
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NameRendererQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...NameRendererFragment
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer(supported: ["PlainUserNameRenderer", "MarkdownUserNameRenderer"]) {
    __typename
    ... on PlainUserNameRenderer {
      ...PlainUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "PlainUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "PlainUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
  }
}

fragment PlainUserNameRenderer_name on PlainUserNameRenderer {
  plaintext
  data {
    text
    id
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "PlainUserNameRenderer_name",
  },
  name: "PlainUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "supported",
          value: [
            "PlainUserNameRenderer",
            "MarkdownUserNameRenderer",
          ],
        },
      ],
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "__typename",
          storageKey: null,
        },
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "PlainUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "PlainUserNameRenderer",
        },
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
      ],
      storageKey: "nameRenderer(supported:[\\"PlainUserNameRenderer\\",\\"MarkdownUserNameRenderer\\"])",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "PlainUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "plaintext",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "PlainUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "text",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "PlainUserNameRenderer",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-module-directive.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NameRendererQuery($id: ID!) {
  node(id: $id) {
    ...NameRendererFragment
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer {
    # note: intentionally no @match here
    ...MarkdownUserNameRenderer_name
      @module(name: "MarkdownUserNameRenderer.react")
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "NameRendererFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NameRendererQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: null,
                name: "nameRenderer",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      ModuleImport {
                        documentName: "NameRendererFragment",
                        fragmentName: "MarkdownUserNameRenderer_name",
                        fragmentPropName: "name",
                      },
                    ],
                    type: "MarkdownUserNameRenderer",
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NameRendererQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...NameRendererFragment
    id
  }
}

fragment MarkdownUserNameRenderer_name on MarkdownUserNameRenderer {
  markdown
  data {
    markup
    id
  }
}

fragment NameRendererFragment on User {
  id
  nameRenderer {
    __typename
    ... on MarkdownUserNameRenderer {
      ...MarkdownUserNameRenderer_name
      __module_operation_NameRendererFragment: js(module: "MarkdownUserNameRenderer_name$normalization.graphql", id: "NameRendererFragment.nameRenderer")
      __module_component_NameRendererFragment: js(module: "MarkdownUserNameRenderer.react", id: "NameRendererFragment.nameRenderer")
    }
  }
}


SplitOperation {
  metadata: {
    "derivedFrom": "MarkdownUserNameRenderer_name",
  },
  name: "MarkdownUserNameRenderer_name$normalization",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "id",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "NameRendererFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: null,
      name: "nameRenderer",
      plural: false,
      selections: [
        InlineFragment {
          selections: [
            ModuleImport {
              documentName: "NameRendererFragment",
              fragmentName: "MarkdownUserNameRenderer_name",
              fragmentPropName: "name",
            },
          ],
          type: "MarkdownUserNameRenderer",
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "MarkdownUserNameRenderer_name",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "markdown",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: null,
      concreteType: "MarkdownUserNameData",
      name: "data",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "markup",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "MarkdownUserNameRenderer",
}
`;

exports[`compileRelayArtifacts matches expected output: query-with-raw-response-type-directive.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query ViewerQuery @raw_response_type {
  viewer {
    actor {
      id
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "ViewerQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "ViewerQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query ViewerQuery {
  viewer {
    actor {
      __typename
      id
    }
  }
}

`;

exports[`compileRelayArtifacts matches expected output: refetchable-connection.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableConnection_feedback on Feedback
  @refetchable(queryName: "RefetchableConnectionQuery") {
  id
  comments(first: $count, after: $cursor)
    @connection(key: "RefetchableConnection_comments") {
    edges {
      cursor
      node {
        id
      }
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableConnectionQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "RefetchableConnection_feedback",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableConnectionQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                concreteType: "CommentsConnection",
                name: "comments",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
              LinkedHandle {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                filters: null,
                handle: "connection",
                key: "RefetchableConnection_comments",
                name: "comments",
              },
            ],
            type: "Feedback",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableConnectionQuery(
  $count: Int
  $cursor: ID
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...RefetchableConnection_feedback
    id
  }
}

fragment RefetchableConnection_feedback on Feedback {
  id
  comments(first: $count, after: $cursor) {
    edges {
      cursor
      node {
        id
        __typename
      }
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "count",
      type: "Int",
    },
    RootArgument {
      name: "cursor",
      type: "ID",
    },
  ],
  metadata: {
    "connection": [
      {
        "count": "count",
        "cursor": "cursor",
        "direction": "forward",
        "path": [
          "comments",
        ],
      },
    ],
    "refetch": {
      "connection": {
        "forward": {
          "count": "count",
          "cursor": "cursor",
        },
        "backward": null,
        "path": [
          "comments",
        ],
      },
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableConnectionQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "RefetchableConnection_feedback",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: "comments",
      args: null,
      concreteType: "CommentsConnection",
      name: "__RefetchableConnection_comments_connection",
      plural: false,
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "CommentsEdge",
          name: "edges",
          plural: true,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "cursor",
              storageKey: null,
            },
            LinkedField {
              alias: null,
              args: null,
              concreteType: "Comment",
              name: "node",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "id",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "__typename",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "PageInfo",
          name: "pageInfo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "endCursor",
              storageKey: null,
            },
            ScalarField {
              alias: null,
              args: null,
              name: "hasNextPage",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "Feedback",
}
`;

exports[`compileRelayArtifacts matches expected output: refetchable-connection-custom-handler.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableConnection_feedback on Feedback
  @refetchable(queryName: "RefetchableConnectionQuery") {
  id
  comments(first: $count, after: $cursor)
    @connection(key: "RefetchableConnection_comments", handler: "custom") {
    edges {
      cursor
      node {
        id
      }
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableConnectionQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "RefetchableConnection_feedback",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableConnectionQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                concreteType: "CommentsConnection",
                name: "comments",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "CommentsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Comment",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
              LinkedHandle {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                filters: null,
                handle: "custom",
                key: "RefetchableConnection_comments",
                name: "comments",
              },
            ],
            type: "Feedback",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableConnectionQuery(
  $count: Int
  $cursor: ID
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...RefetchableConnection_feedback
    id
  }
}

fragment RefetchableConnection_feedback on Feedback {
  id
  comments(first: $count, after: $cursor) {
    edges {
      cursor
      node {
        id
        __typename
      }
    }
    pageInfo {
      endCursor
      hasNextPage
    }
  }
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "count",
      type: "Int",
    },
    RootArgument {
      name: "cursor",
      type: "ID",
    },
  ],
  metadata: {
    "connection": [
      {
        "count": "count",
        "cursor": "cursor",
        "direction": "forward",
        "path": [
          "comments",
        ],
      },
    ],
    "refetch": {
      "connection": {
        "forward": {
          "count": "count",
          "cursor": "cursor",
        },
        "backward": null,
        "path": [
          "comments",
        ],
      },
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableConnectionQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "RefetchableConnection_feedback",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    LinkedField {
      alias: "comments",
      args: null,
      concreteType: "CommentsConnection",
      name: "__RefetchableConnection_comments_custom",
      plural: false,
      selections: [
        LinkedField {
          alias: null,
          args: null,
          concreteType: "CommentsEdge",
          name: "edges",
          plural: true,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "cursor",
              storageKey: null,
            },
            LinkedField {
              alias: null,
              args: null,
              concreteType: "Comment",
              name: "node",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "id",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "__typename",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "PageInfo",
          name: "pageInfo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "endCursor",
              storageKey: null,
            },
            ScalarField {
              alias: null,
              args: null,
              name: "hasNextPage",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "Feedback",
}
`;

exports[`compileRelayArtifacts matches expected output: refetchable-fragment-on-node-with-missing-id.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment RefetchableFragment on Node
  @refetchable(queryName: "RefetchableFragmentQuery") {
  ... on User {
    name
    ...ProfilePicture
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "RefetchableFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "size",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "size",
                    variableName: "size",
                  },
                ],
                concreteType: "Image",
                name: "profilePicture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $size: [Int]
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...RefetchableFragment
    id
  }
}

fragment ProfilePicture on User {
  profilePicture(size: $size) {
    uri
  }
}

fragment RefetchableFragment on Node {
  ... on User {
    name
    ...ProfilePicture
  }
  id
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: {
    "refetch": {
      "connection": null,
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "RefetchableFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    InlineFragment {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
        FragmentSpread {
          args: null,
          name: "ProfilePicture",
        },
      ],
      type: "User",
    },
  ],
  type: "Node",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: "[Int]",
    },
  ],
  metadata: null,
  name: "ProfilePicture",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: refetchable-fragment-with-connection.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment PaginationFragment on Node
  @refetchable(queryName: "RefetchableFragmentQuery")
  @argumentDefinitions(
    count: {type: "Int", defaultValue: 10}
    cursor: {type: "ID"}
  ) {
  id
  ... on User {
    name
    friends(after: $cursor, first: $count)
      @connection(key: "PaginationFragment_friends") {
      edges {
        node {
          id
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: 10,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: [
              Variable {
                name: "count",
                variableName: "count",
              },
              Variable {
                name: "cursor",
                variableName: "cursor",
              },
            ],
            name: "PaginationFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: 10,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                concreteType: "FriendsConnection",
                name: "friends",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "FriendsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "User",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
              LinkedHandle {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                filters: null,
                handle: "connection",
                key: "PaginationFragment_friends",
                name: "friends",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $count: Int = 10
  $cursor: ID
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...PaginationFragment_1G22uz
    id
  }
}

fragment PaginationFragment_1G22uz on Node {
  id
  ... on User {
    name
    friends(after: $cursor, first: $count) {
      edges {
        node {
          id
          __typename
        }
        cursor
      }
      pageInfo {
        endCursor
        hasNextPage
      }
    }
  }
}


Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: 10,
      name: "count",
      type: "Int",
    },
    LocalArgument {
      defaultValue: null,
      name: "cursor",
      type: "ID",
    },
  ],
  metadata: {
    "connection": [
      {
        "count": "count",
        "cursor": "cursor",
        "direction": "forward",
        "path": [
          "friends",
        ],
      },
    ],
    "refetch": {
      "connection": {
        "forward": {
          "count": "count",
          "cursor": "cursor",
        },
        "backward": null,
        "path": [
          "friends",
        ],
      },
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "PaginationFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    InlineFragment {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
        LinkedField {
          alias: "friends",
          args: null,
          concreteType: "FriendsConnection",
          name: "__PaginationFragment_friends_connection",
          plural: false,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "FriendsEdge",
              name: "edges",
              plural: true,
              selections: [
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "User",
                  name: "node",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "id",
                      storageKey: null,
                    },
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "__typename",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "cursor",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
            LinkedField {
              alias: null,
              args: null,
              concreteType: "PageInfo",
              name: "pageInfo",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "endCursor",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "hasNextPage",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
      type: "User",
    },
  ],
  type: "Node",
}
`;

exports[`compileRelayArtifacts matches expected output: refetchable-fragment-with-connection-bidirectional.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment PaginationFragment on Node
  @refetchable(queryName: "RefetchableFragmentQuery")
  @argumentDefinitions(
    count: {type: "Int", defaultValue: 10}
    cursor: {type: "ID"}
  ) {
  id
  ... on User {
    name
    friends(
      after: $cursor
      first: $count
      before: $beforeCursor
      last: $lastCount
    ) @connection(key: "PaginationFragment_friends") {
      edges {
        node {
          id
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: 10,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "beforeCursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "lastCount",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: [
              Variable {
                name: "count",
                variableName: "count",
              },
              Variable {
                name: "cursor",
                variableName: "cursor",
              },
            ],
            name: "PaginationFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: 10,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "beforeCursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "lastCount",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "before",
                    variableName: "beforeCursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                  Variable {
                    name: "last",
                    variableName: "lastCount",
                  },
                ],
                concreteType: "FriendsConnection",
                name: "friends",
                plural: false,
                selections: [
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "FriendsEdge",
                    name: "edges",
                    plural: true,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "User",
                        name: "node",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "id",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "cursor",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                  LinkedField {
                    alias: null,
                    args: null,
                    concreteType: "PageInfo",
                    name: "pageInfo",
                    plural: false,
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "endCursor",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasNextPage",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "hasPreviousPage",
                        storageKey: null,
                      },
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "startCursor",
                        storageKey: null,
                      },
                    ],
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
              LinkedHandle {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "before",
                    variableName: "beforeCursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                  Variable {
                    name: "last",
                    variableName: "lastCount",
                  },
                ],
                filters: null,
                handle: "connection",
                key: "PaginationFragment_friends",
                name: "friends",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $count: Int = 10
  $cursor: ID
  $beforeCursor: ID
  $lastCount: Int
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...PaginationFragment_1G22uz
    id
  }
}

fragment PaginationFragment_1G22uz on Node {
  id
  ... on User {
    name
    friends(after: $cursor, first: $count, before: $beforeCursor, last: $lastCount) {
      edges {
        node {
          id
          __typename
        }
        cursor
      }
      pageInfo {
        endCursor
        hasNextPage
        hasPreviousPage
        startCursor
      }
    }
  }
}


Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: 10,
      name: "count",
      type: "Int",
    },
    LocalArgument {
      defaultValue: null,
      name: "cursor",
      type: "ID",
    },
    RootArgument {
      name: "beforeCursor",
      type: "ID",
    },
    RootArgument {
      name: "lastCount",
      type: "Int",
    },
  ],
  metadata: {
    "connection": [
      {
        "count": null,
        "cursor": null,
        "direction": "bidirectional",
        "path": [
          "friends",
        ],
      },
    ],
    "refetch": {
      "connection": {
        "forward": {
          "count": "count",
          "cursor": "cursor",
        },
        "backward": {
          "count": "lastCount",
          "cursor": "beforeCursor",
        },
        "path": [
          "friends",
        ],
      },
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "PaginationFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    InlineFragment {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
        LinkedField {
          alias: "friends",
          args: null,
          concreteType: "FriendsConnection",
          name: "__PaginationFragment_friends_connection",
          plural: false,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "FriendsEdge",
              name: "edges",
              plural: true,
              selections: [
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "User",
                  name: "node",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "id",
                      storageKey: null,
                    },
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "__typename",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "cursor",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
            LinkedField {
              alias: null,
              args: null,
              concreteType: "PageInfo",
              name: "pageInfo",
              plural: false,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "endCursor",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "hasNextPage",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "hasPreviousPage",
                  storageKey: null,
                },
                ScalarField {
                  alias: null,
                  args: null,
                  name: "startCursor",
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
      type: "User",
    },
  ],
  type: "Node",
}
`;

exports[`compileRelayArtifacts matches expected output: refetchable-fragment-with-connection-with-stream.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment PaginationFragment on Node
  @refetchable(queryName: "RefetchableFragmentQuery")
  @argumentDefinitions(
    count: {type: "Int", defaultValue: 10}
    cursor: {type: "ID"}
  ) {
  id
  ... on User {
    name
    friends(after: $cursor, first: $count)
      @stream_connection(key: "PaginationFragment_friends", initial_count: 1) {
      edges {
        node {
          id
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: 10,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: [
              Variable {
                name: "count",
                variableName: "count",
              },
              Variable {
                name: "cursor",
                variableName: "cursor",
              },
            ],
            name: "PaginationFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: 10,
        name: "count",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "cursor",
        type: "ID",
      },
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RefetchableFragmentQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                concreteType: "FriendsConnection",
                name: "friends",
                plural: false,
                selections: [
                  Stream {
                    if: null,
                    label: "PaginationFragment$stream$PaginationFragment_friends",
                    metadata: null,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "FriendsEdge",
                        name: "edges",
                        plural: true,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: "User",
                            name: "node",
                            plural: false,
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "id",
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "__typename",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "cursor",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    useCustomizedBatch: null,
                  },
                  Defer {
                    if: null,
                    label: "PaginationFragment$defer$PaginationFragment_friends$pageInfo",
                    metadata: {
                      "fragmentTypeCondition": "FriendsConnection",
                    },
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "PageInfo",
                        name: "pageInfo",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "endCursor",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "hasNextPage",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                  },
                ],
                storageKey: null,
              },
              LinkedHandle {
                alias: null,
                args: [
                  Variable {
                    name: "after",
                    variableName: "cursor",
                  },
                  Variable {
                    name: "first",
                    variableName: "count",
                  },
                ],
                filters: null,
                handle: "connection",
                key: "PaginationFragment_friends",
                name: "friends",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query RefetchableFragmentQuery(
  $count: Int = 10
  $cursor: ID
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...PaginationFragment_1G22uz
    id
  }
}

fragment PaginationFragment_1G22uz on Node {
  id
  ... on User {
    name
    friends(after: $cursor, first: $count) {
      edges @stream(label: "PaginationFragment$stream$PaginationFragment_friends", initial_count: 1) {
        node {
          id
          __typename
        }
        cursor
      }
      ... on FriendsConnection @defer(label: "PaginationFragment$defer$PaginationFragment_friends$pageInfo") {
        pageInfo {
          endCursor
          hasNextPage
        }
      }
    }
  }
}


Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: 10,
      name: "count",
      type: "Int",
    },
    LocalArgument {
      defaultValue: null,
      name: "cursor",
      type: "ID",
    },
  ],
  metadata: {
    "connection": [
      {
        "count": "count",
        "cursor": "cursor",
        "direction": "forward",
        "path": [
          "friends",
        ],
        "stream": true,
      },
    ],
    "refetch": {
      "connection": {
        "forward": {
          "count": "count",
          "cursor": "cursor",
        },
        "backward": null,
        "path": [
          "friends",
        ],
      },
      "fragmentPathInResult": [
        "node",
      ],
      "operation": require('RefetchableFragmentQuery.graphql'),
      "identifierField": "id",
    },
  },
  name: "PaginationFragment",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    InlineFragment {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "name",
          storageKey: null,
        },
        LinkedField {
          alias: "friends",
          args: null,
          concreteType: "FriendsConnection",
          name: "__PaginationFragment_friends_connection",
          plural: false,
          selections: [
            Stream {
              selections: [
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "FriendsEdge",
                  name: "edges",
                  plural: true,
                  selections: [
                    LinkedField {
                      alias: null,
                      args: null,
                      concreteType: "User",
                      name: "node",
                      plural: false,
                      selections: [
                        ScalarField {
                          alias: null,
                          args: null,
                          name: "id",
                          storageKey: null,
                        },
                        ScalarField {
                          alias: null,
                          args: null,
                          name: "__typename",
                          storageKey: null,
                        },
                      ],
                      storageKey: null,
                    },
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "cursor",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
              ],
            },
            Defer {
              selections: [
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "PageInfo",
                  name: "pageInfo",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "endCursor",
                      storageKey: null,
                    },
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "hasNextPage",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
              ],
            },
          ],
          storageKey: null,
        },
      ],
      type: "User",
    },
  ],
  type: "Node",
}
`;

exports[`compileRelayArtifacts matches expected output: relay-client-id-field.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query RelayClientIDFieldQuery($id: ID!) {
  __id # ok on query type
  me {
    __id # ok on object type with 'id'
    __typename
    id
  }
  node(id: $id) {
    __id # ok on interface type
    __typename
    id
    ... on Comment {
      commentBody(supported: ["PlainCommentBody"]) {
        __id # ok on union type
        __typename
        ... on PlainCommentBody {
          __id # ok on object type w/o 'id'
          text {
            __id # ok on object type w/o 'id'
            __typename
            text
          }
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "RelayClientIDFieldQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          ClientExtension {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__id",
                storageKey: null,
              },
            ],
          },
        ],
        storageKey: null,
      },
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "supported",
                    value: [
                      "PlainCommentBody",
                    ],
                  },
                ],
                concreteType: null,
                name: "commentBody",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Text",
                        name: "text",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "text",
                            storageKey: null,
                          },
                          ClientExtension {
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "__id",
                                storageKey: null,
                              },
                            ],
                          },
                        ],
                        storageKey: null,
                      },
                      ClientExtension {
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__id",
                            storageKey: null,
                          },
                        ],
                      },
                    ],
                    type: "PlainCommentBody",
                  },
                  ClientExtension {
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "__id",
                        storageKey: null,
                      },
                    ],
                  },
                ],
                storageKey: "commentBody(supported:[\\"PlainCommentBody\\"])",
              },
            ],
            type: "Comment",
          },
          ClientExtension {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__id",
                storageKey: null,
              },
            ],
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__id",
            storageKey: null,
          },
        ],
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "RelayClientIDFieldQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          ClientExtension {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__id",
                storageKey: null,
              },
            ],
          },
        ],
        storageKey: null,
      },
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "supported",
                    value: [
                      "PlainCommentBody",
                    ],
                  },
                ],
                concreteType: null,
                name: "commentBody",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "__typename",
                    storageKey: null,
                  },
                  InlineFragment {
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "Text",
                        name: "text",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__typename",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "text",
                            storageKey: null,
                          },
                          ClientExtension {
                            selections: [
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "__id",
                                storageKey: null,
                              },
                            ],
                          },
                        ],
                        storageKey: null,
                      },
                      ClientExtension {
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "__id",
                            storageKey: null,
                          },
                        ],
                      },
                    ],
                    type: "PlainCommentBody",
                  },
                  ClientExtension {
                    selections: [
                      ScalarField {
                        alias: null,
                        args: null,
                        name: "__id",
                        storageKey: null,
                      },
                    ],
                  },
                ],
                storageKey: "commentBody(supported:[\\"PlainCommentBody\\"])",
              },
            ],
            type: "Comment",
          },
          ClientExtension {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__id",
                storageKey: null,
              },
            ],
          },
        ],
        storageKey: null,
      },
      ClientExtension {
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__id",
            storageKey: null,
          },
        ],
      },
    ],
  },
}

QUERY:

query RelayClientIDFieldQuery(
  $id: ID!
) {
  me {
    __typename
    id
  }
  node(id: $id) {
    __typename
    id
    ... on Comment {
      commentBody(supported: ["PlainCommentBody"]) {
        __typename
        ... on PlainCommentBody {
          text {
            __typename
            text
          }
        }
      }
    }
  }
}

`;

exports[`compileRelayArtifacts matches expected output: scalar-handle-field.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query ScalarHandleField($id: ID!) {
  node(id: $id) {
    ... on User {
      name @__clientField(handle: "clientName")
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "ScalarHandleField",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          InlineFragment {
            selections: [
              ScalarField {
                alias: "name",
                args: null,
                name: "__name_clientName",
                storageKey: null,
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "ScalarHandleField",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              ScalarHandle {
                alias: null,
                args: null,
                filters: null,
                handle: "clientName",
                key: "",
                name: "name",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query ScalarHandleField(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ... on User {
      name
    }
    id
  }
}

`;

exports[`compileRelayArtifacts matches expected output: sibling-client-selections.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment Foo_user on User {
  id
  name

  # Different types of client selections should be grouped under single
  # ClientExtension node:
  client_nickname
  client_foo {
    client_name
  }
  client_friends {
    edges {
      client_friend_edge_field # nested client field, should not create new ClientExtension node
      node {
        id
      }
    }
  }
  client_foo {
    ... on ClientNamed {
      client_name
    }
  }
  client_foo2 {
    ...ClientTypeFragment # include fragment on client-only type
  }
}

fragment ClientTypeFragment on ClientType {
  client_field
}

extend type User {
  client_friends: FriendsConnection
  client_nickname: String
  client_foo: Foo
  client_foo2: ClientType
}

extend type FriendsEdge {
  client_friend_edge_field: String
}

type ClientType {
  client_field: String
}

type Foo implements ClientNamed {
  client_name: String
}

interface ClientNamed {
  client_name: String
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "Foo_user",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "name",
      storageKey: null,
    },
    ClientExtension {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "client_nickname",
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "Foo",
          name: "client_foo",
          plural: false,
          selections: [
            ScalarField {
              alias: null,
              args: null,
              name: "client_name",
              storageKey: null,
            },
          ],
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "FriendsConnection",
          name: "client_friends",
          plural: false,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "FriendsEdge",
              name: "edges",
              plural: true,
              selections: [
                ScalarField {
                  alias: null,
                  args: null,
                  name: "client_friend_edge_field",
                  storageKey: null,
                },
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "User",
                  name: "node",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "id",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
        LinkedField {
          alias: null,
          args: null,
          concreteType: "ClientType",
          name: "client_foo2",
          plural: false,
          selections: [
            FragmentSpread {
              args: null,
              name: "ClientTypeFragment",
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "ClientTypeFragment",
  selections: [
    ClientExtension {
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "client_field",
          storageKey: null,
        },
      ],
    },
  ],
  type: "ClientType",
}
`;

exports[`compileRelayArtifacts matches expected output: stable-literals.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query StableLiteralsTest {
  me {
    # Note: these object fields are not defined in alphabetical order.
    # The generated artifacts will be produced in alphabetical order.
    storyCommentSearch(query: {text: "foo", limit: 2, offset: 10}) {
      id
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "StableLiteralsTest",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: [
              Literal {
                name: "query",
                value: {
                  "limit": 2,
                  "offset": 10,
                  "text": "foo",
                },
              },
            ],
            concreteType: "Comment",
            name: "storyCommentSearch",
            plural: true,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
            ],
            storageKey: "storyCommentSearch(query:{\\"limit\\":2,\\"offset\\":10,\\"text\\":\\"foo\\"})",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "StableLiteralsTest",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: [
              Literal {
                name: "query",
                value: {
                  "limit": 2,
                  "offset": 10,
                  "text": "foo",
                },
              },
            ],
            concreteType: "Comment",
            name: "storyCommentSearch",
            plural: true,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
            ],
            storageKey: "storyCommentSearch(query:{\\"limit\\":2,\\"offset\\":10,\\"text\\":\\"foo\\"})",
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query StableLiteralsTest {
  me {
    storyCommentSearch(query: {text: "foo", limit: 2, offset: 10}) {
      id
    }
    id
  }
}

`;

exports[`compileRelayArtifacts matches expected output: stream-connection.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query NodeQuery($id: ID!) {
  node(id: $id) {
    id
    ... on Story {
      comments(first: 10)
        @stream_connection(
          key: "NodeQuery_comments"
          initial_count: 0
          label: "comments"
        ) {
        edges {
          node {
            actor {
              name
            }
          }
        }
        pageInfo {
          endCursor
          hasNextPage
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: "comments",
                args: null,
                concreteType: "CommentsConnection",
                name: "__NodeQuery_comments_connection",
                plural: false,
                selections: [
                  Stream {
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "CommentsEdge",
                        name: "edges",
                        plural: true,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: "Comment",
                            name: "node",
                            plural: false,
                            selections: [
                              LinkedField {
                                alias: null,
                                args: null,
                                concreteType: null,
                                name: "actor",
                                plural: false,
                                selections: [
                                  ScalarField {
                                    alias: null,
                                    args: null,
                                    name: "name",
                                    storageKey: null,
                                  },
                                ],
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "__typename",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "cursor",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                  },
                  Defer {
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "PageInfo",
                        name: "pageInfo",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "endCursor",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "hasNextPage",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                  },
                ],
                storageKey: null,
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "NodeQuery",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                concreteType: "CommentsConnection",
                name: "comments",
                plural: false,
                selections: [
                  Stream {
                    if: null,
                    label: "NodeQuery$stream$comments",
                    metadata: null,
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "CommentsEdge",
                        name: "edges",
                        plural: true,
                        selections: [
                          LinkedField {
                            alias: null,
                            args: null,
                            concreteType: "Comment",
                            name: "node",
                            plural: false,
                            selections: [
                              LinkedField {
                                alias: null,
                                args: null,
                                concreteType: null,
                                name: "actor",
                                plural: false,
                                selections: [
                                  ScalarField {
                                    alias: null,
                                    args: null,
                                    name: "__typename",
                                    storageKey: null,
                                  },
                                  ScalarField {
                                    alias: null,
                                    args: null,
                                    name: "name",
                                    storageKey: null,
                                  },
                                  ScalarField {
                                    alias: null,
                                    args: null,
                                    name: "id",
                                    storageKey: null,
                                  },
                                ],
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "id",
                                storageKey: null,
                              },
                              ScalarField {
                                alias: null,
                                args: null,
                                name: "__typename",
                                storageKey: null,
                              },
                            ],
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "cursor",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                    useCustomizedBatch: null,
                  },
                  Defer {
                    if: null,
                    label: "NodeQuery$defer$comments$pageInfo",
                    metadata: {
                      "fragmentTypeCondition": "CommentsConnection",
                    },
                    selections: [
                      LinkedField {
                        alias: null,
                        args: null,
                        concreteType: "PageInfo",
                        name: "pageInfo",
                        plural: false,
                        selections: [
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "endCursor",
                            storageKey: null,
                          },
                          ScalarField {
                            alias: null,
                            args: null,
                            name: "hasNextPage",
                            storageKey: null,
                          },
                        ],
                        storageKey: null,
                      },
                    ],
                  },
                ],
                storageKey: "comments(first:10)",
              },
              LinkedHandle {
                alias: null,
                args: [
                  Literal {
                    name: "first",
                    value: 10,
                  },
                ],
                filters: null,
                handle: "connection",
                key: "NodeQuery_comments",
                name: "comments",
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query NodeQuery(
  $id: ID!
) {
  node(id: $id) {
    __typename
    id
    ... on Story {
      comments(first: 10) {
        edges @stream(label: "NodeQuery$stream$comments", initial_count: 0) {
          node {
            actor {
              __typename
              name
              id
            }
            id
            __typename
          }
          cursor
        }
        ... on CommentsConnection @defer(label: "NodeQuery$defer$comments$pageInfo") {
          pageInfo {
            endCursor
            hasNextPage
          }
        }
      }
    }
  }
}

`;

exports[`compileRelayArtifacts matches expected output: unions.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query UnionQuery {
  maybeNode {
    ... on NonNode {
      name
    }
    ... on Story {
      id
      body {
        text
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "UnionQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "maybeNode",
        plural: false,
        selections: [
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
            ],
            type: "NonNode",
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: null,
                concreteType: "Text",
                name: "body",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "text",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "UnionQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: null,
        name: "maybeNode",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
            ],
            type: "NonNode",
          },
          InlineFragment {
            selections: [
              LinkedField {
                alias: null,
                args: null,
                concreteType: "Text",
                name: "body",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "text",
                    storageKey: null,
                  },
                ],
                storageKey: null,
              },
            ],
            type: "Story",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query UnionQuery {
  maybeNode {
    __typename
    ... on NonNode {
      name
    }
    ... on Story {
      id
      body {
        text
      }
    }
    ... on Node {
      id
    }
    ... on FakeNode {
      id
    }
  }
}

`;

exports[`compileRelayArtifacts matches expected output: unknown-root-variable-in-fragment.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query TestQuery($id: ID!) {
  node(id: $id) {
    id
    ...Profile @relay(mask: false)
  }
}

fragment Profile on User {
  id
  name
  # includeFriends is not defined on the referencing query, should error
  ... @include(if: $includeFriends) {
    friends(first: 10) {
      edges {
        node {
          id
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Error: Variable '$includeFriends' is not in scope.

Source: GraphQL request (2:1)
1: # expected-to-throw
2: query TestQuery($id: ID!) {
   ^
3:   node(id: $id) {

Source: GraphQL request (13:20)
12:   # includeFriends is not defined on the referencing query, should error
13:   ... @include(if: $includeFriends) {
                       ^
14:     friends(first: 10) {

`;

exports[`compileRelayArtifacts matches expected output: unmasked-fragment-spreads-dup-arguments.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
fragment UserUtil_user on User
  # it should not strip exisiting local variable
  @argumentDefinitions(
    localIsRelative: {type: "Boolean", defaultValue: false}
  ) {
  # it should not strip existing global variable
  profilePicture(size: $PictureSize) {
    width
    height
  }
  ...UserUtil2_user @relay(mask: false)

  # it should merge with the same existing global variable
  url(relative: $globalIsRelative)
  anotherUrl: url(relative: $localIsRelative)
}

fragment UserUtil2_user on User {
  url(relative: $globalIsRelative)
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: false,
      name: "localIsRelative",
      type: "Boolean",
    },
    RootArgument {
      name: "PictureSize",
      type: "[Int]",
    },
    RootArgument {
      name: "globalIsRelative",
      type: "Boolean",
    },
  ],
  metadata: null,
  name: "UserUtil_user",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "PictureSize",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "width",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "height",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "relative",
          variableName: "globalIsRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
    ScalarField {
      alias: "anotherUrl",
      args: [
        Variable {
          name: "relative",
          variableName: "localIsRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "globalIsRelative",
      type: "Boolean",
    },
  ],
  metadata: null,
  name: "UserUtil2_user",
  selections: [
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "relative",
          variableName: "globalIsRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: unmasked-fragment-spreads-global-arguments.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query TestQuery($ProfilePicture_SIZE: [Int], $isRelative: Boolean) {
  me {
    ...UserProfile_user
  }
}

fragment UserProfile_user on User {
  profilePicture(size: $ProfilePicture_SIZE) {
    width
    height
  }
  ...UserUtil_user @relay(mask: false)
}

fragment UserUtil_user on User {
  url(relative: $isRelative)
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "ProfilePicture_SIZE",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "isRelative",
        type: "Boolean",
      },
    ],
    metadata: null,
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "UserProfile_user",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "ProfilePicture_SIZE",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "isRelative",
        type: "Boolean",
      },
    ],
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: [
              Variable {
                name: "size",
                variableName: "ProfilePicture_SIZE",
              },
            ],
            concreteType: "Image",
            name: "profilePicture",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "width",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "height",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: [
              Variable {
                name: "relative",
                variableName: "isRelative",
              },
            ],
            name: "url",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query TestQuery(
  $ProfilePicture_SIZE: [Int]
  $isRelative: Boolean
) {
  me {
    ...UserProfile_user
    id
  }
}

fragment UserProfile_user on User {
  profilePicture(size: $ProfilePicture_SIZE) {
    width
    height
  }
  url(relative: $isRelative)
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "ProfilePicture_SIZE",
      type: "[Int]",
    },
    RootArgument {
      name: "isRelative",
      type: "Boolean",
    },
  ],
  metadata: null,
  name: "UserProfile_user",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "ProfilePicture_SIZE",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "width",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "height",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "relative",
          variableName: "isRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "isRelative",
      type: "Boolean",
    },
  ],
  metadata: null,
  name: "UserUtil_user",
  selections: [
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "relative",
          variableName: "isRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: unmasked-fragment-spreads-local-arguments.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw

query TestQuery {
  me {
    ...User_user @relay(mask: false)
  }
}

fragment User_user on User
  @argumentDefinitions(isRelative: {type: "Boolean!", defaultValue: false}) {
  url(relative: $isRelative)
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

MaskTransform: Cannot use @relay(mask: false) on fragment spread because the fragment definition uses @argumentDefinitions.

Source: GraphQL request (5:5)
4:   me {
5:     ...User_user @relay(mask: false)
       ^
6:   }

Source: GraphQL request (10:24)
 9: fragment User_user on User
10:   @argumentDefinitions(isRelative: {type: "Boolean!", defaultValue: false}) {
                           ^
11:   url(relative: $isRelative)

`;

exports[`compileRelayArtifacts matches expected output: unmasked-fragment-spreads-recursive.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query TestQuery(
  $ProfilePicture_SIZE: [Int]
  $isRelative: Boolean
  $showFirstName: Boolean
) {
  me {
    ...UserProfile_user
  }
}

fragment UserProfile_user on User {
  firstName(if: $showFirstName)
  ...UserUtil_user @relay(mask: false)
}

fragment UserUtil_user on User {
  profilePicture(size: $ProfilePicture_SIZE) {
    width
    height
  }
  ...UserUtil2_user @relay(mask: false)
}

fragment UserUtil2_user on User {
  url(relative: $isRelative)
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "ProfilePicture_SIZE",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "isRelative",
        type: "Boolean",
      },
      LocalArgument {
        defaultValue: null,
        name: "showFirstName",
        type: "Boolean",
      },
    ],
    metadata: null,
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "UserProfile_user",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "ProfilePicture_SIZE",
        type: "[Int]",
      },
      LocalArgument {
        defaultValue: null,
        name: "isRelative",
        type: "Boolean",
      },
      LocalArgument {
        defaultValue: null,
        name: "showFirstName",
        type: "Boolean",
      },
    ],
    name: "TestQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "User",
        name: "me",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: [
              Variable {
                name: "if",
                variableName: "showFirstName",
              },
            ],
            name: "firstName",
            storageKey: null,
          },
          LinkedField {
            alias: null,
            args: [
              Variable {
                name: "size",
                variableName: "ProfilePicture_SIZE",
              },
            ],
            concreteType: "Image",
            name: "profilePicture",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "width",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "height",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: [
              Variable {
                name: "relative",
                variableName: "isRelative",
              },
            ],
            name: "url",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query TestQuery(
  $ProfilePicture_SIZE: [Int]
  $isRelative: Boolean
  $showFirstName: Boolean
) {
  me {
    ...UserProfile_user
    id
  }
}

fragment UserProfile_user on User {
  firstName(if: $showFirstName)
  profilePicture(size: $ProfilePicture_SIZE) {
    width
    height
  }
  url(relative: $isRelative)
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "showFirstName",
      type: "Boolean",
    },
    RootArgument {
      name: "ProfilePicture_SIZE",
      type: "[Int]",
    },
    RootArgument {
      name: "isRelative",
      type: "Boolean",
    },
  ],
  metadata: null,
  name: "UserProfile_user",
  selections: [
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "if",
          variableName: "showFirstName",
        },
      ],
      name: "firstName",
      storageKey: null,
    },
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "ProfilePicture_SIZE",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "width",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "height",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "relative",
          variableName: "isRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "ProfilePicture_SIZE",
      type: "[Int]",
    },
    RootArgument {
      name: "isRelative",
      type: "Boolean",
    },
  ],
  metadata: null,
  name: "UserUtil_user",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Variable {
          name: "size",
          variableName: "ProfilePicture_SIZE",
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "width",
          storageKey: null,
        },
        ScalarField {
          alias: null,
          args: null,
          name: "height",
          storageKey: null,
        },
      ],
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "relative",
          variableName: "isRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "isRelative",
      type: "Boolean",
    },
  ],
  metadata: null,
  name: "UserUtil2_user",
  selections: [
    ScalarField {
      alias: null,
      args: [
        Variable {
          name: "relative",
          variableName: "isRelative",
        },
      ],
      name: "url",
      storageKey: null,
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: unused-fragment-argdef.invalid.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
# expected-to-throw
query QueryWithUnusedFragmentArgumentDefinition($id: ID!) {
  node(id: $id) {
    ...Profile
  }
}

fragment Profile on User {
  id
  name
  ...ProfilePhotoWrapper @arguments(size: $size)
}

fragment ProfilePhotoWrapper on User @argumentDefinitions(size: {type: "Int"}) {
  __typename
  ...ProfilePhoto @arguments(size: $size)
}

fragment ProfilePhoto on User {
  profilePicture(size: [100]) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
THROWN EXCEPTION:

Variable @arguments values are only supported when the argument is defined with @argumentDefinitions. Check the definition of fragment 'ProfilePhoto'.

GraphQL request:16:36
15 |   __typename
16 |   ...ProfilePhoto @arguments(size: $size)
   |                                    ^
17 | }

GraphQL request:19:1
18 |
19 | fragment ProfilePhoto on User {
   | ^
20 |   profilePicture(size: [100]) {
`;

exports[`compileRelayArtifacts matches expected output: unused-fragment-argdef-unchecked.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query QueryWithUnusedFragmentArgumentDefinition($id: ID!) {
  node(id: $id) {
    ...Profile
  }
}

fragment Profile on User {
  id
  name
  ...ProfilePhotoWrapper @arguments(size: $size)
}

fragment ProfilePhotoWrapper on User @argumentDefinitions(size: {type: "Int"}) {
  __typename
  ...ProfilePhoto @uncheckedArguments_DEPRECATED(size: $size)
}

fragment ProfilePhoto on User {
  profilePicture(size: [100]) {
    uri
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    metadata: null,
    name: "QueryWithUnusedFragmentArgumentDefinition",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          FragmentSpread {
            args: null,
            name: "Profile",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
    ],
    name: "QueryWithUnusedFragmentArgumentDefinition",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          InlineFragment {
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "name",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              LinkedField {
                alias: null,
                args: [
                  Literal {
                    name: "size",
                    value: [
                      100,
                    ],
                  },
                ],
                concreteType: "Image",
                name: "profilePicture",
                plural: false,
                selections: [
                  ScalarField {
                    alias: null,
                    args: null,
                    name: "uri",
                    storageKey: null,
                  },
                ],
                storageKey: "profilePicture(size:[100])",
              },
            ],
            type: "User",
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query QueryWithUnusedFragmentArgumentDefinition(
  $id: ID!
) {
  node(id: $id) {
    __typename
    ...Profile
    id
  }
}

fragment Profile on User {
  id
  name
  ...ProfilePhotoWrapper_18PEfK
}

fragment ProfilePhotoWrapper_18PEfK on User {
  __typename
  ...ProfilePhoto_18PEfK
}

fragment ProfilePhoto_18PEfK on User {
  profilePicture(size: [100]) {
    uri
  }
}


Fragment {
  argumentDefinitions: [
    RootArgument {
      name: "size",
      type: null,
    },
  ],
  metadata: null,
  name: "Profile",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "id",
      storageKey: null,
    },
    ScalarField {
      alias: null,
      args: null,
      name: "name",
      storageKey: null,
    },
    FragmentSpread {
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      name: "ProfilePhotoWrapper",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: null,
      name: "size",
      type: "Int",
    },
  ],
  metadata: null,
  name: "ProfilePhotoWrapper",
  selections: [
    ScalarField {
      alias: null,
      args: null,
      name: "__typename",
      storageKey: null,
    },
    FragmentSpread {
      args: [
        Variable {
          name: "size",
          variableName: "size",
        },
      ],
      name: "ProfilePhoto",
    },
  ],
  type: "User",
}

Fragment {
  argumentDefinitions: [],
  metadata: null,
  name: "ProfilePhoto",
  selections: [
    LinkedField {
      alias: null,
      args: [
        Literal {
          name: "size",
          value: [
            100,
          ],
        },
      ],
      concreteType: "Image",
      name: "profilePicture",
      plural: false,
      selections: [
        ScalarField {
          alias: null,
          args: null,
          name: "uri",
          storageKey: null,
        },
      ],
      storageKey: "profilePicture(size:[100])",
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: unused-variables-removed-from-print-not-codegen.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query QueryWithUnusedVariables($id: ID!, $unusedFirst: Int, $unusedAfter: ID) {
  node(id: $id) {
    id
    ...ConnectionFragment @arguments(fetchConnection: false)
  }
}

fragment ConnectionFragment on User
  @argumentDefinitions(
    fetchConnection: {type: "Boolean", defaultValue: false}
  ) {
  ... @include(if: $fetchConnection) {
    friends(after: $unusedAfter, first: $unusedFirst) {
      edges {
        node {
          id
        }
      }
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "unusedFirst",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "unusedAfter",
        type: "ID",
      },
    ],
    metadata: null,
    name: "QueryWithUnusedVariables",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
          FragmentSpread {
            args: [
              Literal {
                name: "fetchConnection",
                value: false,
              },
            ],
            name: "ConnectionFragment",
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [
      LocalArgument {
        defaultValue: null,
        name: "id",
        type: "ID!",
      },
      LocalArgument {
        defaultValue: null,
        name: "unusedFirst",
        type: "Int",
      },
      LocalArgument {
        defaultValue: null,
        name: "unusedAfter",
        type: "ID",
      },
    ],
    name: "QueryWithUnusedVariables",
    selections: [
      LinkedField {
        alias: null,
        args: [
          Variable {
            name: "id",
            variableName: "id",
          },
        ],
        concreteType: null,
        name: "node",
        plural: false,
        selections: [
          ScalarField {
            alias: null,
            args: null,
            name: "__typename",
            storageKey: null,
          },
          ScalarField {
            alias: null,
            args: null,
            name: "id",
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query QueryWithUnusedVariables(
  $id: ID!
) {
  node(id: $id) {
    __typename
    id
  }
}


Fragment {
  argumentDefinitions: [
    LocalArgument {
      defaultValue: false,
      name: "fetchConnection",
      type: "Boolean",
    },
    RootArgument {
      name: "unusedAfter",
      type: "ID",
    },
    RootArgument {
      name: "unusedFirst",
      type: "Int",
    },
  ],
  metadata: null,
  name: "ConnectionFragment",
  selections: [
    Condition {
      condition: "fetchConnection",
      passingValue: true,
      selections: [
        LinkedField {
          alias: null,
          args: [
            Variable {
              name: "after",
              variableName: "unusedAfter",
            },
            Variable {
              name: "first",
              variableName: "unusedFirst",
            },
          ],
          concreteType: "FriendsConnection",
          name: "friends",
          plural: false,
          selections: [
            LinkedField {
              alias: null,
              args: null,
              concreteType: "FriendsEdge",
              name: "edges",
              plural: true,
              selections: [
                LinkedField {
                  alias: null,
                  args: null,
                  concreteType: "User",
                  name: "node",
                  plural: false,
                  selections: [
                    ScalarField {
                      alias: null,
                      args: null,
                      name: "id",
                      storageKey: null,
                    },
                  ],
                  storageKey: null,
                },
              ],
              storageKey: null,
            },
          ],
          storageKey: null,
        },
      ],
    },
  ],
  type: "User",
}
`;

exports[`compileRelayArtifacts matches expected output: viewer-query.graphql 1`] = `
~~~~~~~~~~ INPUT ~~~~~~~~~~
query ViewerQuery {
  viewer {
    actor {
      id
    }
  }
}

~~~~~~~~~~ OUTPUT ~~~~~~~~~~
Request {
  fragment: Fragment {
    argumentDefinitions: [],
    metadata: null,
    name: "ViewerQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
    type: "Query",
  },
  operation: Operation {
    argumentDefinitions: [],
    name: "ViewerQuery",
    selections: [
      LinkedField {
        alias: null,
        args: null,
        concreteType: "Viewer",
        name: "viewer",
        plural: false,
        selections: [
          LinkedField {
            alias: null,
            args: null,
            concreteType: null,
            name: "actor",
            plural: false,
            selections: [
              ScalarField {
                alias: null,
                args: null,
                name: "__typename",
                storageKey: null,
              },
              ScalarField {
                alias: null,
                args: null,
                name: "id",
                storageKey: null,
              },
            ],
            storageKey: null,
          },
        ],
        storageKey: null,
      },
    ],
  },
}

QUERY:

query ViewerQuery {
  viewer {
    actor {
      __typename
      id
    }
  }
}

`;
