<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-v4.0.0 plugin-docs plugin-id-default docs-doc-id-persisted-queries">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Persisted Queries | Relay</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://relay.dev/img/relay.png"><meta data-rh="true" name="twitter:image" content="https://relay.dev/img/relay.png"><meta data-rh="true" property="og:url" content="https://relay.dev/docs/v4.0.0/persisted-queries/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v4.0.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v4.0.0"><meta data-rh="true" name="docsearch:version" content="v4.0.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v4.0.0"><meta data-rh="true" property="og:title" content="Persisted Queries | Relay"><meta data-rh="true" name="description" content="The relay compiler supports persisted queries which is useful because:"><meta data-rh="true" property="og:description" content="The relay compiler supports persisted queries which is useful because:"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://relay.dev/docs/v4.0.0/persisted-queries/"><link data-rh="true" rel="alternate" href="https://relay.dev/docs/v4.0.0/persisted-queries/" hreflang="en"><link data-rh="true" rel="alternate" href="https://relay.dev/docs/v4.0.0/persisted-queries/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Relay RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Relay Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-DCSC7FDGL5","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DCSC7FDGL5"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DCSC7FDGL5",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Relay" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.21fd5f5d.css">
<link rel="preload" href="/assets/js/runtime~main.cc5d5b6e.js" as="script">
<link rel="preload" href="/assets/js/main.ea28af0c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>

<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Relay</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/help/">Help</a><a href="https://github.com/facebook/relay" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/v4.0.0/">v4.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next ðŸš§</a></li><li><a class="dropdown__link" href="/docs/">v15.0.0</a></li><li><a class="dropdown__link" href="/docs/v14.0.0/">v14.0.0</a></li><li><a class="dropdown__link" href="/docs/v13.0.0/">v13.0.0</a></li><li><a class="dropdown__link" href="/docs/v12.0.0/">v12.0.0</a></li><li><a class="dropdown__link" href="/docs/v11.0.0/">v11.0.0</a></li><li><a class="dropdown__link" href="/docs/v10.1.3/persisted-queries/">v10.1.3</a></li><li><a class="dropdown__link" href="/docs/v10.1.2/persisted-queries/">v10.1.2</a></li><li><a class="dropdown__link" href="/docs/v10.1.1/persisted-queries/">v10.1.1</a></li><li><a class="dropdown__link" href="/docs/v10.1.0/persisted-queries/">v10.1.0</a></li><li><a class="dropdown__link" href="/docs/v10.0.1/persisted-queries/">v10.0.1</a></li><li><a class="dropdown__link" href="/docs/v10.0.0/persisted-queries/">v10.0.0</a></li><li><a class="dropdown__link" href="/docs/v9.1.0/persisted-queries/">v9.1.0</a></li><li><a class="dropdown__link" href="/docs/v9.0.0/persisted-queries/">v9.0.0</a></li><li><a class="dropdown__link" href="/docs/v8.0.0/persisted-queries/">v8.0.0</a></li><li><a class="dropdown__link" href="/docs/v7.1.0/persisted-queries/">v7.1.0</a></li><li><a class="dropdown__link" href="/docs/v7.0.0/persisted-queries/">v7.0.0</a></li><li><a class="dropdown__link" href="/docs/v6.0.0/persisted-queries/">v6.0.0</a></li><li><a class="dropdown__link" href="/docs/v5.0.0/persisted-queries/">v5.0.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v4.0.0/persisted-queries/">v4.0.0</a></li><li><a class="dropdown__link" href="/docs/v3.0.0/persisted-queries/">v3.0.0</a></li><li><a class="dropdown__link" href="/docs/v2.0.0/persisted-queries/">v2.0.0</a></li><li><a class="dropdown__link" href="/docs/v1.7.0/persisted-queries/">v1.7.0</a></li><li><a class="dropdown__link" href="/docs/v1.6.2/persisted-queries/">v1.6.2</a></li><li><a class="dropdown__link" href="/docs/v1.6.1/persisted-queries/">v1.6.1</a></li><li><a class="dropdown__link" href="/docs/v1.6.0/persisted-queries/">v1.6.0</a></li><li><a class="dropdown__link" href="/docs/v1.5.0/persisted-queries/">v1.5.0</a></li><li><a class="dropdown__link" href="/docs/v1.4.1/persisted-queries/">v1.4.1</a></li><li><a class="dropdown__link" href="/versions/">All versions</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v4.0.0/">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v4.0.0/graphql-in-relay/">API Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/v4.0.0/routing/">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v4.0.0/routing/">Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v4.0.0/relay-debugging/">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v4.0.0/graphql-server-specification/">GraphQL Server Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/v4.0.0/persisted-queries/">Persisted Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v4.0.0/type-emission/">Type Emission</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v4.0.0/testing-relay-components/">Testing Relay Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v4.0.0/local-state-management/">Local State Management</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v4.0.0/thinking-in-graphql/">Principles &amp; Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/v4.0.0/community-learning-resources/">Community</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Relay<!-- --> <b>v4.0.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/">latest version</a></b> (<!-- -->v15.0.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><span class="theme-doc-version-badge badge badge--secondary">Version: v4.0.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Persisted Queries</h1></header><p>The relay compiler supports persisted queries which is useful because:</p><ul><li><p>the client operation text becomes just an md5 hash which is usually shorter than the real
query string. This saves upload bytes from the client to the server.</p></li><li><p>the server can now whitelist queries which improves security by restricting the operations
that can be executed by a client.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage-on-the-client">Usage on the client<a class="hash-link" href="#usage-on-the-client" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the---persist-output-flag">The <code>--persist-output</code> flag<a class="hash-link" href="#the---persist-output-flag" title="Direct link to heading">â€‹</a></h3><p>In your <code>npm</code> script in <code>package.json</code>, run the relay compiler using the <code>--persist-output</code> flag:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:black;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:black"><span class="token string-property property" style="color:black">&quot;scripts&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;relay&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;relay-compiler --src ./src --schema ./schema.graphql --persist-output ./path/to/persisted-queries.json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>--persist-ouput</code> flag does 3 things:</p><ol><li><p>It converts all query and mutation operation texts to md5 hashes.</p><p>For example without <code>--persist-output</code>, a generated <code>ConcreteRequest</code> might look like below:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:black;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:black"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> node</span><span class="token comment" style="color:#999988;font-style:italic">/*: ConcreteRequest*/</span><span class="token plain"> </span><span class="token operator" style="color:#b58a5e">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//... excluded for brevity</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;kind&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;Request&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;operationKind&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;query&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;name&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;TodoItemRefetchQuery&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;id&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NOTE: id is null</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;text&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;query TodoItemRefetchQuery(\n  $itemID: ID!\n) {\n  node(id: $itemID) {\n    ...TodoItem_item_2FOrhs\n  }\n}\n\nfragment TodoItem_item_2FOrhs on Todo {\n    text\n    isComplete\n}\n&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//... excluded for brevity</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With <code>--persist-output &lt;path&gt;</code> this becomes:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:black;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:black"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> node</span><span class="token comment" style="color:#999988;font-style:italic">/*: ConcreteRequest*/</span><span class="token plain"> </span><span class="token operator" style="color:#b58a5e">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//... excluded for brevity</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;kind&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;Request&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;operationKind&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;query&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;name&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;TodoItemRefetchQuery&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;id&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;3be4abb81fa595e25eb725b2c6a87508&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NOTE: id is now an md5 hash of the query text</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;text&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NOTE: text is null now</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//... excluded for brevity</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>It generates a JSON file at the <code>&lt;path&gt;</code> you specify containing a mapping from query ids
to the corresponding operation texts.</p></li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:black;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:black"><span class="token string-property property" style="color:black">&quot;scripts&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;relay&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;relay-compiler --src ./src --schema ./schema.graphql --persist-output ./src/queryMaps/queryMap.json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The example above writes the complete query map file to <code>./src/queryMaps/queryMap.json</code>. You need to ensure all the directories
leading to the <code>queryMap.json</code> file exist.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-layer-changes">Network layer changes<a class="hash-link" href="#network-layer-changes" title="Direct link to heading">â€‹</a></h3><p>You&#x27;ll need to modify your network layer fetch implementation to pass a documentId parameter in the POST body instead of a query parameter:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:black;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:black"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:black">fetchQuery</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token parameter">operation</span><span class="token parameter punctuation" style="color:#b58a5e">,</span><span class="token parameter"> variables</span><span class="token parameter punctuation" style="color:#b58a5e">,</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:black">fetch</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token string" style="color:#65822b">&#x27;/graphql&#x27;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">    </span><span class="token literal-property property" style="color:black">method</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&#x27;POST&#x27;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">    </span><span class="token literal-property property" style="color:black">headers</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">      </span><span class="token string-property property" style="color:black">&#x27;content-type&#x27;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&#x27;application/json&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">    </span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">    </span><span class="token literal-property property" style="color:black">body</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#b58a5e">.</span><span class="token method function property-access" style="color:black">stringify</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">      </span><span class="token literal-property property" style="color:black">documentId</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> operation</span><span class="token punctuation" style="color:#b58a5e">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// NOTE: pass md5 hash to the server</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// query: operation.text, // this is now obsolete because text is null</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">      variables</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">    </span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">.</span><span class="token method function property-access" style="color:black">then</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token parameter">response</span><span class="token plain"> </span><span class="token arrow operator" style="color:#b58a5e">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> response</span><span class="token punctuation" style="color:#b58a5e">.</span><span class="token method function property-access" style="color:black">json</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="executing-persisted-queries-on-the-server">Executing Persisted Queries on the Server<a class="hash-link" href="#executing-persisted-queries-on-the-server" title="Direct link to heading">â€‹</a></h2><p>To execute client requests that send persisted queries instead of query text, your server will need to be able
to lookup the query text corresponding to each id. Typically this will involve saving the output of the <code>--persist-output &lt;path&gt;</code> JSON file to a database or some other storage mechanism, and retrieving the corresponding text for the ID specified by a client.</p><p>For universal applications where the client and server code are in one project, this is not an issue since you can place
the query map file in a common location accessible to both the client and the server.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compile-time-push">Compile time push<a class="hash-link" href="#compile-time-push" title="Direct link to heading">â€‹</a></h3><p>For applications where the client and server projects are separate, one option is to have an additional npm run script
to push the query map at compile time to a location accessible by your server:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:black;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:black"><span class="token string-property property" style="color:black">&quot;scripts&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;push-queries&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;node ./pushQueries.js&quot;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token string-property property" style="color:black">&quot;relay&quot;</span><span class="token operator" style="color:#b58a5e">:</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&quot;relay-compiler --src ./src --schema ./schema.graphql --persist-ouput &lt;path&gt; &amp;&amp; npm run push-queries&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token punctuation" style="color:#b58a5e">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Some possibilities of what you can do in <code>./pushQueries.js</code>:</p><ul><li><p><code>git push</code> to your server repo</p></li><li><p>save the query maps to a database</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-time-push">Run time push<a class="hash-link" href="#run-time-push" title="Direct link to heading">â€‹</a></h3><p>A second more complex option is to push your query maps to the server at runtime, without the server knowing the query ids at the start.
The client optimistically sends a query id to the server, which does not have the query map. The server then in turn requests
for the full query text from the client so it can cache the query map for subsequent requests. This is a more complex approach
requiring the client and server to interact to exchange the query maps.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="simple-server-example">Simple server example<a class="hash-link" href="#simple-server-example" title="Direct link to heading">â€‹</a></h3><p>Once your server has access to the query map, you can perform the mapping. The solution varies depending on the server and
database technologies you use, so we&#x27;ll just cover the most common and basic example here.</p><p>If you use <code>express-graphql</code> and have access to the query map file, you can import the <code>--persist-output</code> JSON file directly and
perform the matching using the <code>matchQueryMiddleware</code> from <a href="https://github.com/yusinto/relay-compiler-plus" target="_blank" rel="noopener noreferrer">relay-compiler-plus</a>.</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:black;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:black"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Express</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&#x27;express&#x27;</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">expressGraphql</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&#x27;express-graphql&#x27;</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#b58a5e">{</span><span class="token imports">matchQueryMiddleware</span><span class="token imports punctuation" style="color:#b58a5e">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&#x27;relay-compiler-plus&#x27;</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">queryMapJson</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#65822b">&#x27;./path/to/persisted-queries.json&#x27;</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:black"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#b58a5e">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:black">Express</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:black"><span class="token plain">app</span><span class="token punctuation" style="color:#b58a5e">.</span><span class="token method function property-access" style="color:black">use</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token string" style="color:#65822b">&#x27;/graphql&#x27;</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token function" style="color:black">matchQueryMiddleware</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token plain">queryMapJson</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:black"><span class="token plain">  </span><span class="token function" style="color:black">expressGraphql</span><span class="token punctuation" style="color:#b58a5e">(</span><span class="token punctuation" style="color:#b58a5e">{</span><span class="token plain">schema</span><span class="token punctuation" style="color:#b58a5e">}</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">)</span><span class="token punctuation" style="color:#b58a5e">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using---persist-output-and---watch">Using <code>--persist-output</code> and <code>--watch</code><a class="hash-link" href="#using---persist-output-and---watch" title="Direct link to heading">â€‹</a></h2><p>It is possible to continuously generate the query map files by using the <code>--persist-output</code> and <code>--watch</code> options simultaneously.
This only makes sense for universal applications i.e. if your client and server code are in a single project
and you run them both together on localhost during development. Furthermore, in order for the server to pick up changes
to the <code>queryMap.json</code>, you&#x27;ll need to have server side hot-reloading set up. The details on how to set this up
is out of the scope of this document.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/relay/tree/main/website/versioned_docs/version-v4.0.0/Modern-PersistedQueries.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-08-31T04:30:29.000Z">Aug 31, 2023</time></b> by <b>Matt Mahoney</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/v4.0.0/graphql-server-specification/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">GraphQL Server Specification</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/v4.0.0/type-emission/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Type Emission</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#usage-on-the-client" class="table-of-contents__link toc-highlight">Usage on the client</a><ul><li><a href="#the---persist-output-flag" class="table-of-contents__link toc-highlight">The <code>--persist-output</code> flag</a></li><li><a href="#network-layer-changes" class="table-of-contents__link toc-highlight">Network layer changes</a></li></ul></li><li><a href="#executing-persisted-queries-on-the-server" class="table-of-contents__link toc-highlight">Executing Persisted Queries on the Server</a><ul><li><a href="#compile-time-push" class="table-of-contents__link toc-highlight">Compile time push</a></li><li><a href="#run-time-push" class="table-of-contents__link toc-highlight">Run time push</a></li><li><a href="#simple-server-example" class="table-of-contents__link toc-highlight">Simple server example</a></li></ul></li><li><a href="#using---persist-output-and---watch" class="table-of-contents__link toc-highlight">Using <code>--persist-output</code> and <code>--watch</code></a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/users/">User Showcase</a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/relay.svg" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/relay.svg" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright Â© 2023 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.cc5d5b6e.js"></script>
<script src="/assets/js/main.ea28af0c.js"></script>
</body>
</html>