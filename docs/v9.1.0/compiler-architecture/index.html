<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Relay Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Relay Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-50","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-44373548-50"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-44373548-50",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Relay" href="/opensearch.xml">
<script src="https://widget.surveymonkey.com/collect/website/js/tRaiETqnLgj758hTBazgdx2NnQ5W6bg3p3XoJtoYjHDMWZrhV7glVKgJgKV87xxk.js" defer="defer"></script><title data-react-helmet="true">Compiler Architecture | Relay</title><meta data-react-helmet="true" property="og:url" content="https://relay.dev/docs/v9.1.0/compiler-architecture"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="v9.1.0"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-v9.1.0"><meta data-react-helmet="true" property="og:title" content="Compiler Architecture | Relay"><meta data-react-helmet="true" name="description" content="The compiler is a set of modules designed to extract GraphQL documents from across a codebase, transform/optimize them, and generate build artifacts. Examples of common types of artifacts include optimized GraphQL to persist to your server, runtime representations of the queries for use with GraphQL clients such as the Relay runtime, or generated source code for use with GraphQL frameworks for compiled languages (Java/Swift/etc)."><meta data-react-helmet="true" property="og:description" content="The compiler is a set of modules designed to extract GraphQL documents from across a codebase, transform/optimize them, and generate build artifacts. Examples of common types of artifacts include optimized GraphQL to persist to your server, runtime representations of the queries for use with GraphQL clients such as the Relay runtime, or generated source code for use with GraphQL frameworks for compiled languages (Java/Swift/etc)."><meta data-react-helmet="true" property="og:image" content="https://relay.dev/img/relay.png"><meta data-react-helmet="true" name="twitter:image" content="https://relay.dev/img/relay.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://relay.dev/docs/v9.1.0/compiler-architecture"><link data-react-helmet="true" rel="alternate" href="https://relay.dev/docs/v9.1.0/compiler-architecture" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://relay.dev/docs/v9.1.0/compiler-architecture" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a5398f49.css">
<link rel="preload" href="/assets/js/runtime~main.d00f1544.js" as="script">
<link rel="preload" href="/assets/js/main.4e377854.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><strong class="navbar__title">Relay</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/help">Help</a><a href="https://github.com/facebook/relay" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/docs/v9.1.0/">v9.1.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next ğŸš§</a></li><li><a class="dropdown__link" href="/docs/">v11.0.0</a></li><li><a class="dropdown__link" href="/docs/v10.1.3/compiler-architecture">v10.1.3</a></li><li><a class="dropdown__link" href="/docs/v10.1.2/compiler-architecture">v10.1.2</a></li><li><a class="dropdown__link" href="/docs/v10.1.1/compiler-architecture">v10.1.1</a></li><li><a class="dropdown__link" href="/docs/v10.1.0/compiler-architecture">v10.1.0</a></li><li><a class="dropdown__link" href="/docs/v10.0.1/compiler-architecture">v10.0.1</a></li><li><a class="dropdown__link" href="/docs/v10.0.0/compiler-architecture">v10.0.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/v9.1.0/compiler-architecture">v9.1.0</a></li><li><a class="dropdown__link" href="/docs/v9.0.0/compiler-architecture">v9.0.0</a></li><li><a class="dropdown__link" href="/docs/v8.0.0/compiler-architecture">v8.0.0</a></li><li><a class="dropdown__link" href="/docs/v7.1.0/compiler-architecture">v7.1.0</a></li><li><a class="dropdown__link" href="/docs/v7.0.0/compiler-architecture">v7.0.0</a></li><li><a class="dropdown__link" href="/docs/v6.0.0/compiler-architecture">v6.0.0</a></li><li><a class="dropdown__link" href="/docs/v5.0.0/compiler-architecture">v5.0.0</a></li><li><a class="dropdown__link" href="/docs/v4.0.0/compiler-architecture">v4.0.0</a></li><li><a class="dropdown__link" href="/docs/v3.0.0/compiler-architecture">v3.0.0</a></li><li><a class="dropdown__link" href="/docs/v2.0.0/compiler-architecture">v2.0.0</a></li><li><a class="dropdown__link" href="/docs/v1.7.0/compiler-architecture">v1.7.0</a></li><li><a class="dropdown__link" href="/docs/v1.6.2/compiler-architecture">v1.6.2</a></li><li><a class="dropdown__link" href="/docs/v1.6.1/compiler-architecture">v1.6.1</a></li><li><a class="dropdown__link" href="/docs/v1.6.0/compiler-architecture">v1.6.0</a></li><li><a class="dropdown__link" href="/docs/v1.5.0/compiler-architecture">v1.5.0</a></li><li><a class="dropdown__link" href="/docs/v1.4.1/compiler-architecture">v1.4.1</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">Relay</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog/">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/help">Help</a></li><li class="menu__list-item"><a href="https://github.com/facebook/relay" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/">Next ğŸš§</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/">v11.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v10.1.3/compiler-architecture">v10.1.3</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v10.1.2/compiler-architecture">v10.1.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v10.1.1/compiler-architecture">v10.1.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v10.1.0/compiler-architecture">v10.1.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v10.0.1/compiler-architecture">v10.0.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v10.0.0/compiler-architecture">v10.0.0</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/v9.1.0/compiler-architecture">v9.1.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v9.0.0/compiler-architecture">v9.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v8.0.0/compiler-architecture">v8.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v7.1.0/compiler-architecture">v7.1.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v7.0.0/compiler-architecture">v7.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v6.0.0/compiler-architecture">v6.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v5.0.0/compiler-architecture">v5.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v4.0.0/compiler-architecture">v4.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v3.0.0/compiler-architecture">v3.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v2.0.0/compiler-architecture">v2.0.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v1.7.0/compiler-architecture">v1.7.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v1.6.2/compiler-architecture">v1.6.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v1.6.1/compiler-architecture">v1.6.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v1.6.0/compiler-architecture">v1.6.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v1.5.0/compiler-architecture">v1.5.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/v1.4.1/compiler-architecture">v1.4.1</a></li><li class="menu__list-item"><a class="menu__link" href="/versions">All versions</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/">Introduction to Relay</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/prerequisites">Prerequisites</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/installation-and-setup">Installation and Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/quick-start-guide">Quick Start Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/graphql-in-relay">GraphQL in Relay</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/relay-environment">Relay Environment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/network-layer">Network Layer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/query-renderer">QueryRenderer</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/fragment-container">Fragment Container</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/refetch-container">Refetch Container</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/pagination-container">Pagination Container</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/mutations">Mutations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/subscriptions">Subscriptions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/relay-store">Relay Store</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/fetch-query">fetchQuery</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/routing">Routing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/relay-debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/graphql-server-specification">GraphQL Server Specification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/persisted-queries">Persisted Queries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/type-emission">Type Emission</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/testing-relay-components">Testing Relay Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/local-state-management">Local State Management</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Principles &amp; Architecture</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v9.1.0/thinking-in-graphql">Thinking in GraphQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v9.1.0/thinking-in-relay">Thinking In Relay</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v9.1.0/architecture-overview">Architecture Overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/v9.1.0/compiler-architecture">Compiler Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v9.1.0/runtime-architecture">Runtime Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/v9.1.0/videos">Videos</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/v9.1.0/community-learning-resources">Community Learning Resources</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Relay <strong>v9.1.0</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/">latest version</a></strong> (v11.0.0).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: v9.1.0</span></div><header><h1 class="docTitle_3a4h">Compiler Architecture</h1></header><div class="markdown"><p>The compiler is a set of modules designed to extract GraphQL documents from across a codebase, transform/optimize them, and generate build artifacts. Examples of common types of artifacts include optimized GraphQL to persist to your server, runtime representations of the queries for use with GraphQL clients such as the Relay runtime, or generated source code for use with GraphQL frameworks for compiled languages (Java/Swift/etc).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-flow"></a>Data Flow<a class="hash-link" href="#data-flow" title="Direct link to heading">#</a></h2><p>The high-level flow of data through the compiler is represented in the following diagram:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”‚   GraphQL   â”‚â”‚   Schema    â”‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â”‚              â”‚              parse</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                  â–¼</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”‚      CompilerContext       â”‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”‚                            â”‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”‚   â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”‚â”€â”€â”</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”‚   â”‚ IR  â”‚ â”‚ IR  â”‚ â”‚ ... â”‚  â”‚  â”‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”‚   â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â”‚  â”‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  transform/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â”‚    â”‚      â–²            â”‚   optimize</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â”‚    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â”‚    â”‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â”‚  print        â”‚  codegen</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          â–¼               â–¼</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â”‚   GraphQL   â”‚ â”‚  Artifacts  â”‚</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ol><li>GraphQL text is extracted from source files and &quot;parsed&quot; into an intermediate representation (IR) using information from the schema.</li><li>The set of IR documents forms a CompilerContext, which is then transformed and optimized.</li><li>Finally, GraphQL is printed (e.g. to files, saved to a database, etc) and any artifacts are generated.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="data-types--modules"></a>Data Types &amp; Modules<a class="hash-link" href="#data-types--modules" title="Direct link to heading">#</a></h2><p>The compiler module is composed of a set of core building blocks as well as a helper that packages them together in an easy to use API. Some of the main data types and modules in the compiler are as follows:</p><ul><li><code>IR</code> (Intermediate Representation): an (effectively immutable) representation of a GraphQL document (query, fragment, field, etc) as a tree structure, including type information from a schema. Compared to the standard GraphQL AST (produced by e.g. <code>graphql-js</code>) the main difference is that it encodes more of the semantics of GraphQL. For example, conditional branches (<code>@include</code> and <code>@skip</code>) are represented directly, making it easier to target optimizations for these directives (One such optimization is to merge sibling fields with the same condition, potentially reducing the number of conditionals that must be evaluated at runtime).</li><li><code>CompilerContext</code>: an immutable representation of a corpus of GraphQL documents. It contains the schema and a mapping of document names to document representations (as IR, see above).</li><li><code>Transform</code>: a &quot;map&quot;-like function that accepts a <code>CompilerContext</code> as input and returns a new, modified context as output. Examples below.</li><li><code>Parser</code>: Converts a GraphQL schema and raw GraphQL text into typed IR objects.</li><li><code>Printer</code>: a function that accepts IR and converts it to a GraphQL string.</li></ul><p>The <code>RelayCompiler</code> module is a helper class that demonstrates one way of combining these primitives. It takes IR transforms, and given IR definitions, constructs a CompilerContext from them, transforming them, and generating output artifacts intended for use with Relay runtime.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transforms"></a>Transforms<a class="hash-link" href="#transforms" title="Direct link to heading">#</a></h2><p>One of the main goals of the compiler is to provide a consistent platform for writing tools that transform or optimize GraphQL. This includes the ability to experiment with new directives by transforming them away at compile time. Transform functions should typically perform a single type of modification - it&#x27;s expected that an app will have multiple transforms configured in the compiler instance.</p><p>Here are a few examples of some of the included transforms:</p><ul><li><code>FlattenTransform</code>: Reduces extraneous levels of indirection in a query, inlining fields from anonymous fragments wherever they match the parent type. This can be beneficial when generating code to read the results of a query or process query results, as it reduces duplicate field processing. For example:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># before: `id` is processed twice</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">foo { # type FooType</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ... on FooType { # matches the parent type, so this is extraneous</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> # after: `id` is processed once</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> foo {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><code>SkipRedundantNodeTransform</code>: A more advanced version of flattening, this eliminates more complex cases of field duplication such as when a field is fetched both unconditionally and conditionally, or is fetched by two different sub-fragments. For example:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># before: `id` processed up to 2x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">foo {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bar {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ... on FooType @include(if: $cond) { # can&#x27;t be flattened due to conditional</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id # but this field is guaranteed to be fetched regardless</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># after: `id` processed at most once</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">foo {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bar {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><ul><li><code>GenerateRequisiteFieldTransform</code>: This optional, Relay-specific transform inserts <code>id</code> fields for globally identifiable objects and <code>__typename</code> fields wherever the type cannot be statically determined (e.g. for unions).</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/relay/edit/master/website/versioned_docs/version-v9.1.0/PrinciplesAndArchitecture-Compiler.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-06-04T22:37:20.000Z" class="lastUpdatedDate_1WI_">6/4/2021</time> by <strong>Andrey Lunyov</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/v9.1.0/architecture-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Architecture Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/v9.1.0/runtime-architecture"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Runtime Architecture Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-flow" class="table-of-contents__link">Data Flow</a></li><li><a href="#data-types--modules" class="table-of-contents__link">Data Types &amp; Modules</a></li><li><a href="#transforms" class="table-of-contents__link">Transforms</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs">Introduction</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_self" href="/users">User Showcase</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/relay.svg" alt="" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/relay.svg" alt="" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div></div></div></footer></div>
<script src="/assets/js/runtime~main.d00f1544.js"></script>
<script src="/assets/js/main.4e377854.js"></script>
</body>
</html>